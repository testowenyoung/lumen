<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/lumen/styles.1d0daeadf0762b76da98.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/lumen/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/lumen/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/lumen/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/lumen/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/lumen/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/lumen/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/lumen/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/lumen/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/lumen/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/lumen/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/lumen/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/lumen/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/lumen/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/lumen/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/lumen/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/lumen/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/lumen/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/lumen/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/lumen/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/lumen/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/lumen/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/lumen/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/lumen/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/lumen/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/lumen/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/lumen/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.23.12"/><link rel="alternate" type="application/rss+xml" href="/lumen/rss.xml"/><link rel="icon" href="/lumen/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/lumen/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/lumen/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/lumen/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/lumen/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/lumen/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/lumen/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/lumen/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/lumen/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/lumen/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">Implement real-time updates using Lambda and Websockets via IoT | Gatsby Starter Blog</title><meta data-react-helmet="true" name="description" content="Need a serverless way to give your app updated data in real-time? Try this solution with Websockets and Lambda."/><meta data-react-helmet="true" property="og:title" content="Implement real-time updates using Lambda and Websockets via IoT"/><meta data-react-helmet="true" property="og:description" content="Need a serverless way to give your app updated data in real-time? Try this solution with Websockets and Lambda."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="kylemathews"/><meta data-react-helmet="true" name="twitter:title" content="Implement real-time updates using Lambda and Websockets via IoT"/><meta data-react-helmet="true" name="twitter:description" content="Need a serverless way to give your app updated data in real-time? Try this solution with Websockets and Lambda."/><link as="script" rel="preload" href="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js"/><link as="script" rel="preload" href="/lumen/framework-5fc6169171e885c3b522.js"/><link as="script" rel="preload" href="/lumen/styles-cd63080e784be7b7e7cf.js"/><link as="script" rel="preload" href="/lumen/app-36e457a5393b79b99515.js"/><link as="script" rel="preload" href="/lumen/commons-4c36ffabef1434ec1126.js"/><link as="script" rel="preload" href="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js"/><link as="script" rel="preload" href="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"/><link as="fetch" rel="preload" href="/lumen/page-data/posts/2018-02-06-realtime-updates-using-lambda-websockets-iot/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/lumen/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;color:inherit" href="/lumen/">Gatsby Starter Blog</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">Implement real-time updates using Lambda and Websockets via IoT</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">February 06, 2018</p></header><section><p>Would your frontend application benefit from having access to updated data in real-time, but you can’t seem to find a ‘serverless’ way to do it? Well, that was me 3 months ago.</p>
<p>I had a goal to make a serverless chat app, but no clue how I would implement real-time communication between my backend and the frontend client. If you search AWS for ‘websockets serverless’ you will unfortunately find nothing (at least at the time of writing this article).</p>
<p>So how did I do it? Read on, my friends!</p>
<p>(Or, just <a href="https://github.com/OmniPotent42/chat-app-serverless">check out the repository</a> to see what I’ve done.)</p>
<h4>Some background</h4>
<p>Before we dive into the real-time updates, I’d like to explain how I’ve structured my application in general. This is a (very) rudimentary diagram I’ve created to show how the whole app fits together.</p>
<p><img src="https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/websockets-lambda-iot/aws-diagram.png" alt="AWS Diagram"></p>
<p>The frontend is hosted in an S3 bucket as a static site.</p>
<p>I’m using <a href="https://vuejs.org/">VueJS</a> for my frontend framework. That bucket is behind a CloudFront distribution with an SSL certificate from Amazon Certificate Manager, and my Route53 domain points <code class="language-text">awschat.net</code> (my app) to that distribution.</p>
<p>The backend is your standard serverless API.</p>
<p>API Gateway routes incoming requests to specific Lambdas, which then access DynamoDB and the IoT message broker. (We’ll dive more into that later.) I also use a Cognito User Pool authorizer to ensure that all of my requests are coming from users of my application. I’ll dive more into that in the next section.</p>
<p><strong>Note:</strong> If you want to check out the finished version of my application before reading on, head over to <a href="https://awschat.net">https://awschat.net</a></p>
<h4>Setting up Cognito</h4>
<p>To set up Cognito User Pools with your API and frontend authentication, you’ll need a bit of CloudFormation.</p>
<p>Here are the Cognito-related entries in the resources section of my <code class="language-text">serverless.yml</code>:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">CognitoUserPoolMyUserPool</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">"AWS::Cognito::UserPool"</span>
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
    <span class="token key atrule">AdminCreateUserConfig</span><span class="token punctuation">:</span>
      <span class="token key atrule">AllowAdminCreateUserOnly</span><span class="token punctuation">:</span> <span class="token boolean important">False</span>
    <span class="token key atrule">AliasAttributes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> email
    <span class="token key atrule">AutoVerifiedAttributes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> email
    <span class="token key atrule">Policies</span><span class="token punctuation">:</span>
      <span class="token key atrule">PasswordPolicy</span><span class="token punctuation">:</span>
        <span class="token key atrule">MinimumLength</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">RequireLowercase</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token key atrule">RequireNumbers</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token key atrule">RequireSymbols</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token key atrule">RequireUppercase</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">UserPoolName</span><span class="token punctuation">:</span> MY_USER_POOL_NAME
    <span class="token key atrule">Schema</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">Name</span><span class="token punctuation">:</span> email
        <span class="token key atrule">AttributeDataType</span><span class="token punctuation">:</span> String
        <span class="token key atrule">DeveloperOnlyAttribute</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token key atrule">Mutable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">Required</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">WebAppUserPoolWebClient</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">"AWS::Cognito::UserPoolClient"</span>
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
    <span class="token key atrule">ClientName</span><span class="token punctuation">:</span> Web
    <span class="token key atrule">GenerateSecret</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">ReadAttributes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"email"</span>
    <span class="token key atrule">UserPoolId</span><span class="token punctuation">:</span>
      <span class="token key atrule">Ref</span><span class="token punctuation">:</span> CognitoUserPoolMyUserPool
    <span class="token key atrule">WriteAttributes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"email"</span>
<span class="token key atrule">ApiGatewayAuthorizer</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">"AWS::ApiGateway::Authorizer"</span>
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
    <span class="token key atrule">Name</span><span class="token punctuation">:</span> UserPool
    <span class="token key atrule">ProviderARNs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">'Fn::GetAtt'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> CognitoUserPoolMyUserPool<span class="token punctuation">,</span> Arn <span class="token punctuation">]</span>
    <span class="token key atrule">RestApiId</span><span class="token punctuation">:</span>
      <span class="token key atrule">Ref</span><span class="token punctuation">:</span> ApiGatewayRestApi
    <span class="token key atrule">IdentitySource</span><span class="token punctuation">:</span> <span class="token string">"method.request.header.Authorization"</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> COGNITO_USER_POOLS</code></pre></div>
<p>One thing to note is: when you want to add a Cognito User Pool Authorizer to an endpoint, the <a href="https://serverless.com/framework/">Serverless Framework</a> doesn’t support using a user pool that gets created in the same stack.</p>
<p>That means we have to define every endpoint-authorizer attachment manually in CloudFormation, like this:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"> <span class="token key atrule">ApiGatewayMethodUserGet</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">"AWS::ApiGateway::Method"</span>
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
    <span class="token key atrule">AuthorizationType</span><span class="token punctuation">:</span> COGNITO_USER_POOLS
    <span class="token key atrule">AuthorizerId</span><span class="token punctuation">:</span>
      <span class="token key atrule">Ref</span><span class="token punctuation">:</span> ApiGatewayAuthorizer</code></pre></div>
<p>We also have to use the normalized name of our API Gateway method. (<a href="https://serverless.com/framework/docs/providers/aws/guide/resources/">Check here</a> for normalized names of serverless-created resources.)</p>
<h4>Setting up the IoT message broker configuration</h4>
<h5>Step 1: AWS</h5>
<p>This part is a little bit more complex. In order to allow a front end user to use our message broker, we first have to set up an Identity Pool that our users can authenticate with.</p>
<p>Note that, in my application, I’ve left privileges a little more loose than they should be in a serious production app. In fact, I technically leave all IoT users unauthenticated. This is because adding logged-in credentials is a bit more complex.</p>
<p>But—I only give them permission to subscribe, receive, and connect. So no one can maliciously send a bunch of messages from their client.</p>
<p>The CloudFormation to set that up is right here:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">WebAppCognitoIdentityPool</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">"AWS::Cognito::IdentityPool"</span>
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
    <span class="token key atrule">IdentityPoolName</span><span class="token punctuation">:</span> NAME_OF_IDENTITY_POOL
    <span class="token key atrule">AllowUnauthenticatedIdentities</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">CognitoIdentityProviders</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">ProviderName</span><span class="token punctuation">:</span>
          <span class="token key atrule">'Fn::GetAtt'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> CognitoUserPoolMyUserPool<span class="token punctuation">,</span> ProviderName <span class="token punctuation">]</span>
        <span class="token key atrule">ClientId</span><span class="token punctuation">:</span>
          <span class="token key atrule">Ref</span><span class="token punctuation">:</span> WebAppUserPoolWebClient
<span class="token key atrule">cognitoAuthRole</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">'AWS::IAM::Role'</span>
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
    <span class="token key atrule">RoleName</span><span class="token punctuation">:</span> NAME_OF_IDENTITY_POOL_Auth_Role
    <span class="token key atrule">AssumeRolePolicyDocument</span><span class="token punctuation">:</span>
      <span class="token key atrule">Version</span><span class="token punctuation">:</span> <span class="token string">'2012-10-17'</span>
      <span class="token key atrule">Statement</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">Effect</span><span class="token punctuation">:</span> Allow
          <span class="token key atrule">Principal</span><span class="token punctuation">:</span>
            <span class="token key atrule">Federated</span><span class="token punctuation">:</span> cognito<span class="token punctuation">-</span>identity.amazonaws.com
          <span class="token key atrule">Action</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">'sts:AssumeRoleWithWebIdentity'</span> <span class="token punctuation">]</span>
          <span class="token key atrule">Condition</span><span class="token punctuation">:</span>
            <span class="token key atrule">StringEquals</span><span class="token punctuation">:</span>
              <span class="token key atrule">'cognito-identity.amazonaws.com:aud'</span><span class="token punctuation">:</span>
                <span class="token key atrule">Ref</span><span class="token punctuation">:</span> WebAppCognitoIdentityPool
            <span class="token key atrule">'ForAnyValue:StringLike'</span><span class="token punctuation">:</span>
                <span class="token key atrule">'cognito-identity.amazonaws.com:amr'</span><span class="token punctuation">:</span> authenticated
    <span class="token key atrule">Policies</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">PolicyName</span><span class="token punctuation">:</span> cognitoauth
        <span class="token key atrule">PolicyDocument</span><span class="token punctuation">:</span>
          <span class="token key atrule">Version</span><span class="token punctuation">:</span> <span class="token string">'2012-10-17'</span>
          <span class="token key atrule">Statement</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">Effect</span><span class="token punctuation">:</span> Allow
              <span class="token key atrule">Action</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:DescribeEndpoint'</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:Receive'</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:Subscribe'</span><span class="token punctuation">,</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:GetTopicRule'</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:Connect'</span>
              <span class="token punctuation">-</span> <span class="token string">'mobileanalytics:PutEvents'</span><span class="token punctuation">,</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:DescribeCertificate'</span><span class="token punctuation">,</span>
              <span class="token punctuation">-</span> <span class="token string">'cognito-sync:*'</span><span class="token punctuation">,</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:GetPolicyVersion'</span>
              <span class="token key atrule">Resource</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">"*"</span>
<span class="token key atrule">cognitoUnauthRole</span><span class="token punctuation">:</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">'AWS::IAM::Role'</span>
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
    <span class="token key atrule">RoleName</span><span class="token punctuation">:</span> NAME_OF_IDENTITY_POOL_Unauth_Role
    <span class="token key atrule">AssumeRolePolicyDocument</span><span class="token punctuation">:</span>
      <span class="token key atrule">Version</span><span class="token punctuation">:</span> <span class="token string">'2012-10-17'</span>
      <span class="token key atrule">Statement</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">Effect</span><span class="token punctuation">:</span> Allow
          <span class="token key atrule">Principal</span><span class="token punctuation">:</span>
            <span class="token key atrule">Federated</span><span class="token punctuation">:</span> cognito<span class="token punctuation">-</span>identity.amazonaws.com
          <span class="token key atrule">Action</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">'sts:AssumeRoleWithWebIdentity'</span> <span class="token punctuation">]</span>
          <span class="token key atrule">Condition</span><span class="token punctuation">:</span>
            <span class="token key atrule">StringEquals</span><span class="token punctuation">:</span>
              <span class="token key atrule">'cognito-identity.amazonaws.com:aud'</span><span class="token punctuation">:</span>
                <span class="token key atrule">Ref</span><span class="token punctuation">:</span> WebAppCognitoIdentityPool
            <span class="token key atrule">'ForAnyValue:StringLike'</span><span class="token punctuation">:</span>
                <span class="token key atrule">'cognito-identity.amazonaws.com:amr'</span><span class="token punctuation">:</span> unauthenticated
    <span class="token key atrule">Policies</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">PolicyName</span><span class="token punctuation">:</span> cognitounauth
        <span class="token key atrule">PolicyDocument</span><span class="token punctuation">:</span>
          <span class="token key atrule">Version</span><span class="token punctuation">:</span> <span class="token string">'2012-10-17'</span>
          <span class="token key atrule">Statement</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">Effect</span><span class="token punctuation">:</span> Allow
              <span class="token key atrule">Action</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:DescribeEndpoint'</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:Receive'</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:Subscribe'</span><span class="token punctuation">,</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:GetTopicRule'</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:Connect'</span>
              <span class="token punctuation">-</span> <span class="token string">'mobileanalytics:PutEvents'</span><span class="token punctuation">,</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:DescribeCertificate'</span><span class="token punctuation">,</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:Publish'</span><span class="token punctuation">,</span>
              <span class="token punctuation">-</span> <span class="token string">'cognito-sync:*'</span><span class="token punctuation">,</span>
              <span class="token punctuation">-</span> <span class="token string">'iot:GetPolicyVersion'</span>
              <span class="token key atrule">Resource</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">"*"</span>
<span class="token key atrule">myApiIdentityPoolRoleAttachment</span><span class="token punctuation">:</span>
  <span class="token key atrule">DependsOn</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> WebAppCognitoIdentityPool<span class="token punctuation">,</span> cognitoUnauthRole<span class="token punctuation">,</span> cognitoAuthRole <span class="token punctuation">]</span>
  <span class="token key atrule">Type</span><span class="token punctuation">:</span> <span class="token string">"AWS::Cognito::IdentityPoolRoleAttachment"</span>
  <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
    <span class="token key atrule">IdentityPoolId</span><span class="token punctuation">:</span>
      <span class="token key atrule">Ref</span><span class="token punctuation">:</span> WebAppCognitoIdentityPool
    <span class="token key atrule">Roles</span><span class="token punctuation">:</span>
      <span class="token key atrule">unauthenticated</span><span class="token punctuation">:</span>
        <span class="token key atrule">'Fn::GetAtt'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> cognitoUnauthRole<span class="token punctuation">,</span> Arn <span class="token punctuation">]</span>
      <span class="token key atrule">authenticated</span><span class="token punctuation">:</span>
        <span class="token key atrule">'Fn::GetAtt'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> cognitoAuthRole<span class="token punctuation">,</span> Arn<span class="token punctuation">]</span></code></pre></div>
<p>We will also need to add a policy to IoT that allows all actions to be executed.</p>
<p>To change your IoT policy, you must go to the IoT console and click ‘Get started’. From there, click ‘Secure’ on the left side menu, and then ‘Policies’.</p>
<p>You will want to create a new policy that looks like the one below:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2012-10-17"</span><span class="token punctuation">,</span>
  <span class="token property">"Statement"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"Effect"</span><span class="token operator">:</span> <span class="token string">"Allow"</span><span class="token punctuation">,</span>
      <span class="token property">"Action"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"iot:*"</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"Resource"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"*"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Note:</strong> Again, this is probably too broad of a policy for a production application. You can narrow it down once you’ve established your application’s IoT access patterns.</p>
<h5>Step 2: Accessing IoT from Lambda</h5>
<p>Say a user sends an API request to add a message to a chat. We update our database, and then return the message to the user who sent it, but how do we notify the other user that a message has been added?</p>
<p>That’s where the AWS SDK comes in. My example uses the JavaScript SDK.</p>
<p>You’ll need to get your IoT endpoint, which you can do by running <code class="language-text">aws iot describe-endpoint</code> in your console if you have the AWS CLI. Or you can find it by going to the IoT console, clicking ‘getting started’ and then clicking on ‘settings’ in the bottom left corner.</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token constant">AWS</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'aws-sdk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> iotData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>IotData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>endpoint<span class="token operator">:</span> <span class="token string">'YOUR_IOT_ENDPOINT HERE'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> iotParams <span class="token operator">=</span> <span class="token punctuation">{</span>
    payload<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Hello!'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    topic<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/my-app/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>receiverId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>

  iotData<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>iotParams<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// handle error here</span>
    <span class="token punctuation">}</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> success<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The example Lambda above takes in a user id (<code class="language-text">event.receiverId</code>) and broadcasts to that user’s channel in our app. We have a prefix in our topic, <code class="language-text">my-app/</code> which will let us use the same IoT endpoint for multiple applications.</p>
<p>The last thing we need to do is set up our frontend application to use the IoT message broker so that we can actually receive the publish event.</p>
<h5>Step 3: Connecting in your front end</h5>
<p>Luckily, someone has already come up with a library that lets us listen to the IoT mqtt broker over Websockets! <a href="https://github.com/kmamykin/aws-mqtt">You can find it here</a>.</p>
<p>Here is an example of how to use it in a webpack build (taken from the library mentioned above):</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token constant">AWS</span> <span class="token keyword">from</span> <span class="token string">'aws-sdk/global'</span>
<span class="token keyword">import</span> AWSMqtt <span class="token keyword">from</span> <span class="token string">'aws-mqtt'</span>
<span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>region <span class="token operator">=</span> <span class="token string">'us-east-1'</span> <span class="token comment">// your region</span>
<span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AWS<span class="token punctuation">.</span>CognitoIdentityCredentials</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  IdentityPoolId<span class="token operator">:</span> <span class="token string">'...'</span> <span class="token comment">// your identity pool id</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> AWSMqtt<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  WebSocket<span class="token operator">:</span> window<span class="token punctuation">.</span>WebSocket<span class="token punctuation">,</span>
  region<span class="token operator">:</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>region<span class="token punctuation">,</span>
  credentials<span class="token operator">:</span> <span class="token constant">AWS</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>credentials<span class="token punctuation">,</span>
  endpoint<span class="token operator">:</span> <span class="token string">'...iot.us-east-1.amazonaws.com'</span><span class="token punctuation">,</span> <span class="token comment">// NOTE: get this value with `aws iot describe-endpoint`</span>
  clientId<span class="token operator">:</span> <span class="token string">'mqtt-client-'</span> <span class="token operator">+</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// clientId to register with MQTT broker. Need to be unique per client</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'/myTopic'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">topic<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// this is where you will handle the messages you send from Lambda</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> message<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<h4>Conclusion</h4>
<p>That’s it! Now you know how to implement real-time communication between your frontend application and serverless backend.</p>
<p>The source code for the entire project can be found here:</p>
<ul>
<li><a href="https://github.com/OmniPotent42/chat-app-serverless">Serverless chat app backend</a></li>
<li><a href="https://github.com/OmniPotent42/chat-app-vuejs">Serverless chat app frontend</a></li>
</ul></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAUBAgME/8QAFwEBAAMAAAAAAAAAAAAAAAAAAgABA//aAAwDAQACEAMQAAABtTuWpVlGVPBk0HAFf//EABsQAAICAwEAAAAAAAAAAAAAAAECAxMAESMk/9oACAEBAAEFAnOlgZ7cvIZnEYuxj6ZjxjOh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQEiH/2gAIAQMBAT8BwqOP/8QAGREAAQUAAAAAAAAAAAAAAAAAAAEQEiEx/9oACAECAQE/AbJCY3//xAAgEAABAgUFAAAAAAAAAAAAAAABABECAxASITFBYYGR/9oACAEBAAY/Ai2qYx3A0tPifYlsLBBT8qX3T//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hRVcZF9KXnJkRaRWsbCd3oQNMD6x1eoRshVw76T//2gAMAwEAAgADAAAAENvoAP/EABkRAAIDAQAAAAAAAAAAAAAAAAABESExUf/aAAgBAwEBPxCEpsj00xYf/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAEQESExUf/aAAgBAgEBPxBNs0X5A9n/xAAeEAEBAQACAQUAAAAAAAAAAAABEQAhMUFRYXGBkf/aAAgBAQABPxClwdnV0whQo4lO/wAzyyrjkGw+cZbkILxecbfXBH7zSeBntAmta2n5uEBbXZ4N/9k=" alt="Kyle Mathews" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" src="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg" alt="Kyle Mathews" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Kyle Mathews</strong> <!-- -->who lives and works in San Francisco building useful things.<!-- --> <a href="https://twitter.com/kylemathews">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/lumen/posts/2018-02-05-serverless-dashboard-plugin-for-atom-editor/">← <!-- -->Using the Serverless Dashboard plugin for Atom</a></li><li><a rel="next" href="/lumen/posts/2018-02-09-communication-strategies-remote-teams/">Communication strategies for remote teams<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/2018-02-06-realtime-updates-using-lambda-websockets-iot/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-36e457a5393b79b99515.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9578b926700cf49bb4fc.js"],"component---src-pages-index-js":["/component---src-pages-index-js-753a3f9bde0636fce206.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-f16d60f62c7d2b3e9bcc.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"]};/*]]>*/</script><script src="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js" async=""></script><script src="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js" async=""></script><script src="/lumen/commons-4c36ffabef1434ec1126.js" async=""></script><script src="/lumen/app-36e457a5393b79b99515.js" async=""></script><script src="/lumen/styles-cd63080e784be7b7e7cf.js" async=""></script><script src="/lumen/framework-5fc6169171e885c3b522.js" async=""></script><script src="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js" async=""></script></body></html>