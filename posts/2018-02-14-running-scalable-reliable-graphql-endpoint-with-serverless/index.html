<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/lumen/styles.1d0daeadf0762b76da98.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/lumen/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/lumen/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/lumen/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/lumen/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/lumen/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/lumen/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/lumen/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/lumen/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/lumen/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/lumen/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/lumen/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/lumen/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/lumen/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/lumen/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/lumen/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/lumen/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/lumen/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/lumen/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/lumen/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/lumen/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/lumen/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/lumen/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/lumen/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/lumen/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/lumen/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/lumen/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.23.12"/><link rel="alternate" type="application/rss+xml" href="/lumen/rss.xml"/><link rel="icon" href="/lumen/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/lumen/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/lumen/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/lumen/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/lumen/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/lumen/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/lumen/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/lumen/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/lumen/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/lumen/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">Running a scalable &amp; reliable GraphQL endpoint with Serverless | Gatsby Starter Blog</title><meta data-react-helmet="true" name="description" content="Learn how to create GraphQL endpoints using the Serverless Framework, Lambda, DynamoDB, RDS and a REST backend."/><meta data-react-helmet="true" property="og:title" content="Running a scalable &amp; reliable GraphQL endpoint with Serverless"/><meta data-react-helmet="true" property="og:description" content="Learn how to create GraphQL endpoints using the Serverless Framework, Lambda, DynamoDB, RDS and a REST backend."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="kylemathews"/><meta data-react-helmet="true" name="twitter:title" content="Running a scalable &amp; reliable GraphQL endpoint with Serverless"/><meta data-react-helmet="true" name="twitter:description" content="Learn how to create GraphQL endpoints using the Serverless Framework, Lambda, DynamoDB, RDS and a REST backend."/><link as="script" rel="preload" href="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js"/><link as="script" rel="preload" href="/lumen/framework-5fc6169171e885c3b522.js"/><link as="script" rel="preload" href="/lumen/styles-cd63080e784be7b7e7cf.js"/><link as="script" rel="preload" href="/lumen/app-36e457a5393b79b99515.js"/><link as="script" rel="preload" href="/lumen/commons-4c36ffabef1434ec1126.js"/><link as="script" rel="preload" href="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js"/><link as="script" rel="preload" href="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"/><link as="fetch" rel="preload" href="/lumen/page-data/posts/2018-02-14-running-scalable-reliable-graphql-endpoint-with-serverless/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/lumen/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;color:inherit" href="/lumen/">Gatsby Starter Blog</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">Running a scalable &amp; reliable GraphQL endpoint with Serverless</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">February 14, 2018</p></header><section><p><em>New to AppSync?</em> Check out this <a href="https://serverless.com/aws-appsync/">Ultimate Guide to AWS AppSync</a></p>
<ul>
<li>Part 1: GraphQL endpoints with API Gateway + AWS Lambda (this post)</li>
<li>Part 2: <a href="https://medium.com/@sid88in/running-a-scalable-reliable-graphql-endpoint-with-serverless-24c3bb5acb43">AppSync Backend: AWS Managed GraphQL Service</a></li>
<li>Part 3: <a href="https://hackernoon.com/running-a-scalable-reliable-graphql-endpoint-with-serverless-db16e42dc266">AppSync Frontend: AWS Managed GraphQL Service</a></li>
</ul>
<h4>Introduction</h4>
<p>Over the last four years, I’ve been exploring the world of big data, building real-time and batch systems at scale. For the last couple of months, I’ve been developing products with serverless architectures here at Glassdoor.</p>
<p>Given the intersection of serverless and big data, there have been a few questions on everyone’s mind:</p>
<ol>
<li>How can we build low latency APIs to serve complex, high dimensional and big datasets?</li>
<li>Using a single query, can we construct a nested response from multiple data sources?</li>
<li>Can we build an endpoint which can securely aggregate and paginate through data and with high performance?</li>
<li>And is there a way we can do all of that at scale, paying only for each query execution, and not for idle CPU time?</li>
</ol>
<p>The answer for us ended up largely being GraphQL.</p>
<p>This post aims to show you how you too can streamline your existing workflow and handle complexity with ease. While I won’t be digging deep into specific things Glassdoor was working on, I <em>will</em> be showing you a pretty related example that utilizes a mini Twitter clone I made.</p>
<p>Ready to talk about creating Serverless GraphQL endpoints using DynamoDB, RDS and the Twitter REST API? Ready to see a sweet performance comparison? Ready to hear some solid techniques on how you can convince the backend team that using GraphQL is a great idea?</p>
<p>Awesome. Let’s go.</p>
<p><strong>Note</strong> For the GraphQL and Serverless primer, keep reading. Or <a href="https://serverless.com/blog/running-scalable-reliable-graphQL-endpoint-with-serverless/#serverless-graphql-repository">click here to go straight to the code walkthrough</a></p>
<h4>What is GraphQL?</h4>
<p>I’m going to start this off by stating a fact: The way we currently build APIs, as a collection of micro-services that are all split up and maintained separately, isn’t optimal. If you’re a fellow back-end or front-end engineer, you’re probably familiar with this struggle.</p>
<p>Luckily for us, the tech horizon is ever-expanding. We have options. And we should use them.</p>
<p><a href="https://dev-blog.apollodata.com/2017-the-year-in-graphql-124a050d04c6">GraphQL</a> lets you shrink your multitude of APIs down into a single HTTP endpoint, which you can use to fetch data from multiple data sources.</p>
<p>In short, it lets you:</p>
<ol>
<li>Reduce network costs and get better query efficiency.</li>
<li>Know exactly what your response will look like and ensure you’re never sending more or less than the client needs.</li>
<li>Describe your API with types that map your schema to existing backends.</li>
</ol>
<p>Thousands of companies are now using GraphQL in production with the help of open source frameworks built by Facebook, Apollo, and Graphcool. <a href="https://twitter.com/davidbrunelle/status/960946257643454464">Starbucks uses it to power their store locator</a>. When I read that, it made my morning coffee taste even better. 😉</p>
<p><img src="https://user-images.githubusercontent.com/1587005/36067514-503a05b4-0e73-11e8-9b40-946c5398f4b5.png" title="Danielle&#x27;s slide from Serverless and GraphQL meetup at Glassdoor, Jan 29, 2018"></p>
<p>Very reasonably, you are probably thinking, “Yeah, okay, Facebook is one thing; they have a giant engineering team. But for me, having only one API endpoint is too risky. What if it goes down? How do I handle that much load? What about security?”</p>
<p>You are absolutely correct: with one HTTP endpoint, you need to be entirely sure that endpoint never goes down and that it scales on demand.</p>
<p>That’s where serverless comes in.</p>
<h4>What is Serverless?</h4>
<p>Serverless has gained popularity over last few years, primarily because it gives developers flexibility.</p>
<p>With Serverless comes the following:</p>
<ol>
<li>No server management (no need to manage any form of machine)</li>
<li>Pay-per-execution (never pay for idle)</li>
<li>Auto-scale (scale based on demand)</li>
<li>Function as a unit of application logic</li>
</ol>
<h4>What makes Serverless and GraphQL such a great fit?</h4>
<p>When moving to GraphQL, you suddenly rely on one HTTP endpoint to connect your clients to your backend services. Once you do decide to do that, you want this one HTTP endpoint to be: reliable, fast, auto-scaling and have a small attack vector regarding security.</p>
<blockquote>
<p><em>All</em> these properties are fulfilled by a single AWS Lambda function in combination with an API Gateway. It’s just a great fit!</p>
</blockquote>
<p>In sum, powering your GraphQL endpoint with a serverless backend solves scaling and availability concerns outright, and it gives you a big leg up on security. It’s not even that much code or configuration.</p>
<p>It takes only a few minutes to get to a production-ready setup, which we’re about to dive into, right now.</p>
<h4>Serverless-GraphQL repository</h4>
<p>With the shiny new <a href="https://github.com/serverless/serverless-graphql">Serverless and GraphQL Repository</a>, it’s incredibly straightforward to get your HTTP endpoint up and running.</p>
<p><img src="https://user-images.githubusercontent.com/1587005/36035218-1c06763c-0d6b-11e8-996b-996243b0975f.png" alt="alt text" title="Serverless and GraphQL Architecture"></p>
<p>The repository comes in two flavors: API Gateway + Lambda backend, or AppSync backend. (More backend integrations, including <a href="https://github.com/graphcool/prisma">Graphcool Prisma</a>, Druid, MongoDB, and AWS Neptune, forthcoming.)</p>
<p><strong>Note:</strong> I’m going to focus on AWS Lambda below, but know that you can use any serverless provider (Microsoft Azure, Google Cloud Functions, etc.) with GraphQL.</p>
<h4>Let’s create a Serverless GraphQL Endpoint</h4>
<p>To create this endpoint, I’m going to be using the <a href="https://www.npmjs.com/package/apollo-server-lambda"><code class="language-text">Apollo-Server-Lambda</code></a> package from npm. (You can also use <code class="language-text">Express</code>, <code class="language-text">Koa</code>, or <code class="language-text">Hapi</code> frameworks but I prefer less complexity and more simplicity). Also, to make your endpoint production ready, you might want to integrate the lambda function with <code class="language-text">Cloudwatch-metrics</code>, <code class="language-text">AWS X-Ray</code> or <a href="https://www.apollographql.com/engine/"><code class="language-text">Apollo Engine</code></a> for monitoring and debugging.</p>
<p>Some of the main components of building your endpoint are (with links to <a href="https://github.com/serverless/serverless-graphql">serverless-graphql</a> repo):</p>
<ol>
<li><a href="https://github.com/serverless/serverless-graphql/blob/master/app-backend/dynamodb/handler.js#L14">handler.js</a>: lambda function handler to route HTTP requests and return the response.</li>
<li><a href="https://github.com/serverless/serverless-graphql/blob/master/app-backend/dynamodb/serverless.yml#L34">serverless.yml</a>: creates AWS resources and sets up the GraphQL endpoint.</li>
<li><a href="https://github.com/serverless/serverless-graphql/blob/master/app-backend/dynamodb/schema.js">schema.js</a>: defines our GraphQL schema we’re using to build this mini Twitter app.</li>
<li><a href="https://github.com/serverless/serverless-graphql/blob/master/app-backend/dynamodb/resolvers.js">resolver.js</a>: defines query handler functions to fetch data from our other services (RDS, REST, DynamoDB, etc.).</li>
</ol>
<h5>Step 1: Configure the Serverless template</h5>
<p>We’ll be using the <a href="https://serverless.com/framework/">Serverless Framework</a> to build and deploy your API resources quickly. If you don’t have the Framework installed, get it with <code class="language-text">npm install serverless -g</code>.</p>
<p>To start, specify in your <code class="language-text">serverless.yml</code> that you are setting up a GraphQL HTTP endpoint:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">functions<span class="token operator">:</span>
  graphql<span class="token operator">:</span>
    handler<span class="token operator">:</span> handler<span class="token punctuation">.</span>graphqlHandler
    events<span class="token operator">:</span>
    <span class="token operator">-</span> http<span class="token operator">:</span>
        path<span class="token operator">:</span> graphql
        method<span class="token operator">:</span> post
        cors<span class="token operator">:</span> <span class="token boolean">true</span></code></pre></div>
<p>Now, any HTTP POST event on the path <code class="language-text">/graphql</code> will trigger the <code class="language-text">graphql</code> Lambda function, and will be handled by <code class="language-text">graphqlHandler</code>.</p>
<h5>Step 2: Configure the Lambda function (Apollo-Server-Lambda)</h5>
<p>Set up the callback to Lambda in your <code class="language-text">handler.js</code> file:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> graphqlLambda<span class="token punctuation">,</span> graphiqlLambda <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'apollo-server-lambda'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> makeExecutableSchema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'graphql-tools'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> schema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./schema'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolvers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./resolvers'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> myGraphQLSchema <span class="token operator">=</span> <span class="token function">makeExecutableSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  typeDefs<span class="token operator">:</span> schema<span class="token punctuation">,</span>
  resolvers<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">graphqlHandler</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">graphqlHandler</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">callbackWithHeaders</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> output</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// eslint-disable-next-line no-param-reassign</span>
    output<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'*'</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">graphqlLambda</span><span class="token punctuation">(</span><span class="token punctuation">{</span> schema<span class="token operator">:</span> myGraphQLSchema <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callbackWithHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>In your Lambda function, GraphQL Schema and Resolvers will be imported (as I’ll explain further in a minute).</p>
<p>Once API Gateway triggers an event, the  <code class="language-text">graphqlLambda</code> function will handle it. The response is sent back to the client.</p>
<h5>Step 3: Create a GraphQL schema</h5>
<p>For this post, I am going to focus on a subset of the schema to keep things simple—I’ll handle mutations and subscriptions in a future post:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span>
    <span class="token attr-name">getUserInfo</span><span class="token punctuation">(</span><span class="token attr-name">handle</span><span class="token punctuation">:</span> String<span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> User<span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Tweet</span> <span class="token punctuation">{</span>
    <span class="token attr-name">tweet_id</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
    <span class="token attr-name">tweet</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
    <span class="token attr-name">handle</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
    <span class="token attr-name">created_at</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">TweetConnection</span> <span class="token punctuation">{</span>
    <span class="token attr-name">items</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Tweet<span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span>
    <span class="token attr-name">nextToken</span><span class="token punctuation">:</span> String
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token attr-name">name</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
    <span class="token attr-name">description</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
    <span class="token attr-name">followers_count</span><span class="token punctuation">:</span> Int<span class="token operator">!</span>
    <span class="token attr-name">following</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>String<span class="token operator">!</span><span class="token punctuation">]</span><span class="token operator">!</span>
    <span class="token attr-name">topTweet</span><span class="token punctuation">:</span> Tweet
    <span class="token attr-name">tweets</span><span class="token punctuation">(</span><span class="token attr-name">limit</span><span class="token punctuation">:</span> Int<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token attr-name">nextToken</span><span class="token punctuation">:</span> String<span class="token punctuation">)</span><span class="token punctuation">:</span> TweetConnection
<span class="token punctuation">}</span></code></pre></div>
<h5>Step 4: Create your GraphQL resolvers</h5>
<p>Still with me? Great. Let’s dive deep into how Lambda retrieves data from DynamoDB, RDS and, the REST backend.</p>
<p>We’ll use the <code class="language-text">getUserInfo</code> field as an example. This field takes a Twitter handle as input and returns that user’s personal and tweet info.</p>
<h5>Setting up the DynamoDB backend</h5>
<p>First, we’ll create two tables (<code class="language-text">Users</code> and <code class="language-text">Tweets</code>) to store user and tweet info respectively. We’ll also be using Global Secondary Index (<code class="language-text">tweet-index</code>) on Tweets table to sort all user tweets by timestamp.</p>
<p>These resources will be created using the <a href="https://github.com/serverless/serverless-graphql/blob/master/app-backend/dynamodb/serverless.yml#L60"><code class="language-text">serverless.yml</code></a>:</p>
<p><strong>Table</strong>: <em>User</em>
<strong>HashKey</strong>: <em>handle</em>
<strong>Attributes</strong>: <em>name</em>, <em>description</em>, <em>followers</em>count_</p>
<p><strong>Table</strong>: <em>Tweets</em>
<strong>HashKey</strong>: <em>tweet</em>id_
<strong>Attributes</strong>: <em>tweet</em>, <em>handle</em>, <em>created</em>at_
<strong>Index</strong>: <em>tweet-index</em> <em>(hashKey: handle, sortKey: created</em>at)_</p>
<p>At this point, you’ll need to mock fake data using <a href="https://www.npmjs.com/package/faker">Faker</a>.</p>
<p>You’ll <em>also</em> need to make sure your IAM Roles are set properly in the <code class="language-text">serverless.yml</code>, so that Lambda can access DynamoDB. These are defined in the <code class="language-text">serverless.yml</code> file in the repository.</p>
<p>If you’re interested in knowing more about IAM permissions, <a href="https://serverless.com/blog/abcs-of-iam-permissions/">here’s an excellent primer</a>.</p>
<h5>Creating the GraphQL resolver</h5>
<p>Let’s set it up for <code class="language-text">getUserInfo</code> to retrieve data from DynamoDB. I’ll be breaking down the code for you.</p>
<p>First of all, we need to define how the <code class="language-text">getUserInfo</code> and <code class="language-text">tweets</code> fields will fetch the data:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span>
  Query<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getUserInfo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  User<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">tweets</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getPaginatedTweets</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>handle<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Then we’ll query the DynamoDB table index, <code class="language-text">tweet-index</code>, to retrieve paginated tweets for a given user handle. Passing the <code class="language-text">nextToken</code> parameter implies paginating through the result set, which is passed as <code class="language-text">ExclusiveStartKey</code>.</p>
<p>If the result contains <code class="language-text">LastEvaluatedKey</code> (as shown <a href="https://github.com/serverless/serverless-graphql/blob/master/app-backend/dynamodb/resolvers.js#L67">here</a>), then return it as <code class="language-text">nextToken</code>:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">  <span class="token function">getPaginatedTweets</span><span class="token punctuation">(</span><span class="token parameter">handle<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
        TableName<span class="token operator">:</span> <span class="token string">'Tweets'</span><span class="token punctuation">,</span>
        KeyConditionExpression<span class="token operator">:</span> <span class="token string">'handle = :v1'</span><span class="token punctuation">,</span>
        ExpressionAttributeValues<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">':v1'</span><span class="token operator">:</span> handle<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        IndexName<span class="token operator">:</span> <span class="token string">'tweet-index'</span><span class="token punctuation">,</span>
        Limit<span class="token operator">:</span> args<span class="token punctuation">.</span>limit<span class="token punctuation">,</span>
        ScanIndexForward<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>nextToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">.</span>ExclusiveStartKey <span class="token operator">=</span> <span class="token punctuation">{</span>
          tweet_id<span class="token operator">:</span> args<span class="token punctuation">.</span>nextToken<span class="token punctuation">.</span>tweet_id<span class="token punctuation">,</span>
          created_at<span class="token operator">:</span> args<span class="token punctuation">.</span>nextToken<span class="token punctuation">.</span>created_at<span class="token punctuation">,</span>
          handle<span class="token operator">:</span> handle<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      docClient<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//then parse the result</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>For the <code class="language-text">getUserInfo</code> field, you can similarly retrieve the results as shown below:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">  <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=></span>
      docClient<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
          TableName<span class="token operator">:</span> <span class="token string">'Users'</span><span class="token punctuation">,</span>
          KeyConditionExpression<span class="token operator">:</span> <span class="token string">'handle = :v1'</span><span class="token punctuation">,</span>
          ExpressionAttributeValues<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">':v1'</span><span class="token operator">:</span> args<span class="token punctuation">.</span>handle<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        callback
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token comment">//then parse the result</span>
 <span class="token punctuation">}</span></code></pre></div>
<p>The end result? You’ve got a GraphQL endpoint that reliably scales! 💥</p>
<p>Let’s test it out locally and then deploy it to production.</p>
<h5>Clone the Git repo and install dependencies</h5>
<div class="gatsby-highlight" data-language="commandline"><pre class="language-commandline"><code class="language-commandline">git clone https://github.com/serverless/serverless-graphql.git

cd app-backend/dynamodb
yarn install</code></pre></div>
<p>To test the GraphQL endpoint locally on my machine, I’m using these three plugins for the Serverless Framework: <a href="https://github.com/dherault/serverless-offline">Serverless Offline</a>, <a href="https://github.com/serverless-heaven/serverless-webpack">Serverless Webpack</a> and <a href="https://github.com/99xt/serverless-dynamodb-local">Serverless DynamoDB Local</a>.</p>
<p>These plugins make it super easy to run the entire solution E2E locally without any infrastructure. It will also help us debug issues faster.</p>
<p>If you’ve followed me this far, DynamoDB will now be available and running on your local machine at <code class="language-text">http://localhost:8000/shell</code>:</p>
<p><img src="https://user-images.githubusercontent.com/1587005/36065162-b4ad3c14-0e4b-11e8-8776-e19596546ce1.gif" alt="!Live Example"></p>
<p>For deploying your endpoint in production, please run:</p>
<div class="gatsby-highlight" data-language="commandline"><pre class="language-commandline"><code class="language-commandline">cd app-backend/dynamodb
yarn deploy-prod</code></pre></div>
<p><strong>Note:</strong> We also have a previous post on <a href="https://serverless.com/blog/make-serverless-graphql-api-using-lambda-dynamodb/">making a serverless GraphQL API</a>, which covers the process in more detail.</p>
<h5>Setting up the RDS backend</h5>
<p>DynamoDB is great for fetching data by a set of keys; but using a relational database like RDS will provide us the flexibility to model complex relationships and run aggregation mechanisms at runtime.</p>
<p>Let’s look at the process of connecting your Lambda to RDS.</p>
<p>We have explained the requirements to set up RDS in production in the <a href="https://github.com/serverless/serverless-graphql#setup-for-production-deploy-resources-to-aws">readme</a>, but you can test your GraphQL endpoint locally using SQLite3 (without any AWS infrastructure). Boom!</p>
<h5>Data modeling and table creation</h5>
<p>We will create two tables (<code class="language-text">Users</code> and <code class="language-text">Tweets</code>) to store user and tweet info respectively, as described <a href="https://github.com/serverless/serverless-graphql/blob/master/app-backend/rds/migrations/20171204204927_setup.js">here</a>.</p>
<p><strong>Table</strong>: <em>User</em>
<strong>Primary Key</strong>: <em>user</em>id_
<strong>Attributes</strong>: <em>name</em>, <em>description</em>, <em>followers</em>count_</p>
<p><strong>Table</strong>: <em>Tweets</em>
<strong>Primary Key</strong>: <em>tweet</em>id_
<strong>Attributes</strong>: <em>tweet</em>, <em>handle</em>, <em>created</em>at<em>, _user</em>id_</p>
<p>Then, you’ll need to use Faker again to mock some fake data.</p>
<p>Set your Lambda in the same VPC as RDS for connectivity, and configure knexfile for database configuration in development and production environment.</p>
<p>(The serverless-graphql repo supports connecting to SQLite, MySQL, Aurora, or Postgres using <a href="http://knexjs.org/">Knex configurations</a>—a powerful query builder for SQL databases and Node.js.)</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> pg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  development<span class="token operator">:</span> <span class="token punctuation">{</span>
    client<span class="token operator">:</span> <span class="token string">'sqlite3'</span><span class="token punctuation">,</span>  <span class="token comment">// in development mode you can use SQLite</span>
    connection<span class="token operator">:</span> <span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'./dev.db'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  production<span class="token operator">:</span> <span class="token punctuation">{</span>
    client<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_TYPE</span> <span class="token operator">===</span> <span class="token string">'pg'</span> <span class="token operator">?</span> <span class="token string">'pg'</span> <span class="token operator">:</span> <span class="token string">'mysql'</span><span class="token punctuation">,</span> <span class="token comment">// in production mode you can use PostgresQL, MySQL or Aurora</span>
    connection<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_URL</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Let’s go ahead and write our resolver functions.</p>
<p>The knex ORM layer queries the <code class="language-text">User</code> table to resolve <code class="language-text">getUserInfo</code> and returns a list of user attributes. Then, we join both <code class="language-text">Tweets</code> and <code class="language-text">Users</code> tables on <code class="language-text">user_id</code> to resolve <code class="language-text">tweets</code>. In the end, <code class="language-text">topTweet</code> is returned using <code class="language-text">where</code>, <code class="language-text">limit</code> and <code class="language-text">orderBy</code> clauses.</p>
<p>And it just works!</p>
<p>Here’s the <code class="language-text">getUserInfo</code> resolver:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> resolvers <span class="token operator">=</span> <span class="token punctuation">{</span>
  Query<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getUserInfo</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=></span>
      <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">'Users'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'handle'</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span>handle<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">users</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> user <span class="token operator">=</span> users<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'User not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> user<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>Here’s the <code class="language-text">tweets</code> resolver:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">  User<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">tweets</span><span class="token operator">:</span> <span class="token parameter">obj</span> <span class="token operator">=></span>
      knex
        <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'Tweets'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">leftJoin</span><span class="token punctuation">(</span><span class="token string">'Users'</span><span class="token punctuation">,</span> <span class="token string">'Tweets.user_id'</span><span class="token punctuation">,</span> <span class="token string">'Users.user_id'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'handle'</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>handle<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">posts</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>posts<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'User not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          tweets <span class="token operator">=</span> <span class="token punctuation">{</span> items<span class="token operator">:</span> posts <span class="token punctuation">}</span><span class="token punctuation">;</span>

          <span class="token keyword">return</span> tweets<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>And here’s the <code class="language-text">topTweet</code> resolver:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">  User<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">topTweet</span><span class="token operator">:</span> <span class="token parameter">obj</span> <span class="token operator">=></span>
      <span class="token function">knex</span><span class="token punctuation">(</span><span class="token string">'Tweets'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'handle'</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span>handle<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">'retweet_count'</span><span class="token punctuation">,</span> <span class="token string">'desc'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">tweet</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tweet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'User not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> tweet<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<p>Run it locally on your machine (RDS instance not required).</p>
<h5>Kickstart on local using SQLite</h5>
<div class="gatsby-highlight" data-language="commandline"><pre class="language-commandline"><code class="language-commandline">cd app-backend/rds
yarn install
yarn start</code></pre></div>
<p>And deploy to production:</p>
<div class="gatsby-highlight" data-language="commandline"><pre class="language-commandline"><code class="language-commandline">cd app-backend/rds
yarn deploy-prod</code></pre></div>
<p><strong>Note</strong>: When running in production, please make sure your database endpoint is configured correctly in <code class="language-text">config/security.env.prod</code>.</p>
<h5>REST wrapper</h5>
<p>Last but not least—it’s time for the REST API backend!</p>
<p>This use case is the most common when you have pre-existing microservices, and you want to wrap them around GraphQL. Don’t worry; it’s easier than you think.</p>
<p>We’ll fetch data from <a href="https://developer.twitter.com/en/docs">Twitter’s REST API</a>, but it could very well be your own REST API. You’ll need to create OAuth tokens <a href="https://apps.twitter.com/">here</a>, OR use these <a href="https://github.com/serverless/serverless-graphql/blob/master/config/security.env.local">test account tokens</a> for faster setup.</p>
<p>In this case, we don’t need to create tables or mock data because we will be querying real data. Let’s look at how to resolve <code class="language-text">following</code> field to find a list of <code class="language-text">Users</code> being followed.</p>
<p>The <code class="language-text">consumerKey</code>, <code class="language-text">consumerSecret</code> and handle are passed as an input to the <code class="language-text">friends/list</code> API:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> OAuth2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'oauth'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Twitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'twitter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getFollowing</span><span class="token punctuation">(</span><span class="token parameter">handle<span class="token punctuation">,</span> consumerKey<span class="token punctuation">,</span> consumerSecret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'friends/list'</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> oauth2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OAuth2</span><span class="token punctuation">(</span>
    consumerKey<span class="token punctuation">,</span>
    consumerSecret<span class="token punctuation">,</span>
    <span class="token string">'https://api.twitter.com/'</span><span class="token punctuation">,</span>
    <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token string">'oauth2/token'</span><span class="token punctuation">,</span>
    <span class="token keyword">null</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    oauth2<span class="token punctuation">.</span><span class="token function">getOAuthAccessToken</span><span class="token punctuation">(</span>
      <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        grant_type<span class="token operator">:</span> <span class="token string">'client_credentials'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> accessToken</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">accessToken</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Twitter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        consumer_key<span class="token operator">:</span> consumerKey<span class="token punctuation">,</span>
        consumer_secret<span class="token operator">:</span> consumerSecret<span class="token punctuation">,</span>
        bearer_token<span class="token operator">:</span> accessToken<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span> screen_name<span class="token operator">:</span> handle <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> client
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token punctuation">)</span>
      <span class="token comment">//then parse the result</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Note:</strong> A complete example is given <a href="https://raw.githubusercontent.com/serverless/serverless-graphql/master/app-backend/rest-api/resolvers.js">here</a>. You can also check out Saeri’s walkthrough on building a <a href="https://serverless.com/blog/3rd-party-rest-api-to-graphql-serverless/">Serverless GraphQL Gateway on top of a 3rd Party REST API</a>.</p>
<p>Go ahead and run it locally on your machine:</p>
<div class="gatsby-highlight" data-language="commandline"><pre class="language-commandline"><code class="language-commandline">cd app-backend/rest-api
yarn install
yarn start</code></pre></div>
<p>And deploy to production:</p>
<div class="gatsby-highlight" data-language="commandline"><pre class="language-commandline"><code class="language-commandline">cd app-backend/rest-api
yarn deploy-prod</code></pre></div>
<h4>Client Integrations (Apollo ReactJS, Netlify, and S3)</h4>
<p>The serverless-graphql repository comes with two client implementations</p>
<ol>
<li><a href="https://dev-blog.apollodata.com/apollo-client-2-0-beyond-graphql-apis-888807b53afe">Apollo Client 2.0</a></li>
<li><a href="https://dev-blog.apollodata.com/aws-appsync-powered-by-apollo-df61eb706183">AppSync Client</a></li>
</ol>
<p>If you are new to the ReactJs + Apollo Integration, I would recommend going through <a href="https://www.learnapollo.com/tutorial-react/react-01/">these tutorials</a>.</p>
<p>The code for apollo-client in the serverless-graphql repo is <a href="https://github.com/serverless/serverless-graphql/tree/master/app-client/apollo-client">here</a>.</p>
<p>To start the client on local, first start any backend service on local. For example:</p>
<div class="gatsby-highlight" data-language="commandline"><pre class="language-commandline"><code class="language-commandline">cd app-backend/rest-api
yarn install
yarn start</code></pre></div>
<p>Now, make sure <code class="language-text">http://localhost:4000/graphiql</code> is working.</p>
<p>If you kickstart Apollo Client (as shown below), you will have a react server running on your local machine. The setup is created using <a href="https://github.com/facebook/create-react-app">create react app</a>:</p>
<div class="gatsby-highlight" data-language="commandline"><pre class="language-commandline"><code class="language-commandline">cd app-client/apollo-client
yarn install
yarn start</code></pre></div>
<p><img src="https://user-images.githubusercontent.com/1587005/36068493-de82620e-0e8b-11e8-887b-e1593cd3c8cc.gif" alt="!Live Example"></p>
<p>In production, you can also deploy the client on Netlify or AWS S3. Please follow the instructions <a href="https://github.com/serverless/serverless-graphql#setup-for-production-deploy-resources-to-aws">here</a>.</p>
<h4>Performance Analysis</h4>
<p>Which brings us to the best part. Let’s dive into the performance of our Serverless GraphQL endpoint.</p>
<p>We can measure the E2E latency of the API call by adding the network delay, <a href="https://serverless.com/amazon-api-gateway/">AWS API Gateway</a> response time, and AWS Lambda execution time, which includes execution time of the backend query. For this analysis, my setup consists of:</p>
<p><em>Baseline Dataset</em>: 500 Users, 5000 Tweets (10 tweets per user) where each user record is less than 1 KB in size.</p>
<p><em>Region</em>: All the resources were created in aws us-east-1, and API calls were made from 2 EC2 nodes in the same region.</p>
<p><em>Lambda Memory size</em> = 1024 MB</p>
<h5>Lambda execution time with DynamoDB backend</h5>
<p>I simulated 500 users making the API call with a ramp-up period of 30 secs hitting two separate GraphQL endpoints (one with DynamoDB and the other one with PostgreSQL). All the 500 users posted the same payload; there is no caching involved for this analysis.</p>
<p>The service map below was created by <a href="https://aws.amazon.com/xray/">AWS X-Ray</a>:</p>
<p><img src="https://user-images.githubusercontent.com/1587005/36131686-dac3658a-1027-11e8-9d5d-4a435f5ae43b.png"></p>
<p>For 99% of the simulated calls, DynamoDB took less than 15ms; but 1% of the calls had high response times which resulted in overall avg latency of 25ms. The Lambda execution time was 60ms; the time spent on the Lambda service itself was 90ms on average (we can optimize the Lambda execution time, but not service time itself).</p>
<h5>Cold Starts</h5>
<p>Approximately 2% of the total calls were <a href="https://hackernoon.com/im-afraid-you-re-thinking-about-aws-lambda-cold-starts-all-wrong-7d907f278a4f">cold starts</a>. I noticed an additional latency of 700ms-800ms in Lambda execution time for the first API call, which came from initialization of the Lambda container itself.</p>
<p>This additional latency was observed in both endpoints (DynamoDB and PostgreSQL). There are ways to optimize this overhead, and I would strongly recommend you to <a href="https://serverless.com/blog/keep-your-lambdas-warm/">read up on them here</a>.</p>
<h5>Increase in Lambda memory size limit by 2x and 3x</h5>
<p>Increasing the lambda memory size by 2x (2048 MB) improved the overall latency of the Lambda service by 18%; increasing by 3x (3008 MB) improved the latency by 38%.</p>
<p>The latency of DynamoDB backend remained constant, and the Lambda execution time itself improved within 20% range for 3x memory:</p>
<table>
<thead>
<tr>
<th align="center">Lambda Service Latency (1GB Memory)</th>
<th align="center">Lambda Service Latency (2GB Memory)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img src="https://user-images.githubusercontent.com/1587005/36127284-87ae8f16-1011-11e8-9f9a-d1435a066d06.png"></td>
<td align="center"><img src="https://user-images.githubusercontent.com/1587005/36127303-959b9db2-1011-11e8-9fd4-1d9556a6dc25.png"></td>
</tr>
</tbody>
</table>
<h5>Lambda execution time with PostgreSQL backend</h5>
<p>With RDS, the Lambda execution time increased along with the size of the data.</p>
<p>When I increased the Tweets dataset by a factor of 100 (to 1000 tweets per user), I found the response time increased by 5x-10x. This possibly happens because we are joining the <code class="language-text">Tweets</code> and <code class="language-text">Users</code> tables on the fly, which results in more query execution time.</p>
<p>Query performance can be further improved by using indexing and other database optimizations. Conversely, DynamoDB latency remains constant with increasing dataset size (which is expected by design).</p>
<h5>API Gateway and Network Latency</h5>
<p>On average, the E2E response time of the GraphQL endpoint ranges from 100ms-200ms (including the Lambda execution time). Hence, on API Gateway the network latency is approximately between 40-100 ms, which can be further reduced by caching.</p>
<p>You might ask, “Why do we need API Gateway? Can’t we just use Lambda to fetch the GraphQL response?”</p>
<blockquote>
<p>Well. This analysis truly merits a separate blog of its own, where we can do an in-depth study of all the latencies and query optimizations. Or you can also <a href="https://forum.serverless.com/t/convince-me-to-use-api-gateway-and-not-call-lambda-direct/3214">read this forum discussion about it</a>.</p>
</blockquote>
<h4>Selling GraphQL in your organization</h4>
<blockquote>
<p>When using new tech, always a discussion of “do we want this, or not?”</p>
</blockquote>
<p>Ready to switch everything over, but not sure about how to convince the backend team? Well, here’s how I’ve seen this play out several times, with success.</p>
<p>First, the frontend team would wrap their existing REST APIs in a serverless GraphQL endpoint. It added some latency, but they were able to experiment with product changes way faster and could fetch only what was needed.</p>
<p>Then, they would use this superior workflow to gain even more buy-in. They would back up this buy-in by showing the backend team that nothing had broken so far.</p>
<p>Now I’m not <em>saying</em> you should do that, but also, if you wanted to, there it is for your consideration. My lips are sealed.</p>
<h4>Special thanks!</h4>
<p>First of all, I would like to thank <a href="https://twitter.com/nikgraf">Nik Graf</a>, <a href="https://twitter.com/pmmuens">Philipp Müns</a> and <a href="https://twitter.com/austencollins">Austen Collins</a> for kickstarting open source initiatives to help people build GraphQL endpoints easily on Serverless platforms. I have personally learned a lot during my work with you guys!</p>
<p>I would also like to give a shout to our open source committers - <a href="https://twitter.com/superpatell">Jon</a>, <a href="https://twitter.com/leopradel">Léo Pradel</a>, <a href="https://github.com/timsuchanek">Tim</a>, <a href="https://github.com/JstnEdr">Justin</a>,  <a href="https://github.com/serpentblade">Dan Kreiger</a> and <a href="https://github.com/serverless/serverless-graphql/graphs/contributors">others</a>.</p>
<p>Thanks <a href="https://twitter.com/andreapasswater">Andrea</a> and <a href="https://twitter.com/Saeris">Drake Costa</a> for reviewing the final draft of this post and <a href="https://twitter.com/richbuggy">Rich</a> for helping me out with questions.</p>
<p>Last but not the least, I would like to thank <a href="https://twitter.com/kruken">Steven</a> for introducing me to GraphQL.</p>
<p>I hope you guys liked my first blog post! Feel free to reach out and let me know what you think.</p>
<p>Siddharth Gupta</p>
<p><a href="https://github.com/sid88in">Github</a> | <a href="https://www.linkedin.com/in/sid88in/">LinkedIn</a> | <a href="https://twitter.com/sidg_sid">Twitter</a></p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAUBAgME/8QAFwEBAAMAAAAAAAAAAAAAAAAAAgABA//aAAwDAQACEAMQAAABtTuWpVlGVPBk0HAFf//EABsQAAICAwEAAAAAAAAAAAAAAAECAxMAESMk/9oACAEBAAEFAnOlgZ7cvIZnEYuxj6ZjxjOh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQEiH/2gAIAQMBAT8BwqOP/8QAGREAAQUAAAAAAAAAAAAAAAAAAAEQEiEx/9oACAECAQE/AbJCY3//xAAgEAABAgUFAAAAAAAAAAAAAAABABECAxASITFBYYGR/9oACAEBAAY/Ai2qYx3A0tPifYlsLBBT8qX3T//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hRVcZF9KXnJkRaRWsbCd3oQNMD6x1eoRshVw76T//2gAMAwEAAgADAAAAENvoAP/EABkRAAIDAQAAAAAAAAAAAAAAAAABESExUf/aAAgBAwEBPxCEpsj00xYf/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAEQESExUf/aAAgBAgEBPxBNs0X5A9n/xAAeEAEBAQACAQUAAAAAAAAAAAABEQAhMUFRYXGBkf/aAAgBAQABPxClwdnV0whQo4lO/wAzyyrjkGw+cZbkILxecbfXBH7zSeBntAmta2n5uEBbXZ4N/9k=" alt="Kyle Mathews" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" src="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg" alt="Kyle Mathews" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Kyle Mathews</strong> <!-- -->who lives and works in San Francisco building useful things.<!-- --> <a href="https://twitter.com/kylemathews">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/lumen/posts/2018-02-12-fantastic-serverless-security-risks-and-where-to-find-them/">← <!-- -->Fantastic Serverless security risks, and where to find them</a></li><li><a rel="next" href="/lumen/posts/2018-02-20-etl-job-processing-with-serverless-lambda-and-redshift/">ETL job processing with Serverless, Lambda, and AWS Redshift<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/2018-02-14-running-scalable-reliable-graphql-endpoint-with-serverless/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-36e457a5393b79b99515.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9578b926700cf49bb4fc.js"],"component---src-pages-index-js":["/component---src-pages-index-js-753a3f9bde0636fce206.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-f16d60f62c7d2b3e9bcc.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"]};/*]]>*/</script><script src="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js" async=""></script><script src="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js" async=""></script><script src="/lumen/commons-4c36ffabef1434ec1126.js" async=""></script><script src="/lumen/app-36e457a5393b79b99515.js" async=""></script><script src="/lumen/styles-cd63080e784be7b7e7cf.js" async=""></script><script src="/lumen/framework-5fc6169171e885c3b522.js" async=""></script><script src="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js" async=""></script></body></html>