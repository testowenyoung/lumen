<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/lumen/styles.1d0daeadf0762b76da98.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/lumen/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/lumen/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/lumen/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/lumen/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/lumen/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/lumen/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/lumen/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/lumen/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/lumen/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/lumen/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/lumen/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/lumen/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/lumen/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/lumen/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/lumen/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/lumen/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/lumen/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/lumen/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/lumen/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/lumen/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/lumen/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/lumen/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/lumen/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/lumen/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/lumen/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/lumen/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.23.12"/><link rel="alternate" type="application/rss+xml" href="/lumen/rss.xml"/><link rel="icon" href="/lumen/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/lumen/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/lumen/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/lumen/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/lumen/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/lumen/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/lumen/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/lumen/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/lumen/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/lumen/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">Creating a Serverless GraphQL Gateway on top of a 3rd Party REST API | Gatsby Starter Blog</title><meta data-react-helmet="true" name="description" content="Integrate GraphQL with Lambda; turn a 3rd party REST API to GraphQL. I built a microservice to interface with the Flickr API using Serverless, GraphQL and Hapi.js."/><meta data-react-helmet="true" property="og:title" content="Creating a Serverless GraphQL Gateway on top of a 3rd Party REST API"/><meta data-react-helmet="true" property="og:description" content="Integrate GraphQL with Lambda; turn a 3rd party REST API to GraphQL. I built a microservice to interface with the Flickr API using Serverless, GraphQL and Hapi.js."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="kylemathews"/><meta data-react-helmet="true" name="twitter:title" content="Creating a Serverless GraphQL Gateway on top of a 3rd Party REST API"/><meta data-react-helmet="true" name="twitter:description" content="Integrate GraphQL with Lambda; turn a 3rd party REST API to GraphQL. I built a microservice to interface with the Flickr API using Serverless, GraphQL and Hapi.js."/><link as="script" rel="preload" href="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js"/><link as="script" rel="preload" href="/lumen/framework-5fc6169171e885c3b522.js"/><link as="script" rel="preload" href="/lumen/styles-cd63080e784be7b7e7cf.js"/><link as="script" rel="preload" href="/lumen/app-36e457a5393b79b99515.js"/><link as="script" rel="preload" href="/lumen/commons-4c36ffabef1434ec1126.js"/><link as="script" rel="preload" href="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js"/><link as="script" rel="preload" href="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"/><link as="fetch" rel="preload" href="/lumen/page-data/posts/2017-10-19-3rd-party-rest-api-to-graphql-serverless/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/lumen/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;color:inherit" href="/lumen/">Gatsby Starter Blog</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">Creating a Serverless GraphQL Gateway on top of a 3rd Party REST API</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">October 24, 2017</p></header><section><h1>Introduction</h1>
<p>I’ve spent a huge chunk of the last year learning how to write GraphQL servers. It took a lot of manual sifting through dozens of blog posts, videos and source code.</p>
<p>I wanted to consolidate all this info into a single walk-through. If I’ve done my job right, it’s the only post you’ll need to get up and running with your own project.</p>
<p>We’re going step-by-step through the setup of my most recent project, <a href="https://github.com/Saeris/Flickr-Wormhole">Flickr-Wormhole</a>: a GraphQL to REST API Gateway built on top of Serverless and AWS Lambda, using <a href="https://github.com/apollographql/apollo-server#hapi">Apollo-Server-Hapi</a> (to provide a modern interface to that aging Flickr API).</p>
<p>Let’s get started!</p>
<h1>Background</h1>
<p>As a web developer, I relish the challenge of building my personal website from scratch. It’s a great opportunity to spend way too much time on creative solutions to weird problems.</p>
<p>My most recent challenge? Adding a gallery to showcase my photography. To ship this feature I had a handful of requirements to work around, which ultimately led me to creating the solution we’ll be covering today:</p>
<ul>
<li>My site is statically generated and hosted on Netlify—no admin console to add/manage photos.</li>
<li>I didn’t want to upload my photos along with the rest of the site; it’s being built from a GitHub repo, and would require me to write scripts for generating different image sizes for mobile.</li>
<li>The gallery should be able to display titles, descriptions, EXIF metadata, geolocation, tags, comments, etc.</li>
<li>Uploading/managing photos should fit into my existing photo editing workflow—I didn’t want to create unnecessary steps.</li>
<li>The image hosting solution needed to be dirt cheap, preferably free.</li>
<li>Most importantly: as my site was designed to be a Progressive Web App, data retrieval had to be done in as few network requests as possible.</li>
</ul>
<p>I decided to save myself a lot of coding and piggyback off Flickr for the majority of this work. It already had most of what I needed: free, generates a range of image sizes, public API and Adobe Lightroom integration for bulk uploads all in the press of a button.</p>
<p>That just left me with one “little” problem: having to use Flickr’s horribly outdated REST API.</p>
<p>So you fully feel my pain, here’s a quick look at what that process was like.</p>
<h1>The Old Way</h1>
<p>Remember, I wanted to minimize my number of requests.</p>
<p>Here’s the <em>bare</em> minimum with Flickr’s REST:</p>
<ol>
<li>Get the <code class="language-text">userId</code> of the Flickr user whose albums (referred to as ‘photosets’) I wanted to grab photos from</li>
<li>Use <code class="language-text">flickr.photosets.getList</code> with our <code class="language-text">userId</code> to get a list of <code class="language-text">photosetId</code>s for that user</li>
<li>Use <code class="language-text">flickr.photosets.getPhotos</code> using those two ids to get a list of <code class="language-text">photoId</code>s for that album</li>
<li>Use <code class="language-text">flickr.photos.getSizes</code> for each of those <code class="language-text">photoId</code>s for a list of URLs linking to automatically generated images for those photos (or use the <code class="language-text">id</code>, <code class="language-text">secret</code> and <code class="language-text">server</code> fields from the previous response to construct the URLs manually)</li>
</ol>
<p>I, however, would need to make even more: a call to <code class="language-text">flickr.photosets.getInfo</code> to get info about the album (title, description, number of views, comments…), a call <em>per photo</em> to <code class="language-text">flickr.photos.getInfo</code> to get its title, caption, views, comments &#x26; tags, and another call per photo to <code class="language-text">flickr.photos.getExif</code> to get the EXIF metadata, a call to <code class="language-text">flickr.photos.getSizes</code> to <a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images">build out a responsive <code class="language-text">img</code> element</a> for each photo in the gallery…</p>
<p>For a 100 photo album, I’d need 303 network requests. <em>\</em>groans<em>\</em> How about we not do that?</p>
<p>And it got worse. The response data was a mess to handle. The <code class="language-text">photos</code> count was represented as a <code class="language-text">string</code>, <code class="language-text">views</code> was a <code class="language-text">number</code>, the <code class="language-text">title</code> and <code class="language-text">description</code> were nested in an unnecessary object under a <code class="language-text">_content</code> key, and the dates were either formatted as a UNIX timestamp or a MySQL DateTime value wrapped in a <code class="language-text">string</code>.</p>
<p>Surely, I thought, there must be a better way.</p>
<h1>The New Way - GraphQL</h1>
<p>Enter: GraphQL!</p>
<p>Why GraphQL? So glad you asked. Let’s go back to those 300+ requests from earlier. I can now grab all of that data in <strong>one</strong> request using a query that looks a bit like this:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> User <span class="token punctuation">{</span>
  user<span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token string">"146688070@N05"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    albums<span class="token punctuation">(</span><span class="token attr-name">filter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">slug</span><span class="token punctuation">:</span> <span class="token string">"fanime-2017"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      title
      description
      views
      photos<span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token attr-name">orderBy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">field</span><span class="token punctuation">:</span> taken <span class="token attr-name">sort</span><span class="token punctuation">:</span> desc<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        title
        caption
        views
        tags <span class="token punctuation">{</span>
          text
        <span class="token punctuation">}</span>
        images<span class="token punctuation">(</span><span class="token attr-name">filter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">size</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Small<span class="token punctuation">,</span> Medium<span class="token punctuation">,</span> Large<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          source
          width
          height
        <span class="token punctuation">}</span>
        exif <span class="token punctuation">{</span>
          camera
          exposure
          aperture
          iso
          whiteBalance
          meteringMode
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Try it out yourself here: <a href="https://flickr.saeris.io/graphiql">https://flickr.saeris.io/graphiql</a></p>
<p>Not only did I grab all the data I needed to build out the UI in one request, I also got only the specific fields I asked for in exactly the same shape I requested it in. AND I was able to apply some powerful filtering techniques to boot.</p>
<blockquote>
<p><strong>note:</strong> While I won’t go into detail explaining what <a href="http://graphql.org/">GraphQL</a> is, I do want to make one thing clear: GraphQL is not concerned with sourcing your data. It’s not an ORM; it’s not a query language for a database. It’s merely a transport layer that sits in your server behind a single endpoint, taking requests from your clients. You supply GraphQL with a Schema describing the types of data your API can return, and it’s through resolver functions that the data is actually retrieved.</p>
</blockquote>
<blockquote>
<p>If you <em>do</em> want/need further background on GraphQL, there are numerous <a href="https://www.youtube.com/watch?v=wPPFhcqGcvk">talks</a>, <a href="https://medium.freecodecamp.org/so-whats-this-graphql-thing-i-keep-hearing-about-baf4d36c20cf">blog posts</a>, and <a href="https://www.howtographql.com/">tutorials</a> from the past year.</p>
</blockquote>
<h2>GraphQL Setup</h2>
<p>Since the Flickr API doesn’t yet have a GraphQL endpoint, I had to create my own GraphQL gateway server that proxies GraphQL queries into requests to Flickr’s REST interface.</p>
<p>To build the application, we’ll need:</p>
<ul>
<li>A GraphQL endpoint request handler;</li>
<li>An abstraction layer to programmatically build requests to Flickr’s REST API; and</li>
<li>A GraphQL Schema of queries mapped to Type definitions that describe our different data structures.</li>
</ul>
<h3>Building the Endpoint Request Handler</h3>
<p>The first step is to choose a GraphQL server implementation and set up the request handler. I’d used <a href="http://dev.apollodata.com/">Apollo</a> on the front-end and really enjoyed it, but Flickr didn’t have a GraphQL endpoint I could connect it to so I had to build one myself. Since I had a goal to reduce my network requests, I really liked Apollo for its <a href="https://dev-blog.apollodata.com/the-concepts-of-graphql-bc68bd819be3">automatic request caching</a>, which helps eliminate re-fetching.</p>
<p>After choosing Apollo, I needed to adapt it to work within Lambda’s function signature. Apollo does have a <a href="https://github.com/apollographql/apollo-server/tree/master/packages/apollo-server-lambda">solution specifically for AWS Lambda</a>. However, I chose to use the <a href="https://hapijs.com/">Hapi Node.js server framework</a> with <a href="https://github.com/apollographql/apollo-server#hapi">Apollo-Server-Hapi plugin</a>. I prefer Hapi as it allows for custom logging, monitoring and caching.</p>
<blockquote>
<p><strong>note:</strong> the setup outlined below was derived from <a href="http://www.carbonatethis.com/hosting-a-serverless-hapi-js-api-with-aws-lambda/">this article</a>.</p>
</blockquote>
<p>Let’s take a look at our <code class="language-text">serverless.yml</code> file:</p>
<p><strong>serverless.yml</strong></p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">service</span><span class="token punctuation">:</span> flickr<span class="token punctuation">-</span>wormhole

<span class="token key atrule">frameworkVersion</span><span class="token punctuation">:</span> <span class="token string">">=1.21.0 &lt;2.0.0"</span>

<span class="token key atrule">provider</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> aws
  <span class="token key atrule">runtime</span><span class="token punctuation">:</span> nodejs6.10
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">region</span><span class="token punctuation">:</span> us<span class="token punctuation">-</span>west<span class="token punctuation">-</span><span class="token number">2</span>

<span class="token key atrule">plugins</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> serverless<span class="token punctuation">-</span>webpack
  <span class="token punctuation">-</span> serverless<span class="token punctuation">-</span>offline

<span class="token key atrule">custom</span><span class="token punctuation">:</span>
  <span class="token key atrule">serverless-offline</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">1337</span>
  <span class="token key atrule">webpackIncludeModules</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">api</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> src/index.handler
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">"{proxy+}"</span>
          <span class="token key atrule">method</span><span class="token punctuation">:</span> any
          <span class="token key atrule">cors</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre></div>
<p>Pretty basic setup here, except for the handler path being set to <code class="language-text">&quot;{proxy+}&quot;</code>, which will pass our route to our request handler. In this case, we’ll have two routes: <code class="language-text">/graphql</code> and <code class="language-text">/graphiql</code>, but all routing will be handled within our handler function.</p>
<p>Our <code class="language-text">index.js</code> file contains our handler logic. This is doing the work to handle our Lambda function invocation, pull out the necessary HTTP elements that the Apollo server expects, and return the response from the Apollo server:</p>
<p><strong>index.js</strong></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> server <span class="token keyword">from</span> <span class="token string">"@/server"</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> path<span class="token punctuation">,</span> queryStringParameters<span class="token operator">:</span> params<span class="token punctuation">,</span> httpMethod<span class="token operator">:</span> method<span class="token punctuation">,</span> body<span class="token operator">:</span> payload<span class="token punctuation">,</span> headers <span class="token punctuation">}</span> <span class="token operator">=</span> event
  server<span class="token punctuation">.</span><span class="token function">makeReady</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err

    <span class="token keyword">let</span> url <span class="token operator">=</span> path
    <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> qs <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>qs<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>qs<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&amp;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>

    server<span class="token punctuation">.</span><span class="token function">inject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> payload<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> validate<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> statusCode<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> result<span class="token operator">:</span> body <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">delete</span> headers<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">content-encoding</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span>
      <span class="token keyword">delete</span> headers<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transfer-encoding</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> statusCode<span class="token punctuation">,</span> headers<span class="token punctuation">,</span> body <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The <code class="language-text">server.js</code> file contains our actual Hapi server:</p>
<p><strong>server.js</strong></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> hapi <span class="token keyword">from</span> <span class="token string">"hapi"</span>
<span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">"@/api"</span>
<span class="token keyword">import</span> graphiql <span class="token keyword">from</span> <span class="token string">"@/graphiql"</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">hapi<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">{</span> routes<span class="token operator">:</span> <span class="token punctuation">{</span> cors<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
  api<span class="token punctuation">,</span>
  graphiql
<span class="token punctuation">]</span>

<span class="token keyword">let</span> loaded <span class="token operator">=</span> <span class="token boolean">false</span>
server<span class="token punctuation">.</span><span class="token function-variable function">makeReady</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">onServerReady</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>loaded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    server<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>plugins<span class="token punctuation">,</span> onServerReady<span class="token punctuation">)</span>
    loaded <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token function">onServerReady</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> server</code></pre></div>
<p>In <code class="language-text">server.js</code> we’re defining a custom method, <code class="language-text">makeReady</code>, on our new Hapi server instance to register our plugins. In a server-full world, you’d want to call <code class="language-text">server.start()</code> in the callback for <code class="language-text">server.register()</code>. In the serverless world, we’re using <code class="language-text">server.inject()</code> to inject the HTTP request event from Lambda, because we’re not using Hapi to listen to HTTP events.</p>
<p>Note that we only register our plugins on the initial invocation to a particular Lambda instance. If we called <code class="language-text">server.register()</code> on every invocation of our Serverless event handler, Hapi would throw an error complaining that we’ve already registered the given plugins.</p>
<p>Now let’s take a look at our main GraphQL specific files used to create our endpoint: <code class="language-text">api.js</code>, <code class="language-text">graphiql.js</code>, and <code class="language-text">schema.js</code>.</p>
<p>First, we have the <code class="language-text">api.js</code> file which will define our main <code class="language-text">/graphql</code> endpoint:</p>
<p><code class="language-text">api.js</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> graphqlHapi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"apollo-server-hapi"</span>
<span class="token keyword">import</span> depthLimit <span class="token keyword">from</span> <span class="token string">'graphql-depth-limit'</span>
<span class="token keyword">import</span> queryComplexity <span class="token keyword">from</span> <span class="token string">"graphql-query-complexity"</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> loaders <span class="token keyword">from</span> <span class="token string">"@/loaders"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> formatError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/utilities"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> schema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/schema"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Flickr <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/flickr"</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  register<span class="token operator">:</span> graphqlHapi<span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">graphqlOptions</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
       <span class="token comment">// Create a new instance of our Flickr connector for each new GraphQL request</span>
      <span class="token keyword">const</span> flickr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Flickr</span><span class="token punctuation">(</span><span class="token constant">FLICKR_API_KEY</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        schema<span class="token operator">:</span> schema<span class="token punctuation">,</span>
        context<span class="token operator">:</span> <span class="token punctuation">{</span>
           <span class="token comment">// pass the connector instance to our resolvers and to the loaders which will cache per request</span>
          flickr<span class="token punctuation">,</span>
          album<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadAlbum</span><span class="token punctuation">(</span>flickr<span class="token punctuation">)</span><span class="token punctuation">,</span>
          albumPhotos<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadAlbumPhotos</span><span class="token punctuation">(</span>flickr<span class="token punctuation">)</span><span class="token punctuation">,</span>
          brands<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadBrands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          cameras<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadCamerasByBrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          photo<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadPhoto</span><span class="token punctuation">(</span>flickr<span class="token punctuation">)</span><span class="token punctuation">,</span>
          images<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadImages</span><span class="token punctuation">(</span>flickr<span class="token punctuation">)</span><span class="token punctuation">,</span>
          licenses<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadLicenses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          user<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadUser</span><span class="token punctuation">(</span>flickr<span class="token punctuation">)</span><span class="token punctuation">,</span>
          userAlbums<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadUserAlbums</span><span class="token punctuation">(</span>flickr<span class="token punctuation">)</span><span class="token punctuation">,</span>
          userPhotos<span class="token operator">:</span> loaders<span class="token punctuation">.</span><span class="token function">loadUserPhotos</span><span class="token punctuation">(</span>flickr<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        root_value<span class="token operator">:</span> schema<span class="token punctuation">,</span>
        formatError<span class="token operator">:</span> formatError<span class="token punctuation">,</span>
        validationRules<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token function">depthLimit</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Limits our queries to 4 levels of nesting.</span>
          <span class="token function">queryComplexity</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            maximumComplexity<span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
            variables<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">onComplete</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">complexity</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Determined query complexity: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>complexity<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">createError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">max<span class="token punctuation">,</span> actual</span><span class="token punctuation">)</span> <span class="token operator">=></span>
              <span class="token keyword">new</span> <span class="token class-name">GqlError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Query is too complex: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>actual<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Maximum allowed complexity: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>max<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        tracing<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        debug<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    route<span class="token operator">:</span> <span class="token punctuation">{</span> cors<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The exported object from <code class="language-text">api.js</code> is a Hapi plugin configuration, which we’ll pass along as part of an array to our <code class="language-text">server.register()</code> method on startup.</p>
<p>There are a couple interesting things to note:</p>
<ol>
<li>In our context object, we’re providing variables that will be available to all of our resolver functions, such as our Flickr connector and our Dataloader instances for caching.</li>
<li>Because we’re running on Lambda, it’s important to perform some <a href="https://www.howtographql.com/advanced/4-security/">Query Complexity Analysis</a> to ensure incoming queries won’t max out our execution times. To accomplish this we’re going to use two libraries: <a href="https://github.com/stems/graphql-depth-limit"><code class="language-text">graphql-depth-limit</code></a> and <a href="https://github.com/ivome/graphql-query-complexity"><code class="language-text">graphql-query-complexity</code></a>.</li>
<li>You’ll notice that we have tracing enabled, which will append performance data to our responses. Check out <a href="https://github.com/apollographql/apollo-tracing">Apollo Tracing</a> and <a href="https://dev-blog.apollodata.com/apollo-engine-and-graphql-error-tracking-e7dd3ce8b99d">Apollo Engine</a> for more information on how you can use this to enable performance monitoring on your GraphQL endpoint.</li>
</ol>
<p>There’s also graphiql.js, which defines the /graphiql endpoint for the <a href="https://github.com/graphql/graphiql">GraphiQL IDE</a>:</p>
<p><code class="language-text">graphiql.js</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> graphiqlHapi <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"apollo-server-hapi"</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  register<span class="token operator">:</span> graphiqlHapi<span class="token punctuation">,</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/graphiql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    graphiqlOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      endpointURL<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/graphql</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Not a whole lot out of the ordinary here for configuring our graphiql IDE endpoint. Just a few things to note concerning AWS Lambda:</p>
<ul>
<li>If you’re not using a custom domain for your function, you’ll need to change your <code class="language-text">endpointURL</code> to add the stage prefix on deployment, otherwise graphiql won’t be able to find your API when running on AWS. This can be confusing because it will run just fine locally. Had me scratching my head over this one for a little while!</li>
<li>If you do want to use a custom domain, I used <a href="https://serverless.com/blog/serverless-api-gateway-domain/?rd=true">this Serverless article</a> and <a href="http://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-custom-domains.html">this part of the AWS documentation</a> to help get mine configured.</li>
</ul>
<p>Finally, let’s look at our <code class="language-text">schema.js</code> file which includes our GraphQL Schema for our GraphQL endpoint:</p>
<p><code class="language-text">schema.js</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Types <span class="token keyword">from</span> <span class="token string">'@/types'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GqlSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  types<span class="token operator">:</span>  Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>Types<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>type<span class="token punctuation">.</span>Definition<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=></span> type<span class="token punctuation">.</span>Definition <span class="token punctuation">)</span><span class="token punctuation">,</span>
  query<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GqlObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Query</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The root query for implementing GraphQL queries.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">fields</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>Types<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>type<span class="token punctuation">.</span>Queries<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">type</span> <span class="token operator">=></span> type<span class="token punctuation">.</span>Queries<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p>Also pretty straightforward. In each of our Type Definition files, we’re going to have a default export, which will include our Type Definition and Queries associated with it (we’ll see what those look like soon). We’ll wrap all of those up in an <code class="language-text">index.js</code> file as a default export, which we’ll iterate over to generate pieces of our Schema.</p>
<p>If you want to include Mutations in the same manner, simply copy the <code class="language-text">query</code> key and follow its format to import a Mutations object from each of your Type Definitions. I like to do things this way to keep code tidy and co-located.</p>
<h4>Webpack Notes</h4>
<p>I do a few different tricks in my Webpack configuration to ease development.</p>
<p>Here’s my full Webpack configuration for reference:</p>
<p><code class="language-text">webpack.config.js</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">path</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> slsw <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">serverless-webpack</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> nodeExternals <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpack-node-externals</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> MinifyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">babel-minify-webpack-plugin</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> DefinePlugin<span class="token punctuation">,</span> ProvidePlugin<span class="token punctuation">,</span> optimize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpack</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> ModuleConcatenationPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> optimize

<span class="token keyword">const</span> dotenv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dotenv</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
dotenv<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// import environment variables defined in '.env' located in our project root directory</span>

<span class="token keyword">const</span> <span class="token constant">ENV</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">development</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> envProd <span class="token operator">=</span> <span class="token constant">ENV</span> <span class="token operator">===</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">production</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> srcDir <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> outDir <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dist</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token keyword">const</span> npmDir <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">node_modules</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> slsw<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>entries<span class="token punctuation">,</span>
  target<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">node</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  externals<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">nodeExternals</span><span class="token punctuation">(</span><span class="token punctuation">{</span> modulesFromFile<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    libraryTarget<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">commonjs</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> outDir<span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[name].js</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.gql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'@'</span><span class="token operator">:</span> srcDir <span class="token comment">// used to allow root-relative imports, ie: import { invariant } from "@/utilities"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">babel-loader</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> exclude<span class="token operator">:</span> npmDir<span class="token punctuation">,</span> options<span class="token operator">:</span> <span class="token punctuation">{</span>
        plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform-optional-chaining</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// enables the usage of Existential Operator, ie: ?.</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform-object-rest-spread</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">transform-es2015-shorthand-properties</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        presets<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">env</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            targets<span class="token operator">:</span> <span class="token punctuation">{</span> node<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">6.10</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// AWS Lambda uses node v6.10, so transpile our code for that environment</span>
            useBuiltIns<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">usage</span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">stage-0</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex">/\.(graphql|gql)$/</span><span class="token punctuation">,</span> exclude<span class="token operator">:</span> npmDir<span class="token punctuation">,</span> loader<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql-tag/loader</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span> <span class="token comment">// in case you're using .gql files</span>
    <span class="token punctuation">]</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// used to provide environment variables as globals in our code</span>
      <span class="token constant">ENV</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token constant">ENV</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token constant">LOGLEVEL</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LOGLEVEL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token constant">FLICKR_API_KEY</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FLICKR_API_KEY</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// used to provide node module exports as globals in our code</span>
      <span class="token comment">// GraphQL</span>
      GqlBool<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLBoolean</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// same as import { GraphQLBoolean as GqlBool } from "graphql"</span>
      GqlDate<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql-iso-date</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLDate</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlDateTime<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql-iso-date</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLDateTime</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlEmail<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql-custom-types</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLEmail</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlEnum<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLEnumType</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlError<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLError</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlFloat<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLFloat</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlID<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLID</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlInput<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLInputObjectType</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlInt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLInt</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlInterface<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLInterfaceType</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLList</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlNonNull<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLNonNull</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlObject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLObjectType</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlScalar<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLScalarType</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlSchema<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLSchema</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlString<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLString</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlTime<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql-iso-date</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLTime</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlUnion<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLUnion</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      GqlURL<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql-custom-types</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">GraphQLURL</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      globalId<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql-relay</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">globalIdField</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      toGlobalId<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql-relay</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">toGlobalId</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      fromGlobalId<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">graphql-relay</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">fromGlobalId</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// Daraloader</span>
      Dataloader<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dataloader</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token comment">// Winston</span>
      info<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">winston</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">info</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      error<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">winston</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">error</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleConcatenationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MinifyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      keepFnName<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      keepClassName<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      booleans<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      deadcode<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      evaluate<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      flipComparisons<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      mangle<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// some of our debugging functions require variable names to remain intact</span>
      memberExpressions<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      mergeVars<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      numericLiterals<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      propertyLiterals<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      removeConsole<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      removeDebugger<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      simplify<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      simplifyComparisons<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      typeConstructors<span class="token operator">:</span> envProd<span class="token punctuation">,</span>
      undefinedToVoid<span class="token operator">:</span> envProd
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre></div>
<p>There are three important things to note:</p>
<ol>
<li>I specifically include the webpack config for this project highlight webpack’s <a href="https://webpack.js.org/plugins/provide-plugin/">provide plugin</a>. It allows you to call exports from node modules without having to explicitly import them in the files in which you use them. <strong>So when you see things like <code class="language-text">GqlString</code> instead of <code class="language-text">GraphQLString</code>, this is why.</strong></li>
<li>We’re using <code class="language-text">babel-plugin-transform-optional-chaining</code>, which adds support for the TC39 syntax proposal: <a href="https://github.com/tc39/proposal-optional-chaining">Optional Chaining</a>, aka the Existential Operator. You’ll see this in the code base in the following format: <code class="language-text">obj?.property</code> which is equivalent to <code class="language-text">!!object.property ? object.property : undefined</code>. Using this syntax requires using <a href="https://babeljs.io/blog/2017/03/01/upgrade-to-babel-7">babel 7</a>, so keep that in mind before attempting to use the plugin in your own projects.</li>
<li>We’re using a resolve alias, specifying <code class="language-text">@</code> as the project root directory. This lets us do project root relative imports, such as <code class="language-text">import { invariant } from &quot;@/utilities&quot;</code>. I really like the way this webpack helps with code organization and managing relative imports across refactors.</li>
</ol>
<h3>Fetching Data from the Flickr API</h3>
<p>Now that we’ve built our GraphQL server and endpoint, it’s time to fetch data from the Flickr API. Remember: Flickr’s data is only accessible via a REST API. We have to write a connector library to interact with Flickr.</p>
<p>When I started this project, the first thing I actually put together was the Flickr connector. I probably refactored it about a dozen times before I got things organized in a way that I liked.</p>
<p>It’s now designed such that you can use it completely independently from GraphQL as a standalone library to interact with the Flickr API. It’s also broken up into multiple parts, such that you can import only what you need to keep the bundle size down.</p>
<p>The connector is fairly simple—you can check the <a href="https://github.com/Saeris/Flickr-Wormhole/blob/develop/src/flickr.js">code here</a>. There are two methods: <code class="language-text">fetchResource</code>, which is invoked by the GraphQL method handlers to get Flickr data, and <code class="language-text">fetch</code> which is used under the hood to make a request to the Flickr API.</p>
<p>The connector includes a Dataloader instance to cache results of each REST call. If a method handler calls <code class="language-text">fetchResource</code> with the same arguments that handler has used before, it will return the cached results. Otherwise, the connector will call <code class="language-text">fetch</code> to hit the Flickr API, cache the results, and return them to the handler.</p>
<p>The Flickr connector can be called as follows:</p>
<p><code class="language-text">getPhotos.js</code></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> Flickr <span class="token keyword">from</span> <span class="token string">"@/flickr"</span> <span class="token comment">// A global instance of the connector is export by default as a fallback for each handler</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">getPhotos</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span> flickr <span class="token operator">=</span> Flickr<span class="token punctuation">,</span> photosetId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> userId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> privacyFilter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> media <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">all</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> extras <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> perPage <span class="token operator">=</span> <span class="token number">500</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> flickr<span class="token punctuation">.</span><span class="token function">fetchResource</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">flickr.photosets.getPhotos</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> photosetId<span class="token punctuation">,</span> userId <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> privacyFilter<span class="token punctuation">,</span> media<span class="token punctuation">,</span> extras<span class="token punctuation">,</span> page<span class="token punctuation">,</span> perPage <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>You’ll notice that defaults are set for many of the values, matching the defaults in the Flickr API documentation. This also serves as a type reference, which will later be updated to use Flow typings. I did things this way to minimize the occurrence of typos and referral to the API documentation that would arise from having to invoke <code class="language-text">fetchResource</code> manually.</p>
<p>That’s it for the Flickr API library! Back to the GraphQL side of things.</p>
<h3>GraphQL Type Definitions</h3>
<p>For each different node type in our GraphQL schema, we’ll need to create a Type Definition. There are fifteen Type Definitions in total for types such as Albums, Galleries, Images, and Tags. These Type Definitions are quite long, usually over 100 lines each, so I’ll omit them for brevity. You can <a href="https://github.com/Saeris/Flickr-Wormhole/tree/develop/src/types">explore them here</a> if you’re curious.</p>
<p>Below, I’ll offer a few tips on how I organize my Type Definition files and how they differ from the <a href="http://graphql.org/graphql-js/type/#examples">reference implementation</a> of a GraphQL Type Definition. Then, I’ll cover how I structure resolvers in this project. Finally, I’ll show you how I built advanced features like filtering, pagination, and sorting to make it easier to get the exact data I wanted from Flickr.</p>
<h4>Organization</h4>
<p>I like to organize my type definition files as follows:</p>
<ul>
<li>Import any resolver functions and utilities, followed by dependent types.</li>
<li>Create the actual type definition, and name the export the same as the type. This makes it easy to reference when using it in other type definitions.</li>
<li>Create any number of relevant Queries for this type; these will be the graph ‘entry points’. Typically, you’ll only need about one per type definition.</li>
<li>Create any number of relevant Mutations for this type. This basically follows the same format as Queries. Because the project doesn’t have any mutations and the time of this writing, there is no Mutations export shown here.</li>
<li>Create a Definition alias for the type definition and export the Definition, Queries and Mutations as a default export. This default export will be used by <code class="language-text">schema.js</code> to build our Schema definition.</li>
</ul>
<p>This is my method, but feel free to do whatever works best for you.</p>
<h4>Differences</h4>
<p>If you look at my Type Definitions, you might be confused by a few of the properties on our fields—<code class="language-text">complexity</code>, <code class="language-text">sortable</code>, and <code class="language-text">filter</code> are all custom properties that are not part of the <code class="language-text">graphql.js</code> reference implementation. These fields are used for advanced functionality in my application:</p>
<ul>
<li><code class="language-text">complexity</code>: This property is used by the <code class="language-text">graphql-query-complexity</code> library to calculate the complexity score of a field. You provide it with a function that returns an integer value. That function is automatically given your field’s query arguments and the computed complexity score of the child type you’re fetching. The further we nest our queries, these scores will get exponentially bigger. Requesting too many of these fields will deplete our complexity budget faster.</li>
<li><code class="language-text">sortable</code>: If set to true, this field will be included in our list of sortable fields in the OrderBy input for this type, which is used in query arguments elsewhere in our schema.</li>
<li><code class="language-text">filter</code>: When set with an object with at least a <code class="language-text">type</code> property, this field will be included in a list of filterable fields in the Filter input for this type. <code class="language-text">type</code> should be a list of whatever the field’s <code class="language-text">type</code> is, or it could be a custom input, such as the <code class="language-text">Range</code> and <code class="language-text">DateRange</code> inputs we’ve imported.</li>
</ul>
<p>You’ll notice we’re using a <code class="language-text">disabled</code> argument in our Fields thunk. This is to prevent type errors from popping up when we’re generating our <code class="language-text">filter</code> and <code class="language-text">orderBy</code> inputs for this type.</p>
<h4>Resolvers, Loaders &#x26; Data Models</h4>
<p>While the Flickr connector is concerned with making REST API calls and returning the raw JSON response, our <strong>resolvers</strong> determine how many requests need to be made from the query arguments with some help from our <code class="language-text">pagination</code> utility. The resolvers pass the results off to our models, which will transform the raw data into a shape that can be consumed by our schema.</p>
<p><strong>Loaders</strong> are simple factory functions that return a new instance of <a href="https://github.com/facebook/dataloader">Dataloader</a>. They create a class with a hash map to <a href="https://www.sitepoint.com/implementing-memoization-in-javascript/">memoize</a> the results of the value (or array of values) we pass to it using the <code class="language-text">.load()</code> and <code class="language-text">.loadMany()</code> methods.</p>
<p>Loaders will be our first line of defense in ensuring we don’t re-fetch data we’ve already retrieved. If a cached result is not found in the hash map, it will execute one of our resolvers to fetch the value for that input.</p>
<h3>Applying Filters, Sorting Results &#x26; Pagination</h3>
<p>Finally, let’s take a look at some of the utilities we’ve been using in our resolvers.</p>
<p>To keep things as <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> as possible, I created a few abstractions to help with filtering, sorting and pagination in my resolvers.</p>
<p>First, I made a <a href="https://github.com/Saeris/Flickr-Wormhole/blob/develop/src/resolvers/utilities/createFilter.js">filter utility</a> (<code class="language-text">createFilter.js</code>) to iterate over the fields in that type definition and search for fields with a <code class="language-text">filter</code> property set on them. For each one it finds, it will create a hash of the field names and filter values which the returned input object will use as its fields property:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> isObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lodash"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> invariant<span class="token punctuation">,</span> missingArgument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/utilities"</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createFilters</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">invariant</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">missingArgument</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">object</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GqlInput</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token punctuation">.</span>_typeConfig<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Filter</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">fields</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span>_typeConfig<span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>name<span class="token punctuation">,</span> values<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>values<span class="token punctuation">.</span>filter<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">hash<span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> values<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        hash<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> values<span class="token punctuation">.</span>filter
        <span class="token keyword">return</span> hash
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This will allow us to create query arguments such as the following:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql">images<span class="token punctuation">(</span><span class="token attr-name">filter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">size</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Small<span class="token punctuation">,</span> Medium<span class="token punctuation">,</span> Large<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size
<span class="token punctuation">}</span></code></pre></div>
<p>This will filter a list of Image results to only include images with a <code class="language-text">size</code> value of either <code class="language-text">Small</code>, <code class="language-text">Medium</code>, or <code class="language-text">Large</code>.</p>
<p>You can also apply as many filters as you want. Each field you supply a value for will be applied in the order you define them.</p>
<p>I also made an <a href="https://github.com/Saeris/Flickr-Wormhole/blob/develop/src/resolvers/utilities/createOrder.js">orderBy utility</a> (<code class="language-text">createOrder.js</code>). It takes two inputs, <code class="language-text">field</code> and <code class="language-text">sort</code>, where <code class="language-text">field</code> is an enumerable list of all the sortable field names, and <code class="language-text">sort</code> will be the sorting direction, defaulting to ascending:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> isObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lodash"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> invariant<span class="token punctuation">,</span> missingArgument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/utilities"</span>

<span class="token keyword">const</span> Sort <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GqlEnum</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Sort</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  values<span class="token operator">:</span> <span class="token punctuation">{</span> asc<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> desc<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createOrder</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">invariant</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">missingArgument</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">object</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> FieldsEnum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GqlEnum</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token punctuation">.</span>_typeConfig<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">OrderByFields</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    values<span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span>_typeConfig<span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>name<span class="token punctuation">,</span> values<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>values<span class="token punctuation">.</span>sortable<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">hash<span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> values<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        hash<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">return</span> hash
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GqlInput</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token punctuation">.</span>_typeConfig<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">OrderBy</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token function-variable function">fields</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      field<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">GqlNonNull</span><span class="token punctuation">(</span>FieldsEnum<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      sort<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> Sort<span class="token punctuation">,</span> defaultValue<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">asc</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Here’s an example of its use in a query:</p>
<div class="gatsby-highlight" data-language="graphql"><pre class="language-graphql"><code class="language-graphql">photos<span class="token punctuation">(</span><span class="token attr-name">orderBy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token attr-name">field</span><span class="token punctuation">:</span> taken <span class="token attr-name">sort</span><span class="token punctuation">:</span> desc <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  taken
<span class="token punctuation">}</span></code></pre></div>
<p>This will sort the photo results by their taken date in descending order (latest to oldest).</p>
<p>Finally, I made a <a href="https://github.com/Saeris/Flickr-Wormhole/blob/develop/src/resolvers/utilities/pagination.js">pagination utility</a> (<code class="language-text">pagination.js</code>). This function will take in query arguments plus a total value, and use those to calculate a <code class="language-text">start</code>, <code class="language-text">perPage</code>, and <code class="language-text">skip</code> value to pass along to the resolver:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> isNumber <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"lodash"</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> invariant<span class="token punctuation">,</span> missingArgument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/utilities"</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pagination</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> first <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> last <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> total <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">invariant</span><span class="token punctuation">(</span><span class="token function">isNumber</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isNumber</span><span class="token punctuation">(</span>last<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isNumber</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Please set either 'first', 'last', or 'count'.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token function">invariant</span><span class="token punctuation">(</span><span class="token function">isNumber</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">missingArgument</span><span class="token punctuation">(</span><span class="token punctuation">{</span> total <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">number</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">isNumber</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">minPerPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">totalItems<span class="token punctuation">,</span> minLimit</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>totalItems <span class="token operator">===</span> minLimit<span class="token punctuation">)</span> <span class="token keyword">return</span> minLimit
    <span class="token keyword">let</span> perPage <span class="token operator">=</span> minLimit
    <span class="token keyword">while</span> <span class="token punctuation">(</span>totalItems <span class="token operator">%</span> perPage <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      perPage<span class="token operator">++</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> perPage
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>first<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> perPage <span class="token operator">=</span> first
    <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">const</span> skip <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span> start<span class="token punctuation">,</span> perPage<span class="token punctuation">,</span> skip <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>last <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cursor <span class="token operator">=</span> total <span class="token operator">-</span> last
    <span class="token keyword">const</span> perPage <span class="token operator">=</span> <span class="token function">minPerPage</span><span class="token punctuation">(</span>total<span class="token punctuation">,</span> last<span class="token punctuation">)</span>
    <span class="token keyword">const</span> start <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>cursor <span class="token operator">/</span> perPage<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">1</span>
    <span class="token keyword">const</span> skip <span class="token operator">=</span> cursor <span class="token operator">%</span> perPage

    <span class="token keyword">return</span> <span class="token punctuation">{</span> start<span class="token punctuation">,</span> perPage<span class="token punctuation">,</span> skip <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> perPage <span class="token operator">=</span> offset <span class="token operator">></span> count <span class="token operator">?</span> <span class="token function">minPerPage</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token operator">:</span> count
    <span class="token keyword">const</span> start <span class="token operator">=</span> offset <span class="token operator">></span> count <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>offset <span class="token operator">/</span> perPage<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">1</span>
    <span class="token keyword">const</span> skip <span class="token operator">=</span> perPage <span class="token operator">-</span> count <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> perPage <span class="token operator">-</span> count

    <span class="token keyword">return</span> <span class="token punctuation">{</span> start<span class="token punctuation">,</span> perPage<span class="token punctuation">,</span> skip <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>It’s used as part of the resolver’s arguments in the following manner:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">//...</span>
<span class="token function">fetchUserPhotos</span><span class="token punctuation">(</span><span class="token punctuation">{</span> flickr<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token function">pagination</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span>args<span class="token punctuation">,</span> total<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//...</span></code></pre></div>
<p>Pagination only works in one of three ways at present: by the <code class="language-text">first</code> number of results, the <code class="language-text">last</code> number of results from the total, or a <code class="language-text">count</code> that is a subsection of the results offset by a given number from the start of the result set.</p>
<h3>And That’s It!</h3>
<p>That about covers all the basic project components.</p>
<p>There are some other utility functions I didn’t cover here, mostly error handling and validation related. You’ll have to dig through the <a href="https://github.com/Saeris/Flickr-Wormhole">source code</a> if you want to learn how they work. ;)</p>
<h2>Room for Improvement</h2>
<p>There are a few things this project is still missing. You may have even picked up on them already.</p>
<p>Here’s a short list:</p>
<ul>
<li>Right now the gateway only supports queries. There’s no way to mutate data, meaning you can’t do things like add comments or upload new photos to Flickr using the gateway. I didn’t build out that functionality because I don’t need it for my website as of yet.</li>
<li>Because of the above, requests that require authentication are also unsupported at this time. These include certain read methods (e.g. fetching a user’s galleries or a private list of favorites).</li>
<li>I would like to add a shared cache between gateway instances using Amazon’s Elasticache service. That way it could be possible to implement cursor based pagination and temporary caching of more sensitive data, which would require token based authentication and session tracking.</li>
<li>Pagination sucks, a lot. It’s got the most room for improvement.</li>
<li>I’m working on adding more logging and monitoring tools, such as additional transports for <a href="https://github.com/winstonjs/winston">Winston</a> to services like <a href="https://www.loggly.com/">Loggly</a> or <a href="https://sentry.io/">Sentry</a>, and <a href="https://www.apollodata.com/optics/">Apollo Optics</a>’ new <a href="https://dev-blog.apollodata.com/apollo-engine-and-graphql-error-tracking-e7dd3ce8b99d">Engine</a> platform, which requires a Docker Container running on something like <a href="https://aws.amazon.com/ecs/">Amazon’s EC2 Container Service</a>. These would help in tuning the performance of the gateway and monitoring for errors.</li>
<li>There are currently no tests, so eventually some should be written. Test writing isn’t one of my strengths as a developer, unfortunately.</li>
<li>I would also like to add typings to the project as well using Flow. That would help to catch some bugs early as I continue development.</li>
</ul>
<h1>Final Thoughts</h1>
<p>Overall this has been a great learning experience for me! Most of my development experience is in the front-end side of things, so working on more of a back-end project was a rapid-fire learning experience.</p>
<p>GraphQL has been a fantastic technology to work with and I firmly believe that it adds value to every project it’s integrated into. It’s more powerful and much more of a pleasure to use than traditional RESTful APIs, and I’m convinced that it’s on trajectory to become the future standard for web APIs.</p>
<p>I hope this breakdown has been useful to you as an example of how to build a GraphQL server in JavaScript and encourages you to build that server on top of the Serverless platform!</p>
<p>Drake Costa
<em>Full-Stack JavaScript Engineer and Photographer</em></p>
<p><a href="https://github.com/Saeris">Github</a> | <a href="https://www.linkedin.com/in/saeris/">LinkedIn</a> | <a href="https://twitter.com/Saeris">Twitter</a> | <a href="https://www.instagram.com/saeris.io/">Instagram</a> | <a href="https://www.flickr.com/people/saeris/">Flickr</a></p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAUBAgME/8QAFwEBAAMAAAAAAAAAAAAAAAAAAgABA//aAAwDAQACEAMQAAABtTuWpVlGVPBk0HAFf//EABsQAAICAwEAAAAAAAAAAAAAAAECAxMAESMk/9oACAEBAAEFAnOlgZ7cvIZnEYuxj6ZjxjOh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQEiH/2gAIAQMBAT8BwqOP/8QAGREAAQUAAAAAAAAAAAAAAAAAAAEQEiEx/9oACAECAQE/AbJCY3//xAAgEAABAgUFAAAAAAAAAAAAAAABABECAxASITFBYYGR/9oACAEBAAY/Ai2qYx3A0tPifYlsLBBT8qX3T//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hRVcZF9KXnJkRaRWsbCd3oQNMD6x1eoRshVw76T//2gAMAwEAAgADAAAAENvoAP/EABkRAAIDAQAAAAAAAAAAAAAAAAABESExUf/aAAgBAwEBPxCEpsj00xYf/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAEQESExUf/aAAgBAgEBPxBNs0X5A9n/xAAeEAEBAQACAQUAAAAAAAAAAAABEQAhMUFRYXGBkf/aAAgBAQABPxClwdnV0whQo4lO/wAzyyrjkGw+cZbkILxecbfXBH7zSeBntAmta2n5uEBbXZ4N/9k=" alt="Kyle Mathews" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" src="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg" alt="Kyle Mathews" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Kyle Mathews</strong> <!-- -->who lives and works in San Francisco building useful things.<!-- --> <a href="https://twitter.com/kylemathews">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/lumen/posts/2017-10-20-google-cloud-functions-application/">← <!-- -->Building an image recognition endpoint with Serverless and Google Cloud Functions.</a></li><li><a rel="next" href="/lumen/posts/2017-10-25-rob-gruhl-serverless-event-sourced-nordstrom-emit-2017/">Rob Gruhl - towards a serverless event-sourced Nordstrom<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/2017-10-19-3rd-party-rest-api-to-graphql-serverless/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-36e457a5393b79b99515.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9578b926700cf49bb4fc.js"],"component---src-pages-index-js":["/component---src-pages-index-js-753a3f9bde0636fce206.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-f16d60f62c7d2b3e9bcc.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"]};/*]]>*/</script><script src="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js" async=""></script><script src="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js" async=""></script><script src="/lumen/commons-4c36ffabef1434ec1126.js" async=""></script><script src="/lumen/app-36e457a5393b79b99515.js" async=""></script><script src="/lumen/styles-cd63080e784be7b7e7cf.js" async=""></script><script src="/lumen/framework-5fc6169171e885c3b522.js" async=""></script><script src="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js" async=""></script></body></html>