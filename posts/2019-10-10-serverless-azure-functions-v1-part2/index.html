<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/lumen/styles.1d0daeadf0762b76da98.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/lumen/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/lumen/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/lumen/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/lumen/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/lumen/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/lumen/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/lumen/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/lumen/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/lumen/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/lumen/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/lumen/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/lumen/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/lumen/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/lumen/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/lumen/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/lumen/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/lumen/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/lumen/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/lumen/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/lumen/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/lumen/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/lumen/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/lumen/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/lumen/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/lumen/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/lumen/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.23.12"/><link rel="alternate" type="application/rss+xml" href="/lumen/rss.xml"/><link rel="icon" href="/lumen/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/lumen/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/lumen/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/lumen/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/lumen/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/lumen/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/lumen/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/lumen/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/lumen/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/lumen/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">How to Create a REST API with Azure Functions and the Serverless Framework - Part 2 | Gatsby Starter Blog</title><meta data-react-helmet="true" name="description" content="Learn how to add API Management, Webpack and CI/CD to your Azure Functions REST API"/><meta data-react-helmet="true" property="og:title" content="How to Create a REST API with Azure Functions and the Serverless Framework - Part 2"/><meta data-react-helmet="true" property="og:description" content="Learn how to add API Management, Webpack and CI/CD to your Azure Functions REST API"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="kylemathews"/><meta data-react-helmet="true" name="twitter:title" content="How to Create a REST API with Azure Functions and the Serverless Framework - Part 2"/><meta data-react-helmet="true" name="twitter:description" content="Learn how to add API Management, Webpack and CI/CD to your Azure Functions REST API"/><link as="script" rel="preload" href="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js"/><link as="script" rel="preload" href="/lumen/framework-5fc6169171e885c3b522.js"/><link as="script" rel="preload" href="/lumen/styles-cd63080e784be7b7e7cf.js"/><link as="script" rel="preload" href="/lumen/app-36e457a5393b79b99515.js"/><link as="script" rel="preload" href="/lumen/commons-4c36ffabef1434ec1126.js"/><link as="script" rel="preload" href="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js"/><link as="script" rel="preload" href="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"/><link as="fetch" rel="preload" href="/lumen/page-data/posts/2019-10-10-serverless-azure-functions-v1-part2/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/lumen/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;color:inherit" href="/lumen/">Gatsby Starter Blog</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">How to Create a REST API with Azure Functions and the Serverless Framework - Part 2</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">October 10, 2019</p></header><section><h4>Overview</h4>
<p>Now that you’ve created and deployed a basic API from <a href="https://serverless.com/blog/serverless-azure-functions-v1">Part 1</a>, let’s take a few more steps towards making that API more resilient and secure. This post will still be based on the <a href="https://github.com/tbarlow12/sls-az-func-rest-api">example repo</a>, and will follow the same “commit-per-step” format as <a href="https://serverless.com/blog/serverless-azure-functions-v1">Part 1</a>, which contains Steps 1 and 2.</p>
<p>To pick up where we left off in the example repo (after having completed Step 2), run:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Assumes you've already forked the repo</span>
$ <span class="token function">git</span> clone https://github.com/<span class="token operator">&lt;</span>your-github-name<span class="token operator">></span>/sls-az-func-rest-api <span class="token operator">&amp;&amp;</span> <span class="token function">git</span> checkout cf46d1d</code></pre></div>
<h4>Step 3: Add unit testing and linting - (commit <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/465ecfe04bda8d4d5ac7c9c5ce31557a8993408f">465ecfe</a>)</h4>
<p>Because this isn’t a blog post on unit tests, linting or quality gates in general, I’ll just share the tools that I’m using and the quality gates that I added to the repository. Feel free to use them as stubs for your own future tests or lint rules.</p>
<p>For unit tests, I’m using the <a href="https://jestjs.io/">Jest</a> test runner from Facebook. I’ve used it for several projects in the past and have never had any issues. Jest tests typically sit alongside the file they are testing, and end with <code class="language-text">.test.js</code>. This is configurable within <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/465ecfe04bda8d4d5ac7c9c5ce31557a8993408f#diff-2d0cd5d10b9604941c38c6aac608178a"><code class="language-text">jest.config.js</code></a>, which is found at the root of the project.</p>
<p>Because my code makes REST calls via <code class="language-text">axios</code>, I’m using the <code class="language-text">axios-mock-adapter</code> to mock the request &#x26; response. The tests that I wrote (<a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/465ecfe04bda8d4d5ac7c9c5ce31557a8993408f#diff-fb5daf13ab24c55eef4f041fc89c5025">issues.test.js</a> and <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/465ecfe04bda8d4d5ac7c9c5ce31557a8993408f#diff-29c6cbdb5c35cdd4da7f67589ae7121a">pulls.test.js</a>) run some simple checks to make sure the correct URLs are hit and return the expected responses.</p>
<p>For linting, I’m using <a href="https://eslint.org">ESLint</a> with a very basic configuration, found in <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/465ecfe04bda8d4d5ac7c9c5ce31557a8993408f#diff-df39304d828831c44a2b9f38cd45289c"><code class="language-text">.eslintrc.json</code></a>. To run a lint check, you can run:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> run lint</code></pre></div>
<p>Many errors can be fixed automatically with:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> run lint:fix</code></pre></div>
<p>Run your tests with:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token builtin class-name">test</span></code></pre></div>
<p>For more details, take a look at the <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/465ecfe04bda8d4d5ac7c9c5ce31557a8993408f">commit in the example repo</a> or check out the commit locally</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">git</span> checkout 465ecfe</code></pre></div>
<h4>Step 4: Add basic API Management Configuration - (commit <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/c593308efc5a60e2701ec97122564592072080e2">c593308</a>)</h4>
<p>This was one of the first features we implemented into the <code class="language-text">v1</code> of the <code class="language-text">serverless-azure-functions</code> plugin. because most Azure Function Apps are REST APIs, and it’s hard to have a real-world API in Azure without <a href="https://azure.microsoft.com/en-us/services/api-management/">API Management</a>.</p>
<p>If you have no special requirements for API Management, the plugin will actually generate the default configuration for you if you just include:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">...</span>
<span class="token key atrule">provider</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
    <span class="token key atrule">apim</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre></div>
<p>That’s exactly what I did for <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/c593308efc5a60e2701ec97122564592072080e2">Step 4</a>. Also, because we want API Management to be the only entry point for our API endpoints, I also changed each function’s <code class="language-text">authLevel</code> to <code class="language-text">function</code>. This requires a function-specific API key for authentication. You can see in the screenshot what happens in the first command, when I try to <code class="language-text">curl</code> the original function URL. I get a <code class="language-text">401</code> response code. But when I hit the URL provided by API Management, I get the response I expect:</p>
<p><img src="https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/azure-functions-part2/apim_curl.jpg" alt="alt text"></p>
<p>For more details on <code class="language-text">authLevel</code>, check out the <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-http-webhook#trigger---configuration">trigger configuration docs</a>.</p>
<h6>Consumption SKU</h6>
<p>One important thing to note is that the API Management configuration will default to the <code class="language-text">consumption</code> SKU, which <a href="https://azure.microsoft.com/en-ca/updates/azure-api-management-consumption-tier-is-now-generally-available/">recently went GA</a>. For now, the only regions where <code class="language-text">Consumption</code> API Management is allowed are:</p>
<ul>
<li>North Central US</li>
<li>West US</li>
<li>West Europe</li>
<li>North Europe</li>
<li>Southeast Asia</li>
<li>Australia East</li>
</ul>
<p>If you are deploying to a region outside of that list, you will need to specify a different SKU (<code class="language-text">Developer</code>, <code class="language-text">Basic</code>, <code class="language-text">Standard</code> or <code class="language-text">Premium</code>) within the <code class="language-text">apim</code> configuration, which will be demonstrated in the next section.</p>
<h6>Deploy your updates:</h6>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ sls deploy</code></pre></div>
<h4>Step 5: Add more advanced API Management Configuration - (commit <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/38413a03100a65c423dc18ab47754471a4c6f245">38413a0</a>)</h4>
<p>If you need a few more knobs to turn when configuring your API Management instance, you can provide a more verbose configuration. Here is the verbose config I added to the sample repo (the <code class="language-text">...</code> means the rest of the config for that section stayed the same):</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">service</span><span class="token punctuation">:</span> sls<span class="token punctuation">-</span>az<span class="token punctuation">-</span>func<span class="token punctuation">-</span>rest<span class="token punctuation">-</span>api

<span class="token key atrule">provider</span><span class="token punctuation">:</span>
  <span class="token punctuation">...</span>
  <span class="token key atrule">apim</span><span class="token punctuation">:</span>
    <span class="token key atrule">apis</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> github<span class="token punctuation">-</span>api
        <span class="token comment"># Require an API Key if true</span>
        <span class="token key atrule">subscriptionRequired</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
        <span class="token key atrule">displayName</span><span class="token punctuation">:</span> Github API
        <span class="token key atrule">description</span><span class="token punctuation">:</span> The GitHub API
        <span class="token key atrule">protocols</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> https
        <span class="token comment"># Defaults to /api</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> github
        <span class="token comment"># Azure resource tags</span>
        <span class="token key atrule">tags</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> apimTag1
          <span class="token punctuation">-</span> apimTag2
        <span class="token key atrule">authorization</span><span class="token punctuation">:</span> none
    <span class="token key atrule">backends</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> github<span class="token punctuation">-</span>backend
        <span class="token key atrule">url</span><span class="token punctuation">:</span> api/github
    <span class="token key atrule">cors</span><span class="token punctuation">:</span>
      <span class="token key atrule">allowCredentials</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"*"</span>
      <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> GET
        <span class="token punctuation">-</span> POST
        <span class="token punctuation">-</span> PUT
        <span class="token punctuation">-</span> DELETE
        <span class="token punctuation">-</span> PATCH
      <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"*"</span>
      <span class="token key atrule">exposeHeaders</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"*"</span>
<span class="token punctuation">...</span>

<span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">issues</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
    <span class="token key atrule">apim</span><span class="token punctuation">:</span>
      <span class="token key atrule">api</span><span class="token punctuation">:</span> github<span class="token punctuation">-</span>api
      <span class="token key atrule">backend</span><span class="token punctuation">:</span> github<span class="token punctuation">-</span>backend
      <span class="token key atrule">operations</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">method</span><span class="token punctuation">:</span> get
          <span class="token key atrule">urlTemplate</span><span class="token punctuation">:</span> /issues
          <span class="token key atrule">displayName</span><span class="token punctuation">:</span> GetIssues
  <span class="token key atrule">pulls</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
    <span class="token key atrule">apim</span><span class="token punctuation">:</span>
      <span class="token key atrule">api</span><span class="token punctuation">:</span> github<span class="token punctuation">-</span>api
      <span class="token key atrule">backend</span><span class="token punctuation">:</span> github<span class="token punctuation">-</span>backend
      <span class="token key atrule">operations</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">method</span><span class="token punctuation">:</span> get
          <span class="token key atrule">urlTemplate</span><span class="token punctuation">:</span> /pulls
          <span class="token key atrule">displayName</span><span class="token punctuation">:</span> GetPullRequests</code></pre></div>
<p>If you did not want the <code class="language-text">Consumption</code> SKU of API Management, you would need to have a verbose configuration and specify the <code class="language-text">sku</code> as:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">provider</span><span class="token punctuation">:</span>
  <span class="token punctuation">...</span>
  <span class="token key atrule">apim</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
    <span class="token key atrule">sku</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>Consumption<span class="token punctuation">|</span>Developer<span class="token punctuation">|</span>Basic<span class="token punctuation">|</span>Standard<span class="token punctuation">|</span>Premium<span class="token punctuation">}</span></code></pre></div>
<p>The example just uses the default and deploys to region(s) where Consumption API Management is currently available.</p>
<h6>Deploy your updates:</h6>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ sls deploy</code></pre></div>
<h4>(Optional) Step 5.1: Revert back to basic API Management configuration - (commit <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/4c5803f1e5adf21befbeac8e91cac4552b4f9c1c">4c5803f</a>)</h4>
<p>To make the demo simple and easy to follow, I’m going to revert my <code class="language-text">apim</code> configuration back to the defaults:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">apim</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre></div>
<p>You might be able to do the same, depending on your requirements.</p>
<h4>Step 6: Add Webpack configuration - (commit <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/1aefac7e5ed99db009632724c6a70c9cb3d29bf8">1aefac7</a>)</h4>
<p><a href="https://webpack.js.org/">Webpack</a> dramatically reduces the packaging time as well as the size of your deployed package. After making these changes, your packaged Function App will be optimized with Webpack (You can run <code class="language-text">sls package</code> to package it up or just run <code class="language-text">sls deploy</code> which will include packaging as part of the lifecycle).</p>
<p>Just as an example, even for this very small application, my package size went from <strong>324 KB</strong> to <strong>28 KB</strong>. </p>
<p>To accomplish this, we’ll use another awesome Serverless plugin, <a href="https://github.com/serverless-heaven/serverless-webpack"><code class="language-text">serverless-webpack</code></a> to make Webpacking our Azure Function app really easy.</p>
<p>First thing you’ll want to do, assuming you’re working through this tutorial in your own git repository, is add the generated Webpack folder to your <code class="language-text">.gitignore</code></p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># .gitignore</span>
<span class="token punctuation">...</span>
<span class="token comment"># Webpack artifacts</span>
.webpack/</code></pre></div>
<p>Next, we’ll need to install 3 packages from npm:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i serverless-webpack webpack webpack-cli --save-dev</code></pre></div>
<p>Then we’ll add the plugin to our <code class="language-text">serverless.yml</code>:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">plugins</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> serverless<span class="token punctuation">-</span>azure<span class="token punctuation">-</span>functions
  <span class="token punctuation">-</span> serverless<span class="token punctuation">-</span>webpack</code></pre></div>
<p>And then copy this exact code into <code class="language-text">webpack.config.js</code> in the root of your service directory:</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> slsw <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"serverless-webpack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> slsw<span class="token punctuation">.</span>lib<span class="token punctuation">.</span>entries<span class="token punctuation">,</span>
  target<span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    libraryTarget<span class="token operator">:</span> <span class="token string">"commonjs2"</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">"index"</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">".webpack"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">"[name].js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>And just like that, your deployed Azure Function apps will be webpacked and ready to go.</p>
<p><img src="https://media.giphy.com/media/zcCGBRQshGdt6/giphy.gif" alt="alt text"></p>
<h4>Step 7: Enable Serverless CLI configuration - (commit <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/4cb42fdf17d7793a3ac9660bb43f28e8fe2d46d5">4cb42fd</a>)</h4>
<p>If you’re running a real-life production service, you will most likely be deploying to multiple regions and multiple stages. Maybe merges to your <code class="language-text">dev</code> branch will trigger deployments to your <code class="language-text">dev</code> environment, <code class="language-text">master</code> into <code class="language-text">prod</code>, etc. I’ll show you an example of that in Step 8. To accomplish CLI-level configurability, we need to make a few changes <code class="language-text">serverless.yml</code>.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">provider</span><span class="token punctuation">:</span>
  <span class="token key atrule">region</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>opt<span class="token punctuation">:</span>region<span class="token punctuation">,</span> <span class="token string">'West US'</span><span class="token punctuation">}</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>opt<span class="token punctuation">:</span>stage<span class="token punctuation">,</span> <span class="token string">'dev'</span><span class="token punctuation">}</span>
  <span class="token key atrule">prefix</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>opt<span class="token punctuation">:</span>prefix<span class="token punctuation">,</span> <span class="token string">'demo'</span><span class="token punctuation">}</span></code></pre></div>
<p>As you might have guessed, the values <code class="language-text">West US</code>, <code class="language-text">dev</code> and <code class="language-text">demo</code> are my default values. If I wanted to deploy my service to <code class="language-text">North Central US</code> and <code class="language-text">West Europe</code>, but keep everything else the same, I would run:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ sls deploy --region <span class="token string">"North Central US"</span>
$ sls deploy --region <span class="token string">"West Europe"</span></code></pre></div>
<p>We could do similar operations with <code class="language-text">--prefix</code> and <code class="language-text">--stage</code>. Now let’s create a pipeline that actually does this.</p>
<h4>Step 8: Add CI/CD (with Azure DevOps) - (commit <a href="https://github.com/tbarlow12/sls-az-func-rest-api/commit/a8fabf6faa30f7ceab7c18395a5c69c21abd4640">a8fabf6</a>)</h4>
<p>For the CI/CD on my sample repo, I’m using <a href="">Azure DevOps</a>, but it would work the same on any other service you want to use. If you want to use Azure DevOps for an open-source project, <a href="https://docs.microsoft.com/en-us/azure/devops/organizations/public/about-public-projects?view=azure-devops#get-started-with-a-public-project">here are a few steps to get started</a></p>
<p>No matter the CI/CD environment, here is what we are looking to accomplish:</p>
<ol>
<li>Install dependencies</li>
<li>Validate the changes (run quality gates)</li>
<li>Deploy the service</li>
</ol>
<p>These steps can all be accomplished in just a few CLI commands. At bare minimum, we’ll want to run something like:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Clean install</span>
<span class="token function">npm</span> ci
<span class="token comment"># Runs tests and linting</span>
<span class="token function">npm</span> <span class="token builtin class-name">test</span>
<span class="token comment"># Serverless not contained within dev dependencies to avoid conflicts</span>
<span class="token comment"># because most users have it installed globally on their dev machine</span>
<span class="token function">npm</span> i serverless -g
<span class="token comment"># Deploy service</span>
sls deploy</code></pre></div>
<p>There are a lot more bells and whistles we could add, but that’s essentially what it boils down to. Of course, we’ll need authentication in whatever system we’re deploying from, and that’s where the <a href="https://github.com/serverless/serverless-azure-functions#creating-a-service-principal">service principal</a> will come in. I’ll show you how to use the service principal in the <code class="language-text">deploy.yml</code> pipeline below.</p>
<p>For my pipelines, I’m actually going to split up my CI and CD into <code class="language-text">unit-tests.yml</code> and <code class="language-text">deploy.yml</code>. Unit tests will be run on PRs into <code class="language-text">master</code> or <code class="language-text">dev</code> (this is assuming there are branch policies in place to prevent devs from pushing straight to either branch). Deployment will be run on commits (merges) to <code class="language-text">master</code>.</p>
<h5>Unit Tests</h5>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># pipelines/unit-tests.yml</span>

<span class="token comment"># Only run on Pull Requests into `master` or `dev`</span>
<span class="token key atrule">pr</span><span class="token punctuation">:</span>
  <span class="token key atrule">branches</span><span class="token punctuation">:</span>
    <span class="token key atrule">include</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master
    <span class="token punctuation">-</span> dev

<span class="token comment"># Run pipeline on node 8 and 10 on Linux, Mac and Windows </span>
<span class="token key atrule">strategy</span><span class="token punctuation">:</span>
  <span class="token key atrule">matrix</span><span class="token punctuation">:</span>
    <span class="token key atrule">Linux_Node8</span><span class="token punctuation">:</span>
      <span class="token key atrule">imageName</span><span class="token punctuation">:</span> <span class="token string">'ubuntu-16.04'</span>
      <span class="token key atrule">node_version</span><span class="token punctuation">:</span> 8.x
    <span class="token key atrule">Linux_Node10</span><span class="token punctuation">:</span>
      <span class="token key atrule">imageName</span><span class="token punctuation">:</span> <span class="token string">'ubuntu-16.04'</span>
      <span class="token key atrule">node_version</span><span class="token punctuation">:</span> 10.x
    <span class="token key atrule">Mac_Node8</span><span class="token punctuation">:</span>
      <span class="token key atrule">imageName</span><span class="token punctuation">:</span> <span class="token string">'macos-10.14'</span>
      <span class="token key atrule">node_version</span><span class="token punctuation">:</span> 8.x
    <span class="token key atrule">Mac_Node10</span><span class="token punctuation">:</span>
      <span class="token key atrule">imageName</span><span class="token punctuation">:</span> <span class="token string">'macos-10.14'</span>
      <span class="token key atrule">node_version</span><span class="token punctuation">:</span> 10.x
    <span class="token key atrule">Windows_Node8</span><span class="token punctuation">:</span>
      <span class="token key atrule">imageName</span><span class="token punctuation">:</span> <span class="token string">'win1803'</span>
      <span class="token key atrule">node_version</span><span class="token punctuation">:</span> 8.x
    <span class="token key atrule">Windows_Node10</span><span class="token punctuation">:</span>
      <span class="token key atrule">imageName</span><span class="token punctuation">:</span> <span class="token string">'win1803'</span>
      <span class="token key atrule">node_version</span><span class="token punctuation">:</span> 10.x

<span class="token comment"># https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops#use-a-microsoft-hosted-agent</span>
<span class="token key atrule">pool</span><span class="token punctuation">:</span>
  <span class="token key atrule">vmImage</span><span class="token punctuation">:</span> $(imageName)

<span class="token key atrule">steps</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">task</span><span class="token punctuation">:</span> NodeTool@0
  <span class="token key atrule">inputs</span><span class="token punctuation">:</span>
    <span class="token key atrule">versionSpec</span><span class="token punctuation">:</span> $(node_version)
  <span class="token key atrule">displayName</span><span class="token punctuation">:</span> <span class="token string">'Install Node.js'</span>

<span class="token comment"># Make pipeline fail if tests or linting fail, linting occurs in `pretest` script</span>
<span class="token punctuation">-</span> <span class="token key atrule">bash</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    set -euo pipefail
    npm ci
    npm test</span>
  <span class="token key atrule">displayName</span><span class="token punctuation">:</span> <span class="token string">'Run tests'</span></code></pre></div>
<h5>Deployment</h5>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># pipelines/deploy.yml</span>

<span class="token key atrule">trigger</span><span class="token punctuation">:</span>
  <span class="token key atrule">branches</span><span class="token punctuation">:</span>
    <span class="token key atrule">include</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master

<span class="token comment"># https://docs.microsoft.com/en-us/azure/devops/pipelines/library/variable-groups?view=azure-devops&amp;tabs=yaml</span>
<span class="token key atrule">variables</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">group</span><span class="token punctuation">:</span> sls<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>creds

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>

<span class="token punctuation">-</span> <span class="token key atrule">job</span><span class="token punctuation">:</span> <span class="token string">"Deploy_Azure_Function_App"</span>
  <span class="token key atrule">timeoutInMinutes</span><span class="token punctuation">:</span> <span class="token number">30</span>
  <span class="token key atrule">cancelTimeoutInMinutes</span><span class="token punctuation">:</span> <span class="token number">1</span>

  <span class="token key atrule">pool</span><span class="token punctuation">:</span>
    <span class="token key atrule">vmImage</span><span class="token punctuation">:</span> <span class="token string">'ubuntu-16.04'</span>

  <span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">task</span><span class="token punctuation">:</span> NodeTool@0
    <span class="token key atrule">inputs</span><span class="token punctuation">:</span>
      <span class="token key atrule">versionSpec</span><span class="token punctuation">:</span> 10.x
    <span class="token key atrule">displayName</span><span class="token punctuation">:</span> <span class="token string">'Install Node.js'</span>

  <span class="token punctuation">-</span> <span class="token key atrule">bash</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      npm install -g serverless</span>
    <span class="token key atrule">displayName</span><span class="token punctuation">:</span> <span class="token string">'Install Serverless'</span>
    <span class="token comment"># Deploy service with prefix `gh`, stage `prod` and to region `West Europe`</span>
  <span class="token punctuation">-</span> <span class="token key atrule">bash</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      npm ci
      sls deploy --prefix gh --stage prod --region "West Europe"</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token comment"># Azure Service Principal. Secrets need to be mapped here</span>
      <span class="token comment"># USE THIS EXACT TEXT, DON'T COPY/PASTE YOUR CREDENTIALS HERE.</span>
      <span class="token comment"># Azure DevOps will use the variables within</span>
      <span class="token comment"># the variable group `sls-deploy-creds` to replace all the $() values</span>
      <span class="token key atrule">AZURE_SUBSCRIPTION_ID</span><span class="token punctuation">:</span> $(AZURE_SUBSCRIPTION_ID)
      <span class="token key atrule">AZURE_TENANT_ID</span><span class="token punctuation">:</span> $(AZURE_TENANT_ID)
      <span class="token key atrule">AZURE_CLIENT_ID</span><span class="token punctuation">:</span> $(AZURE_CLIENT_ID)
      <span class="token key atrule">AZURE_CLIENT_SECRET</span><span class="token punctuation">:</span> $(AZURE_CLIENT_SECRET)
    <span class="token key atrule">displayName</span><span class="token punctuation">:</span> <span class="token string">'Deploy Azure Function App'</span> </code></pre></div>
<p>Notice <a href="https://github.com/tbarlow12/sls-az-func-rest-api/blob/master/pipelines/deploy.yml#L30">this line</a> in the deployment pipeline that leverages our setup from Step 7. You might have multiple pipelines for the different stages, you might dynamically infer these values from the branch name or you might just provide the values as environment variables. The point of the setup in Step 7 was to provide you the flexibility to deploy your service to wherever you see fit at the time, without needing to change your <code class="language-text">serverless.yml</code> file.</p>
<h4>Concluding Thoughts</h4>
<p>A big part of our reason for investing time and effort into the <code class="language-text">serverless-azure-functions</code> plugin was so that developers could easily deploy <a href="https://www.serverless.com/framework/docs/providers/azure/">Azure Functions</a> to solve more real-world, business-level scenarios. We hope that as you use the tool and discover areas for improvement that you’ll <a href="https://github.com/serverless/serverless-azure-functions/issues/new/choose">file issues on the repo</a> or even open up a <a href="https://github.com/serverless/serverless-azure-functions/pulls">pull request</a>.</p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAUBAgME/8QAFwEBAAMAAAAAAAAAAAAAAAAAAgABA//aAAwDAQACEAMQAAABtTuWpVlGVPBk0HAFf//EABsQAAICAwEAAAAAAAAAAAAAAAECAxMAESMk/9oACAEBAAEFAnOlgZ7cvIZnEYuxj6ZjxjOh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQEiH/2gAIAQMBAT8BwqOP/8QAGREAAQUAAAAAAAAAAAAAAAAAAAEQEiEx/9oACAECAQE/AbJCY3//xAAgEAABAgUFAAAAAAAAAAAAAAABABECAxASITFBYYGR/9oACAEBAAY/Ai2qYx3A0tPifYlsLBBT8qX3T//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hRVcZF9KXnJkRaRWsbCd3oQNMD6x1eoRshVw76T//2gAMAwEAAgADAAAAENvoAP/EABkRAAIDAQAAAAAAAAAAAAAAAAABESExUf/aAAgBAwEBPxCEpsj00xYf/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAEQESExUf/aAAgBAgEBPxBNs0X5A9n/xAAeEAEBAQACAQUAAAAAAAAAAAABEQAhMUFRYXGBkf/aAAgBAQABPxClwdnV0whQo4lO/wAzyyrjkGw+cZbkILxecbfXBH7zSeBntAmta2n5uEBbXZ4N/9k=" alt="Kyle Mathews" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" src="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg" alt="Kyle Mathews" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Kyle Mathews</strong> <!-- -->who lives and works in San Francisco building useful things.<!-- --> <a href="https://twitter.com/kylemathews">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/lumen/posts/2019-10-02-easily-deploy-graphql-apis-with-serverless-components/">← <!-- -->Easily Deploy GraphQL APIs with Serverless Components</a></li><li><a rel="next" href="/lumen/posts/2019-10-14-serverless-deployment-best-practices/">Serverless Deployment Best Practices<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/2019-10-10-serverless-azure-functions-v1-part2/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-36e457a5393b79b99515.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9578b926700cf49bb4fc.js"],"component---src-pages-index-js":["/component---src-pages-index-js-753a3f9bde0636fce206.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-f16d60f62c7d2b3e9bcc.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"]};/*]]>*/</script><script src="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js" async=""></script><script src="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js" async=""></script><script src="/lumen/commons-4c36ffabef1434ec1126.js" async=""></script><script src="/lumen/app-36e457a5393b79b99515.js" async=""></script><script src="/lumen/styles-cd63080e784be7b7e7cf.js" async=""></script><script src="/lumen/framework-5fc6169171e885c3b522.js" async=""></script><script src="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js" async=""></script></body></html>