<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/lumen/styles.1d0daeadf0762b76da98.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/lumen/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/lumen/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/lumen/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/lumen/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/lumen/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/lumen/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/lumen/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/lumen/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/lumen/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/lumen/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/lumen/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/lumen/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/lumen/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/lumen/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/lumen/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/lumen/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/lumen/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/lumen/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/lumen/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/lumen/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/lumen/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/lumen/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/lumen/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/lumen/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/lumen/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/lumen/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.23.12"/><link rel="alternate" type="application/rss+xml" href="/lumen/rss.xml"/><link rel="icon" href="/lumen/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/lumen/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/lumen/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/lumen/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/lumen/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/lumen/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/lumen/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/lumen/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/lumen/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/lumen/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">Building A Serverless Screenshot Service with Lambda | Gatsby Starter Blog</title><meta data-react-helmet="true" name="description" content="Guest author Sander van de Graaf writes about building a serverless screenshot service with the Serverless Framework and AWS Lambda."/><meta data-react-helmet="true" property="og:title" content="Building A Serverless Screenshot Service with Lambda"/><meta data-react-helmet="true" property="og:description" content="Guest author Sander van de Graaf writes about building a serverless screenshot service with the Serverless Framework and AWS Lambda."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="kylemathews"/><meta data-react-helmet="true" name="twitter:title" content="Building A Serverless Screenshot Service with Lambda"/><meta data-react-helmet="true" name="twitter:description" content="Guest author Sander van de Graaf writes about building a serverless screenshot service with the Serverless Framework and AWS Lambda."/><link as="script" rel="preload" href="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js"/><link as="script" rel="preload" href="/lumen/framework-5fc6169171e885c3b522.js"/><link as="script" rel="preload" href="/lumen/styles-cd63080e784be7b7e7cf.js"/><link as="script" rel="preload" href="/lumen/app-36e457a5393b79b99515.js"/><link as="script" rel="preload" href="/lumen/commons-4c36ffabef1434ec1126.js"/><link as="script" rel="preload" href="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js"/><link as="script" rel="preload" href="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"/><link as="fetch" rel="preload" href="/lumen/page-data/posts/2016-10-14-building-a-serverless-screenshot-service-with-lambda/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/lumen/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;color:inherit" href="/lumen/">Gatsby Starter Blog</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">Building A Serverless Screenshot Service with Lambda</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">October 14, 2016</p></header><section><p>A client recently requested a feature involving screenshots of random URLs. Now, there are several services out there that will do this for you. Most of these services have interesting REST APIs and pricing models, but I really wanted to develop something with <a href="https://serverless.com/">Serverless</a>. So I took this opportunity to check it out.</p>
<p>This application will run on AWS Lambda. You can find all the source code mentioned in <a href="https://github.com/svdgraaf/serverless-screenshot">this repository</a>.</p>
<h1><strong>Quick installation</strong></h1>
<p>If you just want to launch the service yourself, you can use this button which will setup everything for you in your AWS account through the magic of CloudFormation:</p>
<p><a href="https://console.aws.amazon.com/cloudformation/home?region=eu-west-1#/stacks/new?stackName=serverless-screenshot-service&#x26;templateURL=https://s3-eu-west-1.amazonaws.com/serverless-screenshots-service/2016-09-23T12%3A50%3A03/template.yml"><img src="https://s3.amazonaws.com/cloudformation-examples/cloudformation-launch-stack.png" alt="Launch Awesomeness"></a></p>
<h2><strong>Overview</strong></h2>
<p>We’re going to create a service to which we can <code class="language-text">POST</code> a URL. It will capture and store a screenshot of the given URL for us, then return a URL where we can download the screenshot. We also want to generate different thumbnail sizes of every screenshot, and we want to be able to list all the available thumbnail sizes of a URL.</p>
<p>The architecture of what we’re going to build, looks like this:</p>
<p><img src="https://github.com/svdgraaf/serverless-screenshot/raw/master/docs/architecture.png" alt="Lambda Screenshot Architecture"></p>
<p><em>Architecture for this project</em></p>
<p>The app posts to <a href="https://aws.amazon.com/api-gateway/">API Gateway</a>, which triggers a Lambda function that will take the screenshot and upload it to the S3 bucket. It will then return the URL for the created screenshot.</p>
<p>When the file gets uploaded (putObject) to the S3 bucket, it will trigger the <code class="language-text">Create Thumbnails</code> function, which will take the screenshot as input and use ImageMagick to create several thumbnail versions of the given image, and then upload those to the same bucket.</p>
<p>Lastly, there will be a function that the app can call to get a list of all available thumbnail sizes. The app can use the returned URLs to present them to the end user and their browser will download it through <a href="https://aws.amazon.com/cloudfront/">CloudFront</a> from S3.</p>
<p>You can find all the source code for this project in this <a href="https://github.com/svdgraaf/serverless-screenshot">repository</a>.</p>
<h2><strong>List of resources</strong></h2>
<p>For this project we’re going to need to setup:</p>
<ul>
<li>One Lambda function triggered by a <code class="language-text">POST</code> event</li>
<li>One Lambda function triggered by a <code class="language-text">GET</code> event</li>
<li>One Lambda function triggered by an S3 <code class="language-text">CreateObject</code> event</li>
<li>Extra IAM Role access for the screenshot bucket</li>
<li>An S3 bucket for the screenshots</li>
<li>A CloudFront distribution for serving the screenshots</li>
</ul>
<h1><strong>Getting Started</strong></h1>
<p>This is my first project in Node.js, so bear with me (I’m more of a Python guy). Any tips or PRs are greatly appreciated.</p>
<p>When you download the project you can just run a <code class="language-text">npm install</code> to install all of the requirements and get started. Keep reading if you want to follow along from scratch. Be sure to install the latest Serverless version (<code class="language-text">npm install -g serverless</code>).</p>
<p>We’ll start the project by creating a new project in the current directory:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">serverless create --template aws-nodejs</code></pre></div>
<p>We now have a directory with a couple of files:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">ls</span> -l
total <span class="token number">32</span>
-rw-r--r--  <span class="token number">1</span> svdgraaf  staff    <span class="token number">54</span> Sep  <span class="token number">6</span> <span class="token number">19</span>:44 README.md
-rw-r--r--  <span class="token number">1</span> svdgraaf  staff    <span class="token number">63</span> Sep  <span class="token number">6</span> <span class="token number">19</span>:48 event.json
-rw-r--r--  <span class="token number">1</span> svdgraaf  staff   <span class="token number">128</span> Sep  <span class="token number">6</span> <span class="token number">19</span>:48 handler.js
-rw-r--r--  <span class="token number">1</span> svdgraaf  staff  <span class="token number">1754</span> Sep  <span class="token number">6</span> <span class="token number">19</span>:48 serverless.yml</code></pre></div>
<p>The <code class="language-text">handler.js</code> file will contain our functions, and with <code class="language-text">event.json</code> we can simulate our calls. I later moved this to an <code class="language-text">events</code> directory so I could simulate multiple events for the other calls.</p>
<p>Let’s first take a look at the <code class="language-text">serverless.yml</code> file that contains the configuration for our Service.</p>
<h2><strong>Provider configuration</strong></h2>
<p>First, we need to setup our provider configuration—in this case we’ll use <code class="language-text">aws</code>, with <code class="language-text">nodejs4.3</code>. We’ll also add an API key so we can securely use our API, and add some IAM rules to allow the functions to list and upload to the S3 bucket.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">provider</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> aws
  <span class="token key atrule">runtime</span><span class="token punctuation">:</span> nodejs4.3
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> dev

  <span class="token comment"># We want to lock down the ApiGateway, so we can control who can use the api</span>
  <span class="token key atrule">apiKeys</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> thumbnail<span class="token punctuation">-</span>api<span class="token punctuation">-</span>key

  <span class="token comment"># We need to give the lambda functions access to list and write to our bucket, it needs:</span>
  <span class="token comment"># - to be able to 'list' the bucket</span>
  <span class="token comment"># - to be able to upload a file (PutObject)</span>
  <span class="token key atrule">iamRoleStatements</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">Effect</span><span class="token punctuation">:</span> <span class="token string">"Allow"</span>
     <span class="token key atrule">Action</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"s3:ListBucket"</span>
        <span class="token punctuation">-</span> <span class="token string">"s3:PutObject"</span>
      <span class="token key atrule">Resource</span><span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token key atrule">"Fn::Join"</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"arn:aws:s3:::"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token key atrule">"Ref"</span> <span class="token punctuation">:</span> <span class="token string">"ThumbnailBucket"</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span>  <span class="token punctuation">}</span></code></pre></div>
<h2><strong>Functions</strong></h2>
<p>We need to create three functions: one for taking a screenshot (called, you guessed it: <code class="language-text">takeScreenshot</code>), one for creating a thumbnail of the screenshots (<code class="language-text">createThumbnails</code>), and one for listing the available screenshot sizes (<code class="language-text">listScreenshots</code>).</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">takeScreenshot</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> handler.take_screenshot
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">15</span>  <span class="token comment"># our screenshots can take a while sometimes</span>
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> screenshots
          <span class="token key atrule">method</span><span class="token punctuation">:</span> post
          <span class="token comment"># Marking the function as private will require a valid api-key</span>
          <span class="token key atrule">private</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">request</span><span class="token punctuation">:</span>
            <span class="token comment"># we want to mark the url param as required</span>
            <span class="token key atrule">parameters</span><span class="token punctuation">:</span>
              <span class="token key atrule">querystrings</span><span class="token punctuation">:</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token key atrule">listScreenshots</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> handler.list_screenshots
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">15</span>
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> screenshots
          <span class="token key atrule">method</span><span class="token punctuation">:</span> get
          <span class="token key atrule">private</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token key atrule">request</span><span class="token punctuation">:</span>
            <span class="token key atrule">parameters</span><span class="token punctuation">:</span>
              <span class="token key atrule">querystrings</span><span class="token punctuation">:</span>
                <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token key atrule">createThumbnails</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> handler.create_thumbnails
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token comment"># this event type will also create the screenshots bucket and trigger</span>
      <span class="token comment"># the lambda function every time a file is uploaded (ObjectCreated)</span>
      <span class="token punctuation">-</span> <span class="token key atrule">s3</span><span class="token punctuation">:</span>
          <span class="token key atrule">bucket</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>self<span class="token punctuation">:</span>custom.bucket_name<span class="token punctuation">}</span>
          <span class="token key atrule">event</span><span class="token punctuation">:</span> s3<span class="token punctuation">:</span>ObjectCreated<span class="token punctuation">:</span>*</code></pre></div>
<h2><strong>Custom Resources</strong></h2>
<p>We also need a CloudFront distribution to serve our screenshots. This is not supported by Serverless out of the box, so we need to create a custom resource for it. We’ll also define some <code class="language-text">Output</code>s, so we can use these later on.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">Outputs</span><span class="token punctuation">:</span>
    <span class="token key atrule">ScreenshotBucket</span><span class="token punctuation">:</span>
      <span class="token key atrule">Description</span><span class="token punctuation">:</span> <span class="token string">"Screenshot bucket name"</span>
      <span class="token key atrule">Value</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>self<span class="token punctuation">:</span>custom.bucket_name<span class="token punctuation">}</span>
    <span class="token key atrule">CloudFrontUrl</span><span class="token punctuation">:</span>
      <span class="token key atrule">Description</span><span class="token punctuation">:</span> <span class="token string">"CloudFront url"</span>
      <span class="token key atrule">Value</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">"Fn::GetAtt"</span><span class="token punctuation">:</span> <span class="token string">"CloudFrontEndpoint.DomainName"</span><span class="token punctuation">}</span>

  <span class="token key atrule">Resources</span><span class="token punctuation">:</span>
    <span class="token comment"># Create an endpoint for the S3 bucket in CloudFront</span>
    <span class="token comment"># this configuration basically just sets up a forwarding of requests</span>
    <span class="token comment"># to S3, and forces all traffic to https</span>
    <span class="token key atrule">CloudFrontEndpoint</span><span class="token punctuation">:</span>
      <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>CloudFront<span class="token punctuation">:</span><span class="token punctuation">:</span>Distribution
      <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
        <span class="token key atrule">DistributionConfig</span><span class="token punctuation">:</span>
          <span class="token key atrule">Enabled</span><span class="token punctuation">:</span> <span class="token boolean important">True</span>
          <span class="token key atrule">DefaultCacheBehavior</span><span class="token punctuation">:</span>
            <span class="token key atrule">TargetOriginId</span><span class="token punctuation">:</span> ScreenshotBucketOrigin
            <span class="token key atrule">ViewerProtocolPolicy</span><span class="token punctuation">:</span> redirect<span class="token punctuation">-</span>to<span class="token punctuation">-</span>https
            <span class="token key atrule">ForwardedValues</span><span class="token punctuation">:</span>
              <span class="token key atrule">QueryString</span><span class="token punctuation">:</span> <span class="token boolean important">True</span>
          <span class="token key atrule">Origins</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span>
              <span class="token key atrule">Id</span><span class="token punctuation">:</span> ScreenshotBucketOrigin
              <span class="token key atrule">DomainName</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>self<span class="token punctuation">:</span>custom.bucket_name<span class="token punctuation">}</span>.s3.amazonaws.com
              <span class="token key atrule">CustomOriginConfig</span><span class="token punctuation">:</span>
                <span class="token key atrule">OriginProtocolPolicy</span><span class="token punctuation">:</span> http<span class="token punctuation">-</span>only</code></pre></div>
<h2><strong>Plugin variables</strong></h2>
<p>We use the <a href="https://www.npmjs.com/package/serverless-plugin-stage-variables">stage-variables</a> plugin so we can set stage variables in API Gateway, which we can then use in our Lambda functions. You can configure them in the <code class="language-text">custom</code> section. This also allows us to use <a href="https://aws.amazon.com/cloudformation/">CloudFormation</a> references inside our Lambda functions. CloudFormation will fill in the values with the actual output for us.</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">custom</span><span class="token punctuation">:</span>
  <span class="token comment"># change this, so it's unique for your setup</span>
  <span class="token key atrule">bucket_name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>self<span class="token punctuation">:</span>provider.stage<span class="token punctuation">,</span>opt<span class="token punctuation">:</span>stage<span class="token punctuation">}</span><span class="token punctuation">-</span>$<span class="token punctuation">{</span>env<span class="token punctuation">:</span>USER<span class="token punctuation">}</span><span class="token punctuation">-</span>screenshots

  <span class="token comment"># these variables are passed on through ApiGateway, to be used</span>
  <span class="token comment"># in your functions in the event.stageVariables</span>
  <span class="token key atrule">stageVariables</span><span class="token punctuation">:</span>
    <span class="token key atrule">bucketName</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>self<span class="token punctuation">:</span>custom.bucket_name<span class="token punctuation">}</span>
    <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">"Fn::Join"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"https://"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token key atrule">"Fn::GetAtt"</span><span class="token punctuation">:</span> <span class="token string">"CloudFrontEndpoint.DomainName"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre></div>
<h1><strong>Defining functions</strong></h1>
<p>You should define your functions in the <code class="language-text">handler.js</code> file. In our case, it will hold three functions: <code class="language-text">take_screenshot</code>, <code class="language-text">list_screenshots</code> and <code class="language-text">create_thumbnails</code>. You can use the <code class="language-text">handler</code> definition in the <code class="language-text">functions</code> section of <code class="language-text">serverless.yml</code> to give you the option of using different files if you want to separate them. The actual implementations of the functions are in the <a href="https://github.com/svdgraaf/serverless-screenshot/blob/master/handler.js">repository</a>.</p>
<p>The functions will always receive three variables: <code class="language-text">event</code>, <code class="language-text">context</code> and <code class="language-text">cb</code>. The <code class="language-text">event</code> will contain the event that triggered the Lambda (in our case, either an API Gateway call or the S3 bucket event). The <code class="language-text">context</code> variable contains the Lambda context to find out how much memory you have—the platform, etc. The <code class="language-text">cb</code> (callback) variable can be used to signal for error or success.</p>
<h2><strong>Event variables</strong></h2>
<p>You will receive different events depending on which service it came from. In the case of our API Gateway events, we get a lot of info—headers, query parameters, stage variables, etc. In our case, we’re only using <code class="language-text">event.query</code> and <code class="language-text">event.stageVariables</code>, but there is also <code class="language-text">event.headers</code>, <code class="language-text">event.body</code>, etc. The mapping to the event is defined by Serverless, and the default mapping (and fields) can be seen in the <a href="https://github.com/serverless/serverless/blob/master/lib/plugins/aws/deploy/compile/events/apiGateway/lib/methods.js#L98">repository</a>.</p>
<h2><strong>Extra binaries</strong></h2>
<p>For this project we will need some extra binaries (<a href="http://phantomjs.org/">PhantomJS</a> in particular) to take the screenshots. We’ll also use <a href="http://www.imagemagick.org/script/index.php">ImageMagick</a>, but that is provided by AWS by default in the Lambda image, so we don’t package it separately.</p>
<p>Serverless will package any extra files in the project directory automatically, so adding extra binaries is as simple as just creating a directory and adding the files.</p>
<p>If you need compiled binaries you can use <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html">Amazon Machine Images (AMI)</a> to spin up an EC2 instance (or use this easy <a href="https://hub.docker.com/r/lambci/lambda/">docker container</a>), compile <a href="http://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html">your own binaries</a>, and copy them over to your project. The <a href="https://github.com/svdgraaf/serverless-screenshot">project repository</a> already contains the binaries you can use.</p>
<h1><strong>Deploying</strong></h1>
<p>We can deploy the application now that we have everything in place. It’s a good idea to use different deployment environments, so let’s start with a <code class="language-text">dev</code> environment: <code class="language-text">sls deploy -s dev</code>. This will zip everything together (including the binaries), create a deployment bucket, upload the zip file, and update the CloudFormation template with all the resources that we need.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">sls deploy -s dev --verbose</code></pre></div>
<p>(the <code class="language-text">--verbose</code> will show you all the CloudFormation output during deployment, very nice!).</p>
<p>After the deployment is done, you will see the end results:</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml">Service Information
<span class="token key atrule">service</span><span class="token punctuation">:</span> lambda<span class="token punctuation">-</span>screenshots
<span class="token key atrule">stage</span><span class="token punctuation">:</span> dev
<span class="token key atrule">region</span><span class="token punctuation">:</span> us<span class="token punctuation">-</span>east<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
  POST <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//123g1jc802.execute<span class="token punctuation">-</span>api.us<span class="token punctuation">-</span>east<span class="token punctuation">-</span>1.amazonaws.com/dev/screenshots
  GET <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//123g1jc802.execute<span class="token punctuation">-</span>api.us<span class="token punctuation">-</span>east<span class="token punctuation">-</span>1.amazonaws.com/dev/screenshots
<span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">lambda-screenshots-dev-listScreenshots</span><span class="token punctuation">:</span> arn<span class="token punctuation">:</span>aws<span class="token punctuation">:</span>lambda<span class="token punctuation">:</span>us<span class="token punctuation">-</span>east<span class="token punctuation">-</span>1<span class="token punctuation">:</span>123123123123<span class="token punctuation">:</span>function<span class="token punctuation">:</span>lambda<span class="token punctuation">-</span>screenshots<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>listScreenshots
  <span class="token key atrule">lambda-screenshots-dev-createThumbnails</span><span class="token punctuation">:</span> arn<span class="token punctuation">:</span>aws<span class="token punctuation">:</span>lambda<span class="token punctuation">:</span>us<span class="token punctuation">-</span>east<span class="token punctuation">-</span>1<span class="token punctuation">:</span>123123123123<span class="token punctuation">:</span>function<span class="token punctuation">:</span>lambda<span class="token punctuation">-</span>screenshots<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>createThumbnails
  <span class="token key atrule">lambda-screenshots-dev-takeScreenshot</span><span class="token punctuation">:</span> arn<span class="token punctuation">:</span>aws<span class="token punctuation">:</span>lambda<span class="token punctuation">:</span>us<span class="token punctuation">-</span>east<span class="token punctuation">-</span>1<span class="token punctuation">:</span>123123123123<span class="token punctuation">:</span>function<span class="token punctuation">:</span>lambda<span class="token punctuation">-</span>screenshots<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>takeScreenshot</code></pre></div>
<p><strong>Awesome!</strong> Everything is up and running.</p>
<h1><strong>Using the Service</strong></h1>
<p>We can test our service now that everything is deployed. You can use your favorite http client like <code class="language-text">curl</code> or <code class="language-text">postman</code> for this.</p>
<p>Since we configured our APIs to use API keys, we need to provide a valid API key with each request. Just add a head <code class="language-text">x-api-key</code> with each request and it should work. You can grab the API keys from the API Gateway console or from the Serverless output with <code class="language-text">sls info</code>.</p>
<h2><strong>Creating a screenshot</strong></h2>
<p>To create a screenshot for <code class="language-text">google.com</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> -X POST https://123g1jc802.execute-api.us-east-1.amazonaws.com/dev/screenshots?url<span class="token operator">=</span>http://google.com/ -H <span class="token string">"x-api-key: [yourkey]"</span>
<span class="token punctuation">{</span>
	<span class="token string">"hash"</span><span class="token builtin class-name">:</span> <span class="token string">"6ab016b2dad7ba49a992ba0213a91cf8"</span>,
	<span class="token string">"key"</span><span class="token builtin class-name">:</span> <span class="token string">"6ab016b2dad7ba49a992ba0213a91cf8/original.png"</span>,
	<span class="token string">"bucket"</span><span class="token builtin class-name">:</span> <span class="token string">"dev-foobar-screenshots"</span>,
	<span class="token string">"url"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/original.png"</span>
<span class="token punctuation">}</span></code></pre></div>
<h2><strong>Listing all screenshot sizes</strong></h2>
<p>To get all the different available sizes for <code class="language-text">google.com</code>:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> -X GET https://123g1jc802.execute-api.us-east-1.amazonaws.com/dev/screenshots?url<span class="token operator">=</span>http://google.com/ -H <span class="token string">"x-api-key: [yourkey]"</span>
<span class="token punctuation">{</span>
	<span class="token string">"100"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/100.png"</span>,
	<span class="token string">"200"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/200.png"</span>,
	<span class="token string">"320"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/320.png"</span>,
	<span class="token string">"400"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/400.png"</span>,
	<span class="token string">"640"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/640.png"</span>,
	<span class="token string">"800"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/800.png"</span>,
	<span class="token string">"1024"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/1024.png"</span>,
	<span class="token string">"1024x768"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/1024x768.png"</span>,
	<span class="token string">"320x240"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/320x240.png"</span>,
	<span class="token string">"640x480"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/640x480.png"</span>,
	<span class="token string">"800x600"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/800x600.png"</span>,
	<span class="token string">"original"</span><span class="token builtin class-name">:</span> <span class="token string">"https://foobar.cloudfront.net/6ab016b2dad7ba49a992ba0213a91cf8/original.png"</span>
<span class="token punctuation">}</span></code></pre></div>
<h1><strong>Cost</strong></h1>
<p>So how much will this cost you? If every call takes approximately 10 seconds (which is a safe bet, usually they are way faster). You could make 250 calls per month in the free tier, which wouldn’t cost you a thing.</p>
<p>So creating at least 100.000 screenshots <strong>per month</strong> with 15 thumbnails per screenshot would be absolutely free.</p>
<h1><strong>Conclusion</strong></h1>
<p>Taking screenshots with Lambda Wheneveris a great solution. There’s no need to setup queuing, batch workers, etc. Lambda can handle the screenshots, thumbnails and storage.  a request comes in, it will automatically spin up, auto scaling to whatever you need.</p>
<p>Serverless makes it really easy to setup, configure and deploy your microservices. It’s a seamless process to extend your services with other AWS services you might need for your project.</p>
<p><a href="https://console.aws.amazon.com/cloudformation/home?region=eu-west-1#/stacks/new?stackName=serverless-screenshot-service&#x26;templateURL=https://s3-eu-west-1.amazonaws.com/serverless-screenshots-service/2016-09-23T12%3A50%3A03/template.yml"><img src="https://s3.amazonaws.com/cloudformation-examples/cloudformation-launch-stack.png" alt="Launch Awesomeness"></a></p>
<p><strong>Give it a try!</strong></p>
<hr>
<p><em>This is a guest post from <a href="http://svdgraaf.nl">Sander van de Graaf</a>. Sander is a freelance Cloud Solutions Architect specializing in AWS environments and large, high-volume applications. You can reach him on <a href="http://twitter.com/svdgraaf">Twitter</a>, <a href="https://www.linkedin.com/in/svdgraaf">LinkedIn</a> or via <a href="mailto:mail@svdgraaf.nl">email</a>.</em></p>
<p><strong><em>Interested in writing for the Serverless blog? Find more info on contributing <a href="https://serverless.com/blog/contribute/">here</a>.</em></strong></p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAUBAgME/8QAFwEBAAMAAAAAAAAAAAAAAAAAAgABA//aAAwDAQACEAMQAAABtTuWpVlGVPBk0HAFf//EABsQAAICAwEAAAAAAAAAAAAAAAECAxMAESMk/9oACAEBAAEFAnOlgZ7cvIZnEYuxj6ZjxjOh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQEiH/2gAIAQMBAT8BwqOP/8QAGREAAQUAAAAAAAAAAAAAAAAAAAEQEiEx/9oACAECAQE/AbJCY3//xAAgEAABAgUFAAAAAAAAAAAAAAABABECAxASITFBYYGR/9oACAEBAAY/Ai2qYx3A0tPifYlsLBBT8qX3T//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hRVcZF9KXnJkRaRWsbCd3oQNMD6x1eoRshVw76T//2gAMAwEAAgADAAAAENvoAP/EABkRAAIDAQAAAAAAAAAAAAAAAAABESExUf/aAAgBAwEBPxCEpsj00xYf/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAEQESExUf/aAAgBAgEBPxBNs0X5A9n/xAAeEAEBAQACAQUAAAAAAAAAAAABEQAhMUFRYXGBkf/aAAgBAQABPxClwdnV0whQo4lO/wAzyyrjkGw+cZbkILxecbfXBH7zSeBntAmta2n5uEBbXZ4N/9k=" alt="Kyle Mathews" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" src="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg" alt="Kyle Mathews" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Kyle Mathews</strong> <!-- -->who lives and works in San Francisco building useful things.<!-- --> <a href="https://twitter.com/kylemathews">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/lumen/posts/2016-10-12-releasing-serverless-framework-v1-and-fundraising/">← <!-- -->Releasing Serverless Framework V.1 &amp; Fundraising</a></li><li><a rel="next" href="/lumen/posts/2016-10-18-introducing-serverless-partners-meet-trek10/">Introducing Serverless Partners: Meet Trek10<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/2016-10-14-building-a-serverless-screenshot-service-with-lambda/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-36e457a5393b79b99515.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9578b926700cf49bb4fc.js"],"component---src-pages-index-js":["/component---src-pages-index-js-753a3f9bde0636fce206.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-f16d60f62c7d2b3e9bcc.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"]};/*]]>*/</script><script src="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js" async=""></script><script src="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js" async=""></script><script src="/lumen/commons-4c36ffabef1434ec1126.js" async=""></script><script src="/lumen/app-36e457a5393b79b99515.js" async=""></script><script src="/lumen/styles-cd63080e784be7b7e7cf.js" async=""></script><script src="/lumen/framework-5fc6169171e885c3b522.js" async=""></script><script src="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js" async=""></script></body></html>