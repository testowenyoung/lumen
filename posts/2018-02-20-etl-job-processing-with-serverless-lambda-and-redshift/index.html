<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/lumen/styles.1d0daeadf0762b76da98.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/lumen/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/lumen/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/lumen/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/lumen/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/lumen/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/lumen/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/lumen/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/lumen/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/lumen/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/lumen/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/lumen/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/lumen/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/lumen/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/lumen/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/lumen/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/lumen/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/lumen/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/lumen/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/lumen/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/lumen/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/lumen/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/lumen/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/lumen/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/lumen/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/lumen/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/lumen/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.23.12"/><link rel="alternate" type="application/rss+xml" href="/lumen/rss.xml"/><link rel="icon" href="/lumen/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/lumen/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/lumen/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/lumen/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/lumen/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/lumen/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/lumen/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/lumen/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/lumen/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/lumen/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">ETL job processing with Serverless, Lambda, and AWS Redshift | Gatsby Starter Blog</title><meta data-react-helmet="true" name="description" content="Build an ETL job service by fetching data from a public API endpoint and dumping it into an AWS Redshift database."/><meta data-react-helmet="true" property="og:title" content="ETL job processing with Serverless, Lambda, and AWS Redshift"/><meta data-react-helmet="true" property="og:description" content="Build an ETL job service by fetching data from a public API endpoint and dumping it into an AWS Redshift database."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="kylemathews"/><meta data-react-helmet="true" name="twitter:title" content="ETL job processing with Serverless, Lambda, and AWS Redshift"/><meta data-react-helmet="true" name="twitter:description" content="Build an ETL job service by fetching data from a public API endpoint and dumping it into an AWS Redshift database."/><link as="script" rel="preload" href="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js"/><link as="script" rel="preload" href="/lumen/framework-5fc6169171e885c3b522.js"/><link as="script" rel="preload" href="/lumen/styles-cd63080e784be7b7e7cf.js"/><link as="script" rel="preload" href="/lumen/app-36e457a5393b79b99515.js"/><link as="script" rel="preload" href="/lumen/commons-4c36ffabef1434ec1126.js"/><link as="script" rel="preload" href="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js"/><link as="script" rel="preload" href="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"/><link as="fetch" rel="preload" href="/lumen/page-data/posts/2018-02-20-etl-job-processing-with-serverless-lambda-and-redshift/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/lumen/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;color:inherit" href="/lumen/">Gatsby Starter Blog</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">ETL job processing with Serverless, Lambda, and AWS Redshift</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">February 20, 2018</p></header><section><p>One of the big use cases of using serverless is ETL job processing: dumping data into a database, and possibily visualizing the data.</p>
<p>In this post, I’ll go over the process step by step. We’ll build a serverless ETL job service that will fetch data from a public API endpoint and dump it into an AWS Redshift database. The service will be scheduled to run every hour, and we’ll visualize the data using Chart.io.</p>
<p>At Serverless Inc., we use ETL jobs just like this for tracking metrics across an array of data points (though feel free to modify the one I’ll show here to fit your own needs).</p>
<p>Let’s get to it.</p>
<p>What we will cover:</p>
<ul>
<li>Prerequisites</li>
<li>Creating the ETL job service</li>
<li>Deploying and scheduling the job</li>
<li>Visualizing the data</li>
</ul>
<h2>Prerequisites</h2>
<p>Before we begin, you’ll need the <a href="https://serverless.com/framework/docs/providers/aws/guide/quick-start/">Serverless Framework installed</a> with an AWS account set up. Your version of Serverless must be 1.25 or higher to take advantage of all the latest updates.</p>
<h3>AWS Redshift</h3>
<p>Setting up AWS Redshift is out of the scope of this post, but you’ll need one set up to dump data into it from our ETL job. Once you have it set up and configured, keep the cluster endpoint in Redshift handy, as we will need it later to configure the database connection string.</p>
<p>Redshift cluster endpoint:</p>
<p><code class="language-text">&lt;cluster_name&gt;.xxxxxxxxxxxx.&lt;region&gt;.redshift.amazonaws.com:&lt;port&gt;</code></p>
<p>DB connection string:</p>
<p><code class="language-text">postgres://&lt;username&gt;:&lt;password&gt;@&lt;hostname&gt;:&lt;port&gt;/&lt;db_name&gt;</code>
where <code class="language-text">&lt;hostname&gt;:&lt;port&gt;</code> is the cluster endpoint.</p>
<h2>Building the ETL job service</h2>
<p>My previous projects were in Node.js, but I’m going to write this in Python because I have recently started to play with Python. And, (to the chagrin ofmy colleague <a href="https://twitter.com/alexbdebrie">Alex DeBrie</a> I love it! But you can write this in any language you want.</p>
<p>Let’s create a new Serverless project from a template. Use the <code class="language-text">sls create</code> command and change into that directory:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ sls create -t aws-python3 -p serverless-etl
$ <span class="token builtin class-name">cd</span> serverless-etl</code></pre></div>
<p>Next, let’s install some required dependencies.</p>
<p>We’ll use the <code class="language-text">serverless-python-requirements</code> plugin for handling our Python packages on deployment:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> --save-dev serverless-python-requirements</code></pre></div>
<p><strong>Note:</strong> If you want a deeper dive on the <code class="language-text">serverless-python-requirements</code> plugin, check out our previous post on <a href="https://serverless.com/blog/serverless-python-packaging/">handling Python packaging with Serverless</a>.</p>
<p>With the dependencies out of the way, let’s get started. Replace the <code class="language-text">serverless.yml</code> file contents with the following <code class="language-text">yaml</code> code:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">service</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>etl

<span class="token key atrule">plugins</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> serverless<span class="token punctuation">-</span>python<span class="token punctuation">-</span>requirements

<span class="token key atrule">custom</span><span class="token punctuation">:</span>
  <span class="token key atrule">pythonRequirements</span><span class="token punctuation">:</span>
    <span class="token key atrule">dockerizePip</span><span class="token punctuation">:</span> non<span class="token punctuation">-</span>linux
  <span class="token key atrule">dbConn</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>ssm<span class="token punctuation">:</span>/ETL/RedshiftConn~true<span class="token punctuation">}</span>

<span class="token key atrule">provider</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> aws
  <span class="token key atrule">runtime</span><span class="token punctuation">:</span> python3.6
  <span class="token key atrule">region</span><span class="token punctuation">:</span> us<span class="token punctuation">-</span>west<span class="token punctuation">-</span><span class="token number">2</span>
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">300</span>
  <span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token key atrule">DB_CONN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>self<span class="token punctuation">:</span>custom.dbConn<span class="token punctuation">}</span>
  <span class="token key atrule">vpc</span><span class="token punctuation">:</span>
    <span class="token key atrule">securityGroupIds</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sg<span class="token punctuation">-</span>xxxxxxx
    <span class="token key atrule">subnetIds</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> subnet<span class="token punctuation">-</span>xxxxxxx
  <span class="token key atrule">iamRoleStatements</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">Effect</span><span class="token punctuation">:</span> Allow
      <span class="token key atrule">Action</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"ec2:CreateNetworkInterface"</span>
      <span class="token key atrule">Resource</span><span class="token punctuation">:</span> <span class="token string">"*"</span>

<span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">etlSample</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> handler.main
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">schedule</span><span class="token punctuation">:</span> rate(1 hour)</code></pre></div>
<p>Let’s review the above <code class="language-text">serverless.yml</code> configuration for our service.</p>
<p>We need to specify the connection string to the Redshift postgres database. You’ll notice I have used the AWS Parameter Store (SSM) to store the connection string for obvious security reasons:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">custom</span><span class="token punctuation">:</span>
  <span class="token punctuation">...</span>
  <span class="token key atrule">dbConn</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>ssm<span class="token punctuation">:</span>/ETL/RedshiftConn~true<span class="token punctuation">}</span></code></pre></div>
<p><strong>Note:</strong> For a detailed explanation of secrets management strategies, check out our previous post on <a href="https://serverless.com/blog/serverless-secrets-api-keys/">managing secrets, API keys and more with Serverless</a>.</p>
<p>Since Redshift is secured by running under a VPC, you’ll need to supply the appropriate security groups, subnets, and IAM roles like so:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml">  <span class="token punctuation">...</span>
  <span class="token key atrule">vpc</span><span class="token punctuation">:</span>
    <span class="token key atrule">securityGroupIds</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sg<span class="token punctuation">-</span>xxxxxxx
    <span class="token key atrule">subnetIds</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> subnet<span class="token punctuation">-</span>xxxxxxx

  <span class="token key atrule">iamRoleStatements</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">Effect</span><span class="token punctuation">:</span> Allow
      <span class="token key atrule">Action</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">"ec2:CreateNetworkInterface"</span>
      <span class="token key atrule">Resource</span><span class="token punctuation">:</span> <span class="token string">"*"</span>
  <span class="token punctuation">...</span></code></pre></div>
<h3>Using a Public API</h3>
<p>To keep it simple, I wanted to use a free, public API without any authentication.</p>
<p>We’ll be using the <a href="https://coinmarketcap.com/api/">CoinMarketCap API</a>. Bitcoin is in peak hype, and I thought it would be interesting to see the metrics over time.</p>
<h3>Fetch data and stash into Redshift</h3>
<p>Now that we have our configuration set, let’s replace the <code class="language-text">handler.py</code> file with the following code:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># handler.py</span>

<span class="token keyword">import</span> datetime
<span class="token keyword">import</span> json
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> os
<span class="token keyword">import</span> pprint
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> date

<span class="token keyword">import</span> requests
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> create_engine<span class="token punctuation">,</span> MetaData<span class="token punctuation">,</span> text<span class="token punctuation">,</span> Table<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> String<span class="token punctuation">,</span> DateTime<span class="token punctuation">,</span> Boolean<span class="token punctuation">,</span> Numeric

SAMPLE_ENDPOINT <span class="token operator">=</span> <span class="token string">"https://api.coinmarketcap.com/v1/ticker"</span>
DB_CONN<span class="token operator">=</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'DB_CONN'</span><span class="token punctuation">)</span>

<span class="token comment">#### Raw API calls</span>
<span class="token keyword">def</span> <span class="token function">get_data</span><span class="token punctuation">(</span>limit<span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token string">'limit'</span><span class="token punctuation">:</span> limit
    <span class="token punctuation">}</span>

    resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>SAMPLE_ENDPOINT<span class="token punctuation">,</span> params<span class="token operator">=</span>payload<span class="token punctuation">)</span>
    resp<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> data

<span class="token keyword">def</span> <span class="token function">cleanup</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"symbol"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"symbol"</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"rank"</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"rank"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"price_usd"</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"price_usd"</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"24h_volume_usd"</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"24h_volume_usd"</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"total_supply"</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"total_supply"</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"percent_change_1h"</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"percent_change_1h"</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"last_updated"</span><span class="token punctuation">:</span> make_datetime<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"last_updated"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

<span class="token comment">#### util methods</span>
<span class="token keyword">def</span> <span class="token function">make_datetime</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>fromtimestamp<span class="token punctuation">(</span>timestamp <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>


<span class="token comment"># SQL Tables</span>
metadata <span class="token operator">=</span> MetaData<span class="token punctuation">(</span><span class="token punctuation">)</span>

sample_table <span class="token operator">=</span> Table<span class="token punctuation">(</span><span class="token string">'sample_coinmarketcap'</span><span class="token punctuation">,</span> metadata<span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'symbol'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'rank'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'price_usd'</span><span class="token punctuation">,</span> Numeric<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'24h_volume_usd'</span><span class="token punctuation">,</span> Numeric<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'total_supply'</span><span class="token punctuation">,</span> Numeric<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'percent_change_1h'</span><span class="token punctuation">,</span> Numeric<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'last_updated'</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">init_tables</span><span class="token punctuation">(</span>engine<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sample_table<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>engine<span class="token punctuation">,</span> checkfirst<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    metadata<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span>engine<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># get sample data</span>
    data <span class="token operator">=</span> get_data<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

    sample_data <span class="token operator">=</span> <span class="token punctuation">[</span>cleanup<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
                    <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">]</span>

    engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span>DB_CONN<span class="token punctuation">)</span>
    init_tables<span class="token punctuation">(</span>engine<span class="token punctuation">)</span>
    conn <span class="token operator">=</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

    conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sample_table<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span>sample_data<span class="token punctuation">)</span><span class="token punctuation">)</span>

    pprint<span class="token punctuation">.</span>pprint<span class="token punctuation">(</span>sample_data<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span></code></pre></div>
<p>Let’s review the code.</p>
<p>We start by importing the required libraries, and specifically we are using the <a href="https://www.sqlalchemy.org/">SqlAlchemy</a> library to work with postgres.</p>
<p>The <code class="language-text">get_data()</code> method accesses the API to fetch the data for bitcoin. The <code class="language-text">cleanup()</code> method is a helper method to filter out only the fields from the API that we need.</p>
<p>In the following code segment, we define the schema for the <code class="language-text">sample_coinmarketcap</code>:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
metadata <span class="token operator">=</span> MetaData<span class="token punctuation">(</span><span class="token punctuation">)</span>

sample_table <span class="token operator">=</span> Table<span class="token punctuation">(</span><span class="token string">'sample_coinmarketcap'</span><span class="token punctuation">,</span> metadata<span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nullable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></div>
<p>In the <code class="language-text">init_tables()</code> method, we first drop the table if it exists, and then create the table, if it does not exist. We are dropping the table each time because we want to store the latest set of data every time we process. If instead you want to append data to the table, do not drop the table.</p>
<p>Finally, the <code class="language-text">main()</code> method brings it all together by fetching data and inserting the data into the database.</p>
<p>You can review the full source code at the <a href="https://github.com/rupakg/serverless-etl">serverless-etl</a> Github repo.</p>
<h2>Test the job service</h2>
<p>Before we deploy the service, let’s test the service to see if our code is functioning properly. Since we’re mainly concerned with testing whether or not our API call gets us the required data correctly, we’ll comment out the database-related code for now.</p>
<p>Comment out the code in the <code class="language-text">main()</code> method as shown below:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># handler.py</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># get sample data</span>
    data <span class="token operator">=</span> get_data<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

    sample_data <span class="token operator">=</span> <span class="token punctuation">[</span>cleanup<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
                    <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">]</span>

    <span class="token comment"># engine = create_engine(DB_CONN)</span>
    <span class="token comment"># init_tables(engine)</span>
    <span class="token comment"># conn = engine.connect()</span>
    <span class="token comment">#</span>
    <span class="token comment"># conn.execute(sample_table.insert().values(sample_data))</span>

    pprint<span class="token punctuation">.</span>pprint<span class="token punctuation">(</span>sample_data<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></div>
<p>To test locally, simply do:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ sls invoke <span class="token builtin class-name">local</span> -f etlSample</code></pre></div>
<p>The output is shown below:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span><span class="token punctuation">{</span>
    '<span class="token number">24</span>h_volume_usd'<span class="token operator">:</span> <span class="token number">8529300000.0</span><span class="token punctuation">,</span>
    'last_updated'<span class="token operator">:</span> datetime.datetime(<span class="token number">1970</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">567000</span>)<span class="token punctuation">,</span>
    'name'<span class="token operator">:</span> 'Bitcoin'<span class="token punctuation">,</span>
    'percent_change_<span class="token number">1</span>h'<span class="token operator">:</span> <span class="token number">2.01</span><span class="token punctuation">,</span>
    'price_usd'<span class="token operator">:</span> <span class="token number">11077.9</span><span class="token punctuation">,</span>
    'rank'<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    'symbol'<span class="token operator">:</span> 'BTC'<span class="token punctuation">,</span>
    'total_supply'<span class="token operator">:</span> <span class="token number">16870925.0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    '<span class="token number">24</span>h_volume_usd'<span class="token operator">:</span> <span class="token number">2510770000.0</span><span class="token punctuation">,</span>
    'last_updated'<span class="token operator">:</span> datetime.datetime(<span class="token number">1970</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">551000</span>)<span class="token punctuation">,</span>
    'name'<span class="token operator">:</span> 'Ethereum'<span class="token punctuation">,</span>
    'percent_change_<span class="token number">1</span>h'<span class="token operator">:</span> <span class="token number">0.7</span><span class="token punctuation">,</span>
    'price_usd'<span class="token operator">:</span> <span class="token number">975.651</span><span class="token punctuation">,</span>
    'rank'<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    'symbol'<span class="token operator">:</span> 'ETH'<span class="token punctuation">,</span>
    'total_supply'<span class="token operator">:</span> <span class="token number">97679773.0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    '<span class="token number">24</span>h_volume_usd'<span class="token operator">:</span> <span class="token number">1172320000.0</span><span class="token punctuation">,</span>
    'last_updated'<span class="token operator">:</span> datetime.datetime(<span class="token number">1970</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">541000</span>)<span class="token punctuation">,</span>
    'name'<span class="token operator">:</span> 'Ripple'<span class="token punctuation">,</span>
    'percent_change_<span class="token number">1</span>h'<span class="token operator">:</span> <span class="token number">0.96</span><span class="token punctuation">,</span>
    'price_usd'<span class="token operator">:</span> <span class="token number">1.21</span><span class="token punctuation">,</span>
    'rank'<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    'symbol'<span class="token operator">:</span> 'XRP'<span class="token punctuation">,</span>
    'total_supply'<span class="token operator">:</span> <span class="token number">99992725510.0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    '<span class="token number">24</span>h_volume_usd'<span class="token operator">:</span> <span class="token number">663760000.0</span><span class="token punctuation">,</span>
    'last_updated'<span class="token operator">:</span> datetime.datetime(<span class="token number">1970</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">553000</span>)<span class="token punctuation">,</span>
    'name'<span class="token operator">:</span> 'Bitcoin Cash'<span class="token punctuation">,</span>
    'percent_change_<span class="token number">1</span>h'<span class="token operator">:</span> <span class="token number">0.78</span><span class="token punctuation">,</span>
    'price_usd'<span class="token operator">:</span> <span class="token number">1547.14</span><span class="token punctuation">,</span>
    'rank'<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    'symbol'<span class="token operator">:</span> 'BCH'<span class="token punctuation">,</span>
    'total_supply'<span class="token operator">:</span> <span class="token number">16973175.0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    '<span class="token number">24</span>h_volume_usd'<span class="token operator">:</span> <span class="token number">865458000.0</span><span class="token punctuation">,</span>
    'last_updated'<span class="token operator">:</span> datetime.datetime(<span class="token number">1970</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">542000</span>)<span class="token punctuation">,</span>
    'name'<span class="token operator">:</span> 'Litecoin'<span class="token punctuation">,</span>
    'percent_change_<span class="token number">1</span>h'<span class="token operator">:</span> <span class="token number">0.19</span><span class="token punctuation">,</span>
    'price_usd'<span class="token operator">:</span> <span class="token number">230.273</span><span class="token punctuation">,</span>
    'rank'<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    'symbol'<span class="token operator">:</span> 'LTC'<span class="token punctuation">,</span>
    'total_supply'<span class="token operator">:</span> <span class="token number">55263408.0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre></div>
<p>Now that all the data we want looks good, we can deploy our service.</p>
<h3>Deploy and schedule the job</h3>
<p>Before we deploy, <strong>remember to uncomment the database code that we commented above</strong>.</p>
<p>Once that’s done, deploy the ETL job service:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ sls deploy

Serverless: WARNING: You provided a docker related option but dockerizePip is <span class="token builtin class-name">set</span> to false.
Serverless: Installing required Python packages with python3.6<span class="token punctuation">..</span>.
Serverless: Linking required Python packages<span class="token punctuation">..</span>.
Serverless: Packaging service<span class="token punctuation">..</span>.
Serverless: Excluding development dependencies<span class="token punctuation">..</span>.
Serverless: Unlinking required Python packages<span class="token punctuation">..</span>.
Serverless: Uploading CloudFormation <span class="token function">file</span> to S3<span class="token punctuation">..</span>.
Serverless: Uploading artifacts<span class="token punctuation">..</span>.
Serverless: Uploading <span class="token function">service</span> .zip <span class="token function">file</span> to S3 <span class="token punctuation">(</span><span class="token number">6.78</span> MB<span class="token punctuation">)</span><span class="token punctuation">..</span>.
Serverless: Validating template<span class="token punctuation">..</span>.
Serverless: Updating Stack<span class="token punctuation">..</span>.
Serverless: Checking Stack update progress<span class="token punctuation">..</span>.
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
Serverless: Stack update finished<span class="token punctuation">..</span>.
Service Information
service: sample-etl
stage: prod
region: us-west-2
stack: sample-etl-prod
api keys:
  None
endpoints:
  None
functions:
  etlSample: sample-etl-prod-etlSample</code></pre></div>
<p>This will set up our ETL job service in AWS to run as per the specified schedule. In our case, the job will run every hour.</p>
<h2>Visualizing the data</h2>
<p>I thought it would be useful to show the fact that you can visualize that data easily via services like <a href="https://chartio.com/">Chart.io</a> or Metabase.io. Without going into too much detail about these services, you can see the visualization below:</p>
<p><img src="https://user-images.githubusercontent.com/8188/36358496-7043c5f0-14dd-11e8-9236-69d9e9f13d33.png" alt="Chart.io graph"></p>
<h2>Summary</h2>
<p>We saw how easy it is to create an ETL job service in Serverless, fetch data via an API, and store it in a database like Redshift. The service can be deployed on AWS and executed based on a schedule.</p>
<p>The cost savings of running this kind of service with serverless is huge. Redshift instances are pretty expensive; with serverless you’ll only pay when the job executes. No need for dedicated infrastructure.</p>
<p>If you have other use cases you’ve implemented or have any questions, please leave a comment below. I’d be happy to discuss it with you.</p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAUBAgME/8QAFwEBAAMAAAAAAAAAAAAAAAAAAgABA//aAAwDAQACEAMQAAABtTuWpVlGVPBk0HAFf//EABsQAAICAwEAAAAAAAAAAAAAAAECAxMAESMk/9oACAEBAAEFAnOlgZ7cvIZnEYuxj6ZjxjOh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQEiH/2gAIAQMBAT8BwqOP/8QAGREAAQUAAAAAAAAAAAAAAAAAAAEQEiEx/9oACAECAQE/AbJCY3//xAAgEAABAgUFAAAAAAAAAAAAAAABABECAxASITFBYYGR/9oACAEBAAY/Ai2qYx3A0tPifYlsLBBT8qX3T//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hRVcZF9KXnJkRaRWsbCd3oQNMD6x1eoRshVw76T//2gAMAwEAAgADAAAAENvoAP/EABkRAAIDAQAAAAAAAAAAAAAAAAABESExUf/aAAgBAwEBPxCEpsj00xYf/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAEQESExUf/aAAgBAgEBPxBNs0X5A9n/xAAeEAEBAQACAQUAAAAAAAAAAAABEQAhMUFRYXGBkf/aAAgBAQABPxClwdnV0whQo4lO/wAzyyrjkGw+cZbkILxecbfXBH7zSeBntAmta2n5uEBbXZ4N/9k=" alt="Kyle Mathews" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" src="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg" alt="Kyle Mathews" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Kyle Mathews</strong> <!-- -->who lives and works in San Francisco building useful things.<!-- --> <a href="https://twitter.com/kylemathews">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/lumen/posts/2018-02-14-running-scalable-reliable-graphql-endpoint-with-serverless/">← <!-- -->Running a scalable &amp; reliable GraphQL endpoint with Serverless</a></li><li><a rel="next" href="/lumen/posts/2018-02-23-serverless-path-building-better-software/">The serverless path to building better software<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/2018-02-20-etl-job-processing-with-serverless-lambda-and-redshift/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-36e457a5393b79b99515.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9578b926700cf49bb4fc.js"],"component---src-pages-index-js":["/component---src-pages-index-js-753a3f9bde0636fce206.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-f16d60f62c7d2b3e9bcc.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"]};/*]]>*/</script><script src="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js" async=""></script><script src="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js" async=""></script><script src="/lumen/commons-4c36ffabef1434ec1126.js" async=""></script><script src="/lumen/app-36e457a5393b79b99515.js" async=""></script><script src="/lumen/styles-cd63080e784be7b7e7cf.js" async=""></script><script src="/lumen/framework-5fc6169171e885c3b522.js" async=""></script><script src="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js" async=""></script></body></html>