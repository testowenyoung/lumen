<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><style data-href="/lumen/styles.1d0daeadf0762b76da98.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/lumen/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/lumen/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/lumen/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/lumen/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/lumen/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/lumen/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/lumen/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/lumen/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/lumen/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/lumen/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/lumen/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/lumen/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/lumen/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/lumen/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/lumen/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/lumen/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/lumen/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/lumen/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/lumen/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/lumen/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/lumen/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/lumen/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/lumen/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/lumen/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/lumen/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/lumen/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/lumen/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/lumen/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/lumen/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/lumen/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/lumen/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/lumen/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/lumen/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/lumen/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/lumen/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/lumen/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/lumen/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/lumen/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/lumen/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.23.12"/><link rel="alternate" type="application/rss+xml" href="/lumen/rss.xml"/><link rel="icon" href="/lumen/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/lumen/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/lumen/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/lumen/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/lumen/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/lumen/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/lumen/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/lumen/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/lumen/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/lumen/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><title data-react-helmet="true">How to create a REST API in Java using DynamoDB and Serverless | Gatsby Starter Blog</title><meta data-react-helmet="true" name="description" content="Build a serverless REST API service in Java, store the data in a DynamoDB table, and deploy it to AWS. All using the Serverless Framework."/><meta data-react-helmet="true" property="og:title" content="How to create a REST API in Java using DynamoDB and Serverless"/><meta data-react-helmet="true" property="og:description" content="Build a serverless REST API service in Java, store the data in a DynamoDB table, and deploy it to AWS. All using the Serverless Framework."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="kylemathews"/><meta data-react-helmet="true" name="twitter:title" content="How to create a REST API in Java using DynamoDB and Serverless"/><meta data-react-helmet="true" name="twitter:description" content="Build a serverless REST API service in Java, store the data in a DynamoDB table, and deploy it to AWS. All using the Serverless Framework."/><link as="script" rel="preload" href="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js"/><link as="script" rel="preload" href="/lumen/framework-5fc6169171e885c3b522.js"/><link as="script" rel="preload" href="/lumen/styles-cd63080e784be7b7e7cf.js"/><link as="script" rel="preload" href="/lumen/app-36e457a5393b79b99515.js"/><link as="script" rel="preload" href="/lumen/commons-4c36ffabef1434ec1126.js"/><link as="script" rel="preload" href="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js"/><link as="script" rel="preload" href="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"/><link as="fetch" rel="preload" href="/lumen/page-data/posts/2018-04-16-how-to-create-a-rest-api-in-java-using-dynamodb-and-serverless/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/lumen/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;color:inherit" href="/lumen/">Gatsby Starter Blog</a></h3></header><main><article><header><h1 style="margin-top:1.75rem;margin-bottom:0">How to create a REST API in Java using DynamoDB and Serverless</h1><p style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem">April 16, 2018</p></header><section><p>In this walkthough, we will build a <code class="language-text">products-api</code> serverless service that will implement a REST API for products. We will be using Java as our language of choice. The data will be stored in a <a href="https://serverless.com/dynamodb/">DynamoDB</a> table, and the service will be deployed to AWS.</p>
<p><img src="https://user-images.githubusercontent.com/8188/38645675-ec708d0e-3db2-11e8-8f8b-a4a37ed612b9.png" alt="image"></p>
<p>What we will cover:</p>
<ul>
<li>Pre-requisites</li>
<li>Creating the REST API service</li>
<li>Deep dive into the Java code</li>
<li>Deploying the service</li>
<li>Calling the API</li>
</ul>
<h2>Install Pre-requisites</h2>
<p>Before we begin, you’ll need the following:</p>
<ul>
<li>Install <code class="language-text">node</code> and <code class="language-text">npm</code></li>
<li>Install the <a href="https://serverless.com/framework/docs/providers/aws/guide/quick-start/">Serverless Framework installed</a> with an AWS account set up.</li>
<li>Install <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle JDK</a> and NOT Java JRE. Set the following:
<code class="language-text">export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk-10.jdk/Contents/Home</code></li>
<li>Install <a href="https://maven.apache.org/">Apache Maven</a>. After <a href="https://maven.apache.org/download.html">downloading</a> and <a href="https://maven.apache.org/install.html">installing</a> Apache Maven, add the <code class="language-text">apache-maven-x.x.x</code> folder to the <code class="language-text">PATH</code> environment variable.</li>
</ul>
<h3>Testing Pre-requisites</h3>
<p>Test Java installation:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ java --version

java <span class="token number">10</span> <span class="token number">2018</span>-03-20
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token number">18.3</span> <span class="token punctuation">(</span>build <span class="token number">10</span>+46<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token number">18.3</span> <span class="token punctuation">(</span>build <span class="token number">10</span>+46, mixed mode<span class="token punctuation">)</span></code></pre></div>
<p>Test Maven installation:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ mvn -v

Apache Maven <span class="token number">3.5</span>.3 <span class="token punctuation">(</span>3383c37e1f9e9b3bc3df5050c29c8aff9f295297<span class="token punctuation">;</span> <span class="token number">2018</span>-02-24T14:49:05-05:00<span class="token punctuation">)</span>
Maven home: /usr/local/apache-maven-3.5.3
Java version: <span class="token number">10</span>, vendor: Oracle Corporation
Java home: /Library/Java/JavaVirtualMachines/jdk-10.jdk/Contents/Home
Default locale: en_US, platform encoding: UTF-8
OS name: <span class="token string">"mac os x"</span>, version: <span class="token string">"10.13.3"</span>, arch: <span class="token string">"x86_64"</span>, family: <span class="token string">"mac"</span></code></pre></div>
<h2>Create the Serverless project</h2>
<p>Let’s create a project named <code class="language-text">products-api</code>, using the <code class="language-text">aws-java-maven</code> boilerplate template provided by the <a href="https://serverless.com/framework/">Serverless Framework</a>, as shown below:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ serverless create --template aws-java-maven --name products-api -p aws-java-products-api

Serverless: Generating boilerplate<span class="token punctuation">..</span>.
Serverless: Generating boilerplate <span class="token keyword">in</span> <span class="token string">"/Users/rupakg/projects/svrless/apps/aws-java-products-api"</span>
 _______                             __
<span class="token operator">|</span>   _   .-----.----.--.--.-----.----<span class="token operator">|</span>  .-----.-----.-----.
<span class="token operator">|</span>   <span class="token operator">|</span>___<span class="token operator">|</span>  -__<span class="token operator">|</span>   _<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  -__<span class="token operator">|</span>   _<span class="token operator">|</span>  <span class="token operator">|</span>  -__<span class="token operator">|</span>__ --<span class="token operator">|</span>__ --<span class="token operator">|</span>
<span class="token operator">|</span>____   <span class="token operator">|</span>_____<span class="token operator">|</span>__<span class="token operator">|</span>  <span class="token punctuation">\</span>___/<span class="token operator">|</span>_____<span class="token operator">|</span>__<span class="token operator">|</span> <span class="token operator">|</span>__<span class="token operator">|</span>_____<span class="token operator">|</span>_____<span class="token operator">|</span>_____<span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token operator">|</span>   <span class="token operator">|</span>             The Serverless Application Framework
<span class="token operator">|</span>       <span class="token operator">|</span>                           serverless.com, v1.26.1
 -------'

Serverless: Successfully generated boilerplate <span class="token keyword">for</span> template: <span class="token string">"aws-java-maven"</span></code></pre></div>
<h3>Updating the project</h3>
<p>The serverless boilerplate template <code class="language-text">aws-java-maven</code> gives us a nice starting point and builds a fully functional service using Java and Maven. However, we’ll need to adapt it to our Products API service that we are building.</p>
<p>Let’s update the project <code class="language-text">hello</code> to <code class="language-text">products-api</code> in the POM i.e. <code class="language-text">pom.xml</code>:</p>
<div class="gatsby-highlight" data-language="xml"><pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.serverless<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>products-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">></span></span>jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>dev<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>products-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span></code></pre></div>
<h3>The <code class="language-text">serverless.yml</code></h3>
<p>Let’s add the relevant Lambda handlers under <code class="language-text">functions</code> and update the deployment artifact under <code class="language-text">package</code>, as per our project requirements.</p>
<p>Update the following sections:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">package</span><span class="token punctuation">:</span>
  <span class="token key atrule">artifact</span><span class="token punctuation">:</span> <span class="token string">'target/${self:service}-${self:provider.stage}.jar'</span>

<span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">listProducts</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> com.serverless.ListProductsHandler

  <span class="token key atrule">getProduct</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> com.serverless.GetProductHandler

  <span class="token key atrule">createProduct</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> com.serverless.CreateProductHandler

  <span class="token key atrule">deleteProduct</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> com.serverless.DeleteProductHandler</code></pre></div>
<h2>Managing the DynamoDB table</h2>
<p>Since we will be using a DynamoDB table to store our products data, we will let the Serverless Framework manage the DynamoDB resource and the relevant IAM Role permissions for the lambda functions to access the DynamoDB table.</p>
<p>Add the following section for <code class="language-text">iamRoleStatements</code> under the <code class="language-text">provider</code> section in the <code class="language-text">serverless.yml</code> file:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">iamRoleStatements</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">Effect</span><span class="token punctuation">:</span> <span class="token string">"Allow"</span>
     <span class="token key atrule">Action</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token string">"dynamodb:*"</span>
     <span class="token key atrule">Resource</span><span class="token punctuation">:</span> <span class="token string">"*"</span></code></pre></div>
<p>Now, to create and manage the DynamoDB table from within our serverless project, we can add a <code class="language-text">resources</code> section to our <code class="language-text">serverless.yml</code> file. This section describes the DynamoDB resource via a CloudFormation syntax:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token key atrule">Resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">productsTable</span><span class="token punctuation">:</span>
      <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>DynamoDB<span class="token punctuation">:</span><span class="token punctuation">:</span>Table
      <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
        <span class="token key atrule">TableName</span><span class="token punctuation">:</span> products_table
        <span class="token key atrule">AttributeDefinitions</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> id
            <span class="token key atrule">AttributeType</span><span class="token punctuation">:</span> S
          <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> name
            <span class="token key atrule">AttributeType</span><span class="token punctuation">:</span> S
        <span class="token key atrule">KeySchema</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> id
            <span class="token key atrule">KeyType</span><span class="token punctuation">:</span> HASH
          <span class="token punctuation">-</span> <span class="token key atrule">AttributeName</span><span class="token punctuation">:</span> name
            <span class="token key atrule">KeyType</span><span class="token punctuation">:</span> RANGE
        <span class="token key atrule">ProvisionedThroughput</span><span class="token punctuation">:</span>
          <span class="token key atrule">ReadCapacityUnits</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token key atrule">WriteCapacityUnits</span><span class="token punctuation">:</span> <span class="token number">1</span></code></pre></div>
<h2>The DynamoDB Adapter</h2>
<p>We will create an adapter whose responsibility will be to manage the connection to the specifed DynamoDB table using configuration, like the AWS region where the table will be deployed. The DynamoDB adapter class is a singleton that instantiates a AmazonDynamoDB client and a <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBMapper.Methods.html">AWS DBMapper</a> class.</p>
<p>Here’s an excerpt from the DynamoDBAdapter class:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>dal</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamoDBAdapter</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">private</span> <span class="token class-name">DynamoDBAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">=</span> <span class="token class-name">AmazonDynamoDBClientBuilder</span><span class="token punctuation">.</span><span class="token function">standard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withRegion</span><span class="token punctuation">(</span><span class="token class-name">Regions</span><span class="token punctuation">.</span>US_EAST_1<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DynamoDBAdapter</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>db_adapter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
          db_adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamoDBAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> db_adapter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">public</span> <span class="token class-name">DynamoDBMapper</span> <span class="token function">createDbMapper</span><span class="token punctuation">(</span><span class="token class-name">DynamoDBMapperConfig</span> mapperConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamoDBMapper</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>client<span class="token punctuation">,</span> mapperConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapper<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h2>The Product POJO</h2>
<p>We have the Product <a href="https://en.wikipedia.org/wiki/Plain_old_Java_object">POJO</a> that represents the Product entity and encapsulates all its functionality in a class. The Product POJO class defines a data structure that matches the DynamoDB table schema and provides helper methods for easy management of product data.</p>
<blockquote>
<p>The AWS SDK provides an easy way to annotate a POJO with DynamoDB specific attributes as defined by <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBMapper.Annotations.html">Java Annotations for DynamoDB</a></p>
</blockquote>
<p>We annotate the Product POJO class with:</p>
<ul>
<li>a <code class="language-text">DynamoDBTable</code> attribute to specify the DynamoDB table name</li>
<li>a <code class="language-text">DynamoDBHashKey</code> attribute to map a property to a DynamoDB Haskey</li>
<li>a <code class="language-text">DynamoDBRangeKey</code> attribute to map a property to a DynamoDB RangeKey</li>
<li>a <code class="language-text">DynamoDBAutoGeneratedKey</code> attribute to map a property that needs to get a auto-generated id</li>
</ul>
<p>Also, note that we get the product table name from a environment variable <code class="language-text">PRODUCTS_TABLE_NAME</code> defined in our <code class="language-text">serverless.yml</code> file:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>dal</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token annotation punctuation">@DynamoDBTable</span><span class="token punctuation">(</span>tableName <span class="token operator">=</span> <span class="token string">"PLACEHOLDER_PRODUCTS_TABLE_NAME"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> PRODUCTS_TABLE_NAME <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"PRODUCTS_TABLE_NAME"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Float</span> price<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@DynamoDBHashKey</span><span class="token punctuation">(</span>attributeName <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@DynamoDBAutoGeneratedKey</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DynamoDBRangeKey</span><span class="token punctuation">(</span>attributeName <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DynamoDBAttribute</span><span class="token punctuation">(</span>attributeName <span class="token operator">=</span> <span class="token string">"price"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Float</span> <span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>price<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token class-name">Float</span> price<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Next, let’s look at the methods that the Product POJO utilizes for data management.</p>
<h3>The constructor method</h3>
<p>The public constructor does a couple of things:</p>
<ul>
<li>Overrides the <code class="language-text">PLACEHOLDER_PRODUCTS_TABLE_NAME</code> table name annotation value with the actual value from the environment variable</li>
<li>Gets an instance of DynamoDBAdapter</li>
<li>Gets an instance of AmazonDynamoDB client</li>
<li>Gets an instance of DynamoDBMapper</li>
</ul>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">DynamoDBMapperConfig</span> mapperConfig <span class="token operator">=</span> <span class="token class-name">DynamoDBMapperConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withTableNameOverride</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DynamoDBMapperConfig</span><span class="token punctuation">.</span><span class="token class-name">TableNameOverride</span><span class="token punctuation">(</span>PRODUCTS_TABLE_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>db_adapter <span class="token operator">=</span> <span class="token class-name">DynamoDBAdapter</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>db_adapter<span class="token punctuation">.</span><span class="token function">getDbClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mapper <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>db_adapter<span class="token punctuation">.</span><span class="token function">createDbMapper</span><span class="token punctuation">(</span>mapperConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>The list() method</h3>
<p>The <code class="language-text">list()</code> method uses a <code class="language-text">DynamoDBScanExpression</code> construct to retrieve all the products from the products table. It returns a list of  products via the <code class="language-text">List&lt;Product&gt;</code> data structure. It also logs the list of products retrieved.</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
  <span class="token class-name">DynamoDBScanExpression</span> scanExp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamoDBScanExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> results <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapper<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> scanExp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Product</span> p <span class="token operator">:</span> results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Products - list(): "</span> <span class="token operator">+</span> p<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> results<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>The get() method</h3>
<p>The <code class="language-text">get()</code> method takes a product <code class="language-text">id</code> and uses a <code class="language-text">DynamoDBQueryExpression</code> to set up a query expression to match the passed in product <code class="language-text">id</code>. The <code class="language-text">mapper</code> object has a <code class="language-text">query</code> method that is passed the <code class="language-text">queryExp</code>, to retrieve the matching product:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">AttributeValue</span><span class="token punctuation">></span></span> av <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">AttributeValue</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    av<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">":v1"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AttributeValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withS</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">DynamoDBQueryExpression</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> queryExp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamoDBQueryExpression</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withKeyConditionExpression</span><span class="token punctuation">(</span><span class="token string">"id = :v1"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withExpressionAttributeValues</span><span class="token punctuation">(</span>av<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">PaginatedQueryList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapper<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Product</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> queryExp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      product <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Products - get(): product - "</span> <span class="token operator">+</span> product<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Products - get(): product - Not Found."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> product<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>The save() method</h3>
<p>The <code class="language-text">save()</code> method takes a <code class="language-text">product</code> instance populated with values, and passes it to the <code class="language-text">mapper</code> object’s <code class="language-text">save</code> method, to save the product to the underlying table:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Product</span> product<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Products - save(): "</span> <span class="token operator">+</span> product<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mapper<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>The delete() method</h3>
<p>The <code class="language-text">delete()</code> method takes a product <code class="language-text">id</code> and then calls the <code class="language-text">get()</code> method to first validate if a product with a matching <code class="language-text">id</code> exists. If it exists, it calls the <code class="language-text">mapper</code> object’s <code class="language-text">delete</code> method, to delete the product from the underlying table:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">// get product if exists</span>
    product <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>product <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Products - delete(): "</span> <span class="token operator">+</span> product<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>mapper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Products - delete(): product - does not exist."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Note</strong>: The Product POJO class can be independently tested to make sure the data management functionality works against a DynamoDB table. This seperation allows us to write unit tests to test the core DAL functionality.</p>
<h2>Implementing the API</h2>
<p>Now, that our Product DAL is written up and works as expected, we can start looking at the API function handlers that will be calling the Product DAL to provide the expected functionality.</p>
<p>We will define the API endpoints, then map the events to the handlers and finally write the handler code.</p>
<h3>The API Endpoints</h3>
<p>Before we look at the API handlers, let’s take a look at the API endpoints that we will map to the handlers.</p>
<p>The API endpoints will look like:</p>
<p><code class="language-text">POST /products</code>: Create a product and save it to the DynamoDB table.</p>
<p><code class="language-text">GET /products/</code>: Retrieves all existing products.</p>
<p><code class="language-text">GET /products/{id}</code>: Retrieves an existing product by <code class="language-text">id</code>.</p>
<p><code class="language-text">DELETE /products/{id}</code>: Deletes an existing product by <code class="language-text">id</code>.</p>
<h3>Mapping Events to Handlers</h3>
<p>To implement the API endpoints we described above, we need to add  events that map our API endpoints to the corresponsing Lambda function handlers.</p>
<p>Update the following sections in the <code class="language-text">serverless.yml</code>:</p>
<div class="gatsby-highlight" data-language="yml"><pre class="language-yml"><code class="language-yml"><span class="token key atrule">functions</span><span class="token punctuation">:</span>
  <span class="token key atrule">listProducts</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> com.serverless.ListProductsHandler
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /products
          <span class="token key atrule">method</span><span class="token punctuation">:</span> get
  <span class="token key atrule">getProduct</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> com.serverless.GetProductHandler
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /products/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
          <span class="token key atrule">method</span><span class="token punctuation">:</span> get
  <span class="token key atrule">createProduct</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> com.serverless.CreateProductHandler
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /products
          <span class="token key atrule">method</span><span class="token punctuation">:</span> post
  <span class="token key atrule">deleteProduct</span><span class="token punctuation">:</span>
    <span class="token key atrule">handler</span><span class="token punctuation">:</span> com.serverless.DeleteProductHandler
    <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /products/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
          <span class="token key atrule">method</span><span class="token punctuation">:</span> delete</code></pre></div>
<p>The <code class="language-text">listProducts</code> Lambda function maps to the <code class="language-text">ListProductsHandler</code> handler and maps to the <code class="language-text">http</code> event accessible at path <code class="language-text">/products</code>. We define the other mappings in a similar fashion.</p>
<h2>Writing the Handlers</h2>
<p>Let’s write the code for the four handlers that will provide us the needed functionality to implement the Products REST API. Let’s copy the <code class="language-text">Handler.java</code> file that was generated by the boilerplate and create four new files under the <code class="language-text">src/main/java/com/serverless</code> folder. We can now delete the <code class="language-text">Handler.java</code> file.</p>
<ul>
<li><code class="language-text">CreateProductHandler.java</code></li>
<li><code class="language-text">ListProductHandler.java</code></li>
<li><code class="language-text">GetProductHandler.java</code></li>
<li><code class="language-text">DeleteProductHandler.java</code></li>
</ul>
<p>The basic code for all the handlers are the same. Each handler is defined as a class that implements <code class="language-text">RequestHandler</code> from the AWS Lambda runtime. Then the <code class="language-text">handleRequest</code> method is overriden in the class to provide the custom logic for the handler. The <code class="language-text">handleRequest</code> method receives a <code class="language-text">Map</code> object with the inputs from the caller and a <code class="language-text">Context</code> object with information about the caller’s environment.</p>
<h3>Create Product Handler</h3>
<p>The <code class="language-text">CreateProductHandler</code> method reads the JSON data received via the <code class="language-text">body</code> attribute from the <code class="language-text">input</code> object passed in. This data is used to instantiate a new Product instance, and the <code class="language-text">save()</code> method is called to save the product to the underlying DynamoDB table.</p>
<p>If the call is successful, a <code class="language-text">200 OK</code> response is returned back. In case of an error or exception, the exception is caught and a <code class="language-text">500 Internal Server Error</code> response is returned back:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>dal</span><span class="token punctuation">.</span><span class="token class-name">Product</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CreateProductHandler</span> <span class="token keyword">implements</span> <span class="token class-name">RequestHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">ApiGatewayResponse</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> input<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// get the 'body' from input</span>
          <span class="token class-name">JsonNode</span> body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readTree</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> input<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// create the Product object for post</span>
          <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// product.setId(body.get("id").asText());</span>
          product<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          product<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> body<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"price"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          product<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// send the response back</span>
      		<span class="token keyword">return</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setObjectBody</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">"X-Powered-By"</span><span class="token punctuation">,</span> <span class="token string">"AWS Lambda &amp; Serverless"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Error in saving product: "</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// send the error response back</span>
    			<span class="token class-name">Response</span> responseBody <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Response</span><span class="token punctuation">(</span><span class="token string">"Error in saving product: "</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    			<span class="token keyword">return</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    					<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
    					<span class="token punctuation">.</span><span class="token function">setObjectBody</span><span class="token punctuation">(</span>responseBody<span class="token punctuation">)</span>
    					<span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">"X-Powered-By"</span><span class="token punctuation">,</span> <span class="token string">"AWS Lambda &amp; Serverless"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    					<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>List Product Handler</h3>
<p>The <code class="language-text">ListProductHandler</code> calls the <code class="language-text">list()</code> method on the product instance to get back a list of products.</p>
<p>If the call is successful, a <code class="language-text">200 OK</code> response is returned back. In case of an error or exception, the exception is caught and a <code class="language-text">500 Internal Server Error</code> response is returned back:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>dal</span><span class="token punctuation">.</span><span class="token class-name">Product</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListProductsHandler</span> <span class="token keyword">implements</span> <span class="token class-name">RequestHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">ApiGatewayResponse</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> input<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// get all products</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> products <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// send the response back</span>
        <span class="token keyword">return</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    				<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    				<span class="token punctuation">.</span><span class="token function">setObjectBody</span><span class="token punctuation">(</span>products<span class="token punctuation">)</span>
    				<span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">"X-Powered-By"</span><span class="token punctuation">,</span> <span class="token string">"AWS Lambda &amp; Serverless"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    				<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Error in listing products: "</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// send the error response back</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>Get Product Handler</h3>
<p>The <code class="language-text">GetProductHandler</code> receives the <code class="language-text">id</code> via the path parameters attribute of the input. Then it calls the <code class="language-text">get()</code> method on the product instance passes it the <code class="language-text">id</code> to get back a matching product.</p>
<p>If the call is successful, a <code class="language-text">200 OK</code> response is returned back. If no products with the matching <code class="language-text">id</code> are found, a <code class="language-text">404 Not Found</code> response is returned back. In case of an error or exception, the exception is caught and a <code class="language-text">500 Internal Server Error</code> response is returned back:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>dal</span><span class="token punctuation">.</span><span class="token class-name">Product</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GetProductHandler</span> <span class="token keyword">implements</span> <span class="token class-name">RequestHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">ApiGatewayResponse</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> input<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// get the 'pathParameters' from input</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> pathParameters <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>input<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"pathParameters"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> productId <span class="token operator">=</span> pathParameters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// get the Product by id</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>productId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// send the response back</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>product <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setObjectBody</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">"X-Powered-By"</span><span class="token punctuation">,</span> <span class="token string">"AWS Lambda &amp; Serverless"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setObjectBody</span><span class="token punctuation">(</span><span class="token string">"Product with id: '"</span> <span class="token operator">+</span> productId <span class="token operator">+</span> <span class="token string">"' not found."</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">"X-Powered-By"</span><span class="token punctuation">,</span> <span class="token string">"AWS Lambda &amp; Serverless"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Error in retrieving product: "</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// send the error response back</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>Delete Product Handler</h3>
<p>The <code class="language-text">DeleteProductHandler</code> receives the <code class="language-text">id</code> via the path parameters attribute of the input. Then it calls the <code class="language-text">delete()</code> method on the product instance passing it the <code class="language-text">id</code> to delete the product.</p>
<p>If the call is successful, a <code class="language-text">204 No Content</code> response is returned back. If no products with the matching <code class="language-text">id</code> are found, a <code class="language-text">404 Not Found</code> response is returned back. In case of an error or exception, the exception is caught and a <code class="language-text">500 Internal Server Error</code> response is returned back:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>serverless<span class="token punctuation">.</span>dal</span><span class="token punctuation">.</span><span class="token class-name">Product</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeleteProductHandler</span> <span class="token keyword">implements</span> <span class="token class-name">RequestHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span><span class="token punctuation">,</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">ApiGatewayResponse</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> input<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// get the 'pathParameters' from input</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> pathParameters <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>input<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"pathParameters"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> productId <span class="token operator">=</span> pathParameters<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// get the Product by id</span>
        <span class="token class-name">Boolean</span> success <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>productId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// send the response back</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">"X-Powered-By"</span><span class="token punctuation">,</span> <span class="token string">"AWS Lambda &amp; Serverless"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token class-name">ApiGatewayResponse</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setStatusCode</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setObjectBody</span><span class="token punctuation">(</span><span class="token string">"Product with id: '"</span> <span class="token operator">+</span> productId <span class="token operator">+</span> <span class="token string">"' not found."</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">setHeaders</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">"X-Powered-By"</span><span class="token punctuation">,</span> <span class="token string">"AWS Lambda &amp; Serverless"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      				<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Error in deleting product: "</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// send the error response back</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>Note:</strong> The full <a href="https://github.com/rupakg/aws-java-products-api">source code</a> for the project is available on Github.</p>
<h2>Deploying the service</h2>
<p>Now that we’ve looked at the code and understand the overall workings of the service, let’s build the Java code, and deploy the service to the cloud.</p>
<p>To build the Java code:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ mvn clean <span class="token function">install</span>

<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Scanning <span class="token keyword">for</span> projects<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> --------------------<span class="token operator">&lt;</span> com.serverless:products-api <span class="token operator">></span>---------------------
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Building products-api dev
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> --------------------------------<span class="token punctuation">[</span> jar <span class="token punctuation">]</span>---------------------------------
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> --- maven-clean-plugin:2.5:clean <span class="token punctuation">(</span>default-clean<span class="token punctuation">)</span> @ products-api ---
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Deleting /Users/rupakg/projects/svrless/apps/aws-java-products-api/target

<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.

<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> --- maven-install-plugin:2.4:install <span class="token punctuation">(</span>default-install<span class="token punctuation">)</span> @ products-api ---
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Installing /Users/rupakg/projects/svrless/apps/aws-java-products-api/target/products-api-dev.jar to /Users/rupakg/.m2/repository/com/serverless/products-api/dev/products-api-dev.jar
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Installing /Users/rupakg/projects/svrless/apps/aws-java-products-api/pom.xml to /Users/rupakg/.m2/repository/com/serverless/products-api/dev/products-api-dev.pom
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> ------------------------------------------------------------------------
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> BUILD SUCCESS
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> ------------------------------------------------------------------------
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Total time: <span class="token number">2.790</span> s
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Finished at: <span class="token number">2018</span>-04-08T19:58:15-04:00
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> ------------------------------------------------------------------------</code></pre></div>
<p>After a successful build, we should have an artifact at <code class="language-text">aws-java-products-api/target/products-api-dev.jar</code> that we will use in our deployment step.</p>
<p>Let’s deploy the service to the cloud:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ sls deploy

Serverless: Packaging service<span class="token punctuation">..</span>.
Serverless: Creating Stack<span class="token punctuation">..</span>.
Serverless: Checking Stack create progress<span class="token punctuation">..</span>.
<span class="token punctuation">..</span><span class="token punctuation">..</span>.
Serverless: Stack create finished<span class="token punctuation">..</span>.
Serverless: Uploading CloudFormation <span class="token function">file</span> to S3<span class="token punctuation">..</span>.
Serverless: Uploading artifacts<span class="token punctuation">..</span>.
Serverless: Validating template<span class="token punctuation">..</span>.
Serverless: Updating Stack<span class="token punctuation">..</span>.
Serverless: Checking Stack update progress<span class="token punctuation">..</span>.
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Serverless: Stack update finished<span class="token punctuation">..</span>.
Service Information
service: products-api
stage: dev
region: us-east-1
stack: products-api-dev
api keys:
  None
endpoints:
  GET - https://xxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products
  GET - https://xxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
  POST - https://xxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products
  DELETE - https://xxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
functions:
  listProducts: products-api-dev-listProducts
  getProduct: products-api-dev-getProduct
  createProduct: products-api-dev-createProduct
  deleteProduct: products-api-dev-deleteProduct</code></pre></div>
<p>On a successful deployment, we will have our four API endpoints listed as shown above.</p>
<h2>Calling the API</h2>
<p>Now that we have a fully functional REST API deployed to the cloud, let’s call the API endpoints.</p>
<h3>Create Product</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> -X POST https://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products -d <span class="token string">'{"name": "Product1", "price": 9.99}'</span>

<span class="token punctuation">{</span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"ba04f16b-f346-4b54-9884-957c3dff8c0d"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"Product1"</span>,<span class="token string">"price"</span>:9.99<span class="token punctuation">}</span></code></pre></div>
<p>Now, we’ll make a few calls to add some products.</p>
<h3>List Products</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> https://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products

<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"dfe41235-0fe5-4e6f-9a9a-19b7b7ee79eb"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"Product3"</span>,<span class="token string">"price"</span>:7.49<span class="token punctuation">}</span>,
<span class="token punctuation">{</span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"ba04f16b-f346-4b54-9884-957c3dff8c0d"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"Product1"</span>,<span class="token string">"price"</span>:9.99<span class="token punctuation">}</span>,
<span class="token punctuation">{</span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"6db3efe0-f45c-4c5f-a73c-541a4857ae1d"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"Product4"</span>,<span class="token string">"price"</span>:2.69<span class="token punctuation">}</span>,
<span class="token punctuation">{</span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"370015f8-a8b9-4498-bfe8-f005dbbb501f"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"Product2"</span>,<span class="token string">"price"</span>:5.99<span class="token punctuation">}</span>,
<span class="token punctuation">{</span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"cb097196-d659-4ba5-b6b3-ead4c07a8428"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"Product5"</span>,<span class="token string">"price"</span>:15.49<span class="token punctuation">}</span><span class="token punctuation">]</span></code></pre></div>
<p>Here’s the <code class="language-text">java-products-dev</code> DynamoDB table listing our products:</p>
<p><img src="https://user-images.githubusercontent.com/8188/38694756-7231c25a-3e58-11e8-8f7c-d7551aaa86c9.png" alt="image"></p>
<p><strong>No Product(s) Found:</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> https://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products

<span class="token punctuation">[</span><span class="token punctuation">]</span></code></pre></div>
<h3>Get Product</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> https://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products/ba04f16b-f346-4b54-9884-957c3dff8c0d

<span class="token punctuation">{</span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"ba04f16b-f346-4b54-9884-957c3dff8c0d"</span>,<span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"Product1"</span>,<span class="token string">"price"</span>:9.99<span class="token punctuation">}</span></code></pre></div>
<p><strong>Product Not Found:</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> https://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products/xxxx

<span class="token string">"Product with id: 'xxxx' not found."</span></code></pre></div>
<h3>Delete Product</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> -X DELETE https://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products/24ada348-07e8-4414-8a8f-7903a6cb0253</code></pre></div>
<p><strong>Product Not Found:</strong></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> -X DELETE https://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products/xxxx

<span class="token string">"Product with id: 'xxxx' not found."</span></code></pre></div>
<h3>View the CloudWatch Logs</h3>
<p>We have used the <code class="language-text">log4j.Logger</code> in our Java code to log relevant info and errors to the logs. In case of AWS, the logs can be retrieved from CloudWatch.</p>
<p>Let’s do a GET call and then take a look at the logs from our terminal:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">// call get product API
$ <span class="token function">curl</span> https://xxxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/products/6f1dfeb9-ea08-4161-8877-f6cc724b39e3</code></pre></div>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">// check logs
$ serverless logs --function getProduct

START RequestId: 34f45684-3dd0-11e8-bf8a-7f961671b2de Version: <span class="token variable">$LATEST</span>
<span class="token punctuation">..</span>.

<span class="token number">2018</span>-04-11 <span class="token number">21</span>:35:14 <span class="token operator">&lt;</span>34f45684-3dd0-11e8-bf8a-7f961671b2de<span class="token operator">></span> DEBUG org.apache.http.wire:86 - http-outgoing-0 <span class="token operator">>></span> <span class="token string">"{"</span>TableName<span class="token string">":"</span>java-products-dev<span class="token string">","</span>ConsistentRead<span class="token string">":true,"</span>ScanIndexForward<span class="token string">":true,"</span>KeyConditionExpression<span class="token string">":"</span><span class="token function">id</span> <span class="token operator">=</span> :v1<span class="token string">","</span>ExpressionAttributeValues<span class="token string">":{"</span>:v1<span class="token string">":{"</span>S<span class="token string">":"</span>6f1dfeb9-ea08-4161-8877-f6cc724b39e3<span class="token string">"}}}"</span>

<span class="token punctuation">..</span>.

<span class="token number">2018</span>-04-11 <span class="token number">21</span>:35:14 <span class="token operator">&lt;</span>34f45684-3dd0-11e8-bf8a-7f961671b2de<span class="token operator">></span> DEBUG org.apache.http.wire:86 - http-outgoing-0 <span class="token operator">&lt;&lt;</span> <span class="token string">"{"</span>Count<span class="token string">":1,"</span>Items<span class="token string">":[{"</span>price<span class="token string">":{"</span>N<span class="token string">":"</span><span class="token number">9.99</span><span class="token string">"},"</span><span class="token function">id</span><span class="token string">":{"</span>S<span class="token string">":"</span>6f1dfeb9-ea08-4161-8877-f6cc724b39e3<span class="token string">"},"</span>name<span class="token string">":{"</span>S<span class="token string">":"</span>Product1<span class="token string">"}}],"</span>ScannedCount<span class="token string">":1}"</span>

<span class="token punctuation">..</span>.

<span class="token number">2018</span>-04-11 <span class="token number">21</span>:35:14 <span class="token operator">&lt;</span>34f45684-3dd0-11e8-bf8a-7f961671b2de<span class="token operator">></span> DEBUG org.apache.http.impl.conn.PoolingHttpClientConnectionManager:314 - Connection <span class="token punctuation">[</span>id: <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>route: <span class="token punctuation">{</span>s<span class="token punctuation">}</span>-<span class="token operator">></span>https://dynamodb.us-east-1.amazonaws.com:443<span class="token punctuation">]</span> can be kept alive <span class="token keyword">for</span> <span class="token number">60.0</span> seconds
<span class="token number">2018</span>-04-11 <span class="token number">21</span>:35:14 <span class="token operator">&lt;</span>34f45684-3dd0-11e8-bf8a-7f961671b2de<span class="token operator">></span> DEBUG org.apache.http.impl.conn.PoolingHttpClientConnectionManager:320 - Connection released: <span class="token punctuation">[</span>id: <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>route: <span class="token punctuation">{</span>s<span class="token punctuation">}</span>-<span class="token operator">></span>https://dynamodb.us-east-1.amazonaws.com:443<span class="token punctuation">]</span><span class="token punctuation">[</span>total kept alive: <span class="token number">1</span><span class="token punctuation">;</span> route allocated: <span class="token number">1</span> of <span class="token number">50</span><span class="token punctuation">;</span> total allocated: <span class="token number">1</span> of <span class="token number">50</span><span class="token punctuation">]</span>
<span class="token number">2018</span>-04-11 <span class="token number">21</span>:35:14 <span class="token operator">&lt;</span>34f45684-3dd0-11e8-bf8a-7f961671b2de<span class="token operator">></span> DEBUG com.amazonaws.request:87 - Received successful response: <span class="token number">200</span>, AWS Request ID: MT1EV3AV07T9OD0MJH9VBJSIB7VV4KQNSO5AEMVJF66Q9ASUAAJG
<span class="token number">2018</span>-04-11 <span class="token number">21</span>:35:14 <span class="token operator">&lt;</span>34f45684-3dd0-11e8-bf8a-7f961671b2de<span class="token operator">></span> DEBUG com.amazonaws.requestId:136 - x-amzn-RequestId: MT1EV3AV07T9OD0MJH9VBJSIB7VV4KQNSO5AEMVJF66Q9ASUAAJG
<span class="token number">2018</span>-04-11 <span class="token number">21</span>:35:14 <span class="token operator">&lt;</span>34f45684-3dd0-11e8-bf8a-7f961671b2de<span class="token operator">></span> INFO  com.serverless.dal.Product:107 - Products - get<span class="token punctuation">(</span><span class="token punctuation">)</span>: product - Product <span class="token punctuation">[</span>id<span class="token operator">=</span>6f1dfeb9-ea08-4161-8877-f6cc724b39e3, <span class="token assign-left variable">name</span><span class="token operator">=</span>Product1, <span class="token assign-left variable">price</span><span class="token operator">=</span><span class="token variable">$9</span>.990000<span class="token punctuation">]</span>
END RequestId: 34f45684-3dd0-11e8-bf8a-7f961671b2de
REPORT RequestId: 34f45684-3dd0-11e8-bf8a-7f961671b2de	Duration: <span class="token number">5147.00</span> ms	Billed Duration: <span class="token number">5200</span> ms 	Memory Size: <span class="token number">1024</span> MB	Max Memory Used: <span class="token number">97</span> MB</code></pre></div>
<p>Notice the lines about the database connection being open/closed, the request data structure going to DynamoDB and then the response coming back, and finally the response data structure that is being returned by our API code.</p>
<h2>Removing the service</h2>
<p>At any point in time, if you want to remove the service from the cloud you can do the following:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ sls remove

Serverless: Getting all objects <span class="token keyword">in</span> S3 bucket<span class="token punctuation">..</span>.
Serverless: Removing objects <span class="token keyword">in</span> S3 bucket<span class="token punctuation">..</span>.
Serverless: Removing Stack<span class="token punctuation">..</span>.
Serverless: Checking Stack removal progress<span class="token punctuation">..</span>.
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
Serverless: Stack removal finished<span class="token punctuation">..</span>.</code></pre></div>
<p>It will cleanup all the resources including IAM roles, the deployment bucket, the Lambda functions and will also delete the DynamoDB table.</p>
<h2>Summary</h2>
<p>To recap, we used Java to create a serverless REST API service, built it and then deployed it to AWS. We took a deep dive into the DAL code that handles the backend data mapping and access to the DynamoDB table. We also looked at the mapping between events, the API endpoints and the lambda function handlers in the service, all described intuitively in the <code class="language-text">serverless.yml</code> file.</p>
<p>By now, you should have an end-to-end implementation of a serverless REST API service written in Java and deployed to AWS.</p>
<p>Hope you liked the post, and feel free to give me your feedback or ask any questions, in the comments below.</p></section><hr style="margin-bottom:1.75rem"/><footer><div style="display:flex;margin-bottom:4.375rem"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:50px;height:50px;margin-right:0.875rem;margin-bottom:0;min-width:50px;border-radius:100%"><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGQABAQADAQAAAAAAAAAAAAAAAAUBAgME/8QAFwEBAAMAAAAAAAAAAAAAAAAAAgABA//aAAwDAQACEAMQAAABtTuWpVlGVPBk0HAFf//EABsQAAICAwEAAAAAAAAAAAAAAAECAxMAESMk/9oACAEBAAEFAnOlgZ7cvIZnEYuxj6ZjxjOh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAEQEiH/2gAIAQMBAT8BwqOP/8QAGREAAQUAAAAAAAAAAAAAAAAAAAEQEiEx/9oACAECAQE/AbJCY3//xAAgEAABAgUFAAAAAAAAAAAAAAABABECAxASITFBYYGR/9oACAEBAAY/Ai2qYx3A0tPifYlsLBBT8qX3T//EABoQAQADAQEBAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8hRVcZF9KXnJkRaRWsbCd3oQNMD6x1eoRshVw76T//2gAMAwEAAgADAAAAENvoAP/EABkRAAIDAQAAAAAAAAAAAAAAAAABESExUf/aAAgBAwEBPxCEpsj00xYf/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAEQESExUf/aAAgBAgEBPxBNs0X5A9n/xAAeEAEBAQACAQUAAAAAAAAAAAABEQAhMUFRYXGBkf/aAAgBAQABPxClwdnV0whQo4lO/wAzyyrjkGw+cZbkILxecbfXBH7zSeBntAmta2n5uEBbXZ4N/9k=" alt="Kyle Mathews" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;border-radius:50%"/><noscript><picture><source srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" /><img loading="lazy" width="50" height="50" srcset="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg 1x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/aba1d/profile-pic.jpg 1.5x,
/lumen/static/4f27694bd7811d13157e5e488ad64f43/b315d/profile-pic.jpg 2x" src="/lumen/static/4f27694bd7811d13157e5e488ad64f43/99438/profile-pic.jpg" alt="Kyle Mathews" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><p>Written by <strong>Kyle Mathews</strong> <!-- -->who lives and works in San Francisco building useful things.<!-- --> <a href="https://twitter.com/kylemathews">You should follow him on Twitter</a></p></div></footer></article><nav><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/lumen/posts/2018-04-10-announcing-new-2018-serverless-champions/">← <!-- -->Introducing our first cohort of 2018 Serverless Champions</a></li><li><a rel="next" href="/lumen/posts/2018-04-18-manage-canary-deployments-lambda-functions-serverless-framework/">How to manage canary deployments on Lambda via the Serverless Framework<!-- --> →</a></li></ul></nav></main><footer>© <!-- -->2020<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/2018-04-16-how-to-create-a-rest-api-in-java-using-dynamodb-and-serverless/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-36e457a5393b79b99515.js"],"component---src-pages-404-js":["/component---src-pages-404-js-9578b926700cf49bb4fc.js"],"component---src-pages-index-js":["/component---src-pages-index-js-753a3f9bde0636fce206.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-f16d60f62c7d2b3e9bcc.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e4c781a4720974cc2679.js"]};/*]]>*/</script><script src="/lumen/component---src-templates-blog-post-js-e4c781a4720974cc2679.js" async=""></script><script src="/lumen/cd7d5f864fc9e15ed8adef086269b0aeff617554-c8f68cb3ade1320f5257.js" async=""></script><script src="/lumen/commons-4c36ffabef1434ec1126.js" async=""></script><script src="/lumen/app-36e457a5393b79b99515.js" async=""></script><script src="/lumen/styles-cd63080e784be7b7e7cf.js" async=""></script><script src="/lumen/framework-5fc6169171e885c3b522.js" async=""></script><script src="/lumen/webpack-runtime-c76c0c9d42bc9bf56761.js" async=""></script></body></html>