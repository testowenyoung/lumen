{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/2018-05-15-how-to-create-blog-using-components-hugo/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"9cd85518-e475-5e4d-baba-ec7744667e1d","excerpt":"Update: This post is based on the beta version of Serverless Components, which is not compatible with the latest, and much faster, GA version. Please check out…","html":"<blockquote>\n<p><strong>Update:</strong> This post is based on the beta version of Serverless Components, which is not compatible with the latest, and much faster, GA version. Please check out the <a href=\"https://github.com/serverless/components\">latest docs</a> for more up to date information.</p>\n</blockquote>\n<p>Most of us blog, and a very common dilemma is deciding how to host the blog site. You want something easy to use, produce content with, and maintain. Bonus points if it’s also easy to port elsewhere in case you ever want to move it.</p>\n<p><a href=\"https://www.staticgen.com/\">Static site generators</a> are a good option in this regard; they help keep the authoring part simple. They use Markdown as a document format, spruce up the look &#x26; feel with themes, and provide a simple workflow for a fully deployable HTML/CSS/JS-based blog site.</p>\n<p>The deployment part is, however, up to you. In this post, we will create a serverless, static blog site. We’ll generate it with Hugo, deploy it with pre-built <a href=\"https://serverless.com/blog/what-are-serverless-components-how-use/\">Serverless Components</a>, and host it on AWS.</p>\n<p>Why serverless? Hosting static websites with serverless is a key use case: not only easy to deploy, but also very cost-effective.</p>\n<p>Here is what we will cover:</p>\n<ul>\n<li>Generate a static blog site</li>\n<li>Deploy the site using Serverless Components</li>\n<li>Deep dive into configuration and implementation</li>\n</ul>\n<h2>Generating a static blog site</h2>\n<p>Although we will be using Hugo to generate our blog site, you can use your favorite static generator. As long as you can build the final site into a local folder, you are good to go. We’ll see how that can be done with Hugo.</p>\n<p><strong>Note:</strong> Since working with Hugo is well documented on their site, I’ll leave the exercise of creating the site to you. However, to get you started, I’ve created a sample blog site and shared it below. You can use that with the solution I present here.</p>\n<p>First, make sure to get <a href=\"https://gohugo.io/getting-started/quick-start/\">Hugo installed and working</a>.</p>\n<p>Then, run the following commands on your terminal to get going:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># get the site code</span>\n$ <span class=\"token function\">git</span> clone https://github.com/rupakg/sls-blog\n\n<span class=\"token comment\"># test the site locally at localhost:1313/</span>\nhugo server -D\n\n<span class=\"token comment\"># publish to the local 'site' folder</span>\nhugo -d site</code></pre></div>\n<p><strong>Note</strong>: The sample <a href=\"https://github.com/rupakg/sls-blog\">sls-blog</a> site code is on Github.</p>\n<p>If you are following along, you should have a working blog site that you previwed locally at <code class=\"language-text\">localhost://1313</code>, and you should have the static files ready to be deployed in the <code class=\"language-text\">site</code> folder on your machine.</p>\n<h2>Wrapping it up in a component</h2>\n<p>You might have already heard about our latest project, <a href=\"https://github.com/serverless/components\">Serverless Components</a>, and <a href=\"https://serverless.com/blog/what-are-serverless-components-how-use/\">how you can use them</a>. Our goal was to encapsulate common functionality into so-called “components”, which could then be easily re-used, extended and shared with other developers and other serverless applications.</p>\n<p>We built all the functionality needed to take a set of static files, host it on S3 with appropriate permissions &#x26; configuration, set it up on a CDN, map a domain name, and finally deploy it to AWS.</p>\n<h2>The blog application</h2>\n<p>The blog application references the <code class=\"language-text\">static website</code> component that encapsulates all the functionality we need.</p>\n<p>Here’s the <code class=\"language-text\">serverless.yml</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> blog<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> 0.0.1\n\n<span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">blogSite</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> static<span class=\"token punctuation\">-</span>website\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> blog<span class=\"token punctuation\">-</span>site\n      <span class=\"token key atrule\">contentPath</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>self.path<span class=\"token punctuation\">}</span>/site\n      <span class=\"token key atrule\">templateValues</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">contentIndex</span><span class=\"token punctuation\">:</span> index.html\n      <span class=\"token key atrule\">contentError</span><span class=\"token punctuation\">:</span> error.html\n      <span class=\"token key atrule\">hostingRegion</span><span class=\"token punctuation\">:</span> us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n      <span class=\"token key atrule\">hostingDomain</span><span class=\"token punctuation\">:</span> sls<span class=\"token punctuation\">-</span>blog<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span>self.serviceId<span class=\"token punctuation\">}</span>.example.com\n      <span class=\"token key atrule\">aliasDomain</span><span class=\"token punctuation\">:</span> www.sls<span class=\"token punctuation\">-</span>blog<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span>self.serviceId<span class=\"token punctuation\">}</span>.example.com</code></pre></div>\n<p>The <code class=\"language-text\">type</code> identifies the application. The <code class=\"language-text\">components</code> block is the gut of the application. It simply references the <code class=\"language-text\">static-website</code> component using the <code class=\"language-text\">type</code> attribute. It used the <code class=\"language-text\">inputs</code> block to supply the input parameters required by the <code class=\"language-text\">static-website</code> component to customize it behavior.</p>\n<p>The <code class=\"language-text\">contentPath</code> specifies the path where the content of the site belongs. In the above section, we generated the static files for our blog site using Hugo. This location is what we specify here.</p>\n<p>Although the <code class=\"language-text\">static-website</code> component can make use of <code class=\"language-text\">templateValues</code> using Mustache templates, our blog site does not use it.</p>\n<p>The <code class=\"language-text\">hostingDomain</code> and <code class=\"language-text\">aliasDomain</code> attributes are used to configure the CDN and map it to a domain name.</p>\n<p>You will notice the usage of the variable <code class=\"language-text\">${self.serviceId}</code> in the above configuration. The <code class=\"language-text\">serviceId</code> is an unqiue, autogenerated, random identifier that you can use to force uniqueness. In our case, you can copy the same application over and create as many instances of blog sites you want. In all practical purposes, you will probably replace the <code class=\"language-text\">hostingDomain</code> and <code class=\"language-text\">aliasDomain</code> attribute values with your own specific domain names.</p>\n<h3>Deploy</h3>\n<p>Once you have the <code class=\"language-text\">serverless.yml</code> set and file path for your static files ready, you can simply <code class=\"language-text\">deploy</code> the blog application.</p>\n<p>Here’s how:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ components deploy</code></pre></div>\n<p>This will detect the component dependencies, run the deployment logic for each, and finally deploy the blog application to AWS.</p>\n<p>Here’s what you get:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Creating Bucket: <span class=\"token string\">'sls-blog-81jdzsed8u.example.com'</span>\nCreating Bucket: <span class=\"token string\">'www.sls-blog-81jdzsed8u.example.com'</span>\nCreating Site: <span class=\"token string\">'blog-site'</span>\nSetting policy <span class=\"token keyword\">for</span> bucket: <span class=\"token string\">'sls-blog-81jdzsed8u.example.com'</span>\nSyncing files from <span class=\"token string\">'/var/folders/s1/1hcnm6hx6zgg5nbz9jm16wq80000gn/T/tmp-56625JsN0DiMB4ZOV'</span> to bucket: <span class=\"token string\">'sls-blog-81jdzsed8u.example.com'</span>\nSetting website configuration <span class=\"token keyword\">for</span> Bucket: <span class=\"token string\">'sls-blog-81jdzsed8u.example.com'</span>\nCreating CloudFront distribution: <span class=\"token string\">'blog-site'</span>\nSetting redirection <span class=\"token keyword\">for</span> Bucket: <span class=\"token string\">'www.sls-blog-81jdzsed8u.example.com'</span>\nSet policy and CORS <span class=\"token keyword\">for</span> bucket <span class=\"token string\">'sls-blog-81jdzsed8u.example.com'</span>\nUploading file: <span class=\"token punctuation\">..</span>.\n<span class=\"token punctuation\">..</span>. snip <span class=\"token punctuation\">..</span>.\nObjects Found: <span class=\"token number\">0</span> , Files Found: <span class=\"token number\">35</span> , Files Deleted: <span class=\"token number\">0</span>\nCloudFront distribution <span class=\"token string\">'blog-site'</span> creation initiated\nCreating Route53 mapping: <span class=\"token string\">'www.sls-blog-81jdzsed8u.example.com => d2vruw3j75x9bz.cloudfront.net'</span>\nRoute53 Hosted Zone <span class=\"token string\">'blog-site-site-81jdzsed8u-2x3n7tbu-1525982498'</span> creation initiated\nRoute53 Record Set <span class=\"token string\">'www.sls-blog-81jdzsed8u.example.com => d2vruw3j75x9bz.cloudfront.net'</span> creation initiated\nStatic Website resources:\n  http://sls-blog-81jdzsed8u.example.com.s3-website-us-east-1.amazonaws.com</code></pre></div>\n<p>:boom: You have a blog site at:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">http://sls-blog-81jdzsed8u.example.com.s3-website-us-east-1.amazonaws.com</code></pre></div>\n<p><img src=\"https://user-images.githubusercontent.com/8188/38143986-f38eb3c8-3410-11e8-9fc6-72b8212614b9.png\" alt=\"image\"></p>\n<p>Figure: <em>Blog site built with Hugo and deployed with Serverless Components</em></p>\n<p><strong>Note</strong>: If you put in a real domain name, you can access the site via the domain as well. Give CloudFront and Route53 about 15-20 mins to finish the configuration.</p>\n<p>You can also get the information about the resources that were deployed by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ components info</code></pre></div>\n<p>And you can always cleanup the resources by running:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ components remove</code></pre></div>\n<h2>The Aha Moment</h2>\n<p>Let’s just think for a moment about what we just did there. You have a blog site, based on your theme, optimised using a CDN, on your domain, using serverless, on AWS. In…really not that much time. And no servers to maintain!</p>\n<p>No excuses—get on with those articles you have been meaning to write!</p>\n<p>Now that I have piqued your interest in Serverless Components, I wanted to also express that you don’t have to be highly technical to use it. The Serverless Components abstracts away a lot of inner workings, and exposes a simplistic view of the behavior you seek. You, as a front-end developer or a full-stack engineer, can benefit from using the serverless technologies without getting into the nuts and bolts of things.</p>\n<p>For the curious, let’s get into the details and take a peek behind the curtain of how these components work.</p>\n<h2>The Static Website Component</h2>\n<p>The blog site we created uses the <code class=\"language-text\">static-website</code> component.</p>\n<p>Let’s walk through the <code class=\"language-text\">static-website</code> component that wraps up the functionality to deploy a static website on AWS S3. It not only configures S3 to host a website, but also configures a CDN using CloudFront and maps a custom domain via Route53 (DNS).</p>\n<p>Yes, that’s a lot of moving parts, but that’s the beauty of encapsulating all that complexity in a reusable and sharable Serverless Component.</p>\n<p>The <code class=\"language-text\">static-website</code> component is composed of several other smaller components. The idea is to build up small, independent blocks of functionality and encapsulate them into reusable chunks.</p>\n<p>The <code class=\"language-text\">static-website</code> component is <a href=\"https://github.com/serverless/components/tree/master/registry/static-website\">shared via the registry</a> on Github.</p>\n<h3>Configuration</h3>\n<p>Components are declared and customized by its configuration file (i.e. <code class=\"language-text\">serverless.yml</code>). They are identified by a <code class=\"language-text\">type</code> and take input parameters to customize it’s behavior.</p>\n<p>The input parameters are described by an <code class=\"language-text\">inputTypes</code> block in the component’s configuration file. Components can be made up of other Components. The ‘composition’, or the component’s dependencies, are specified in the <code class=\"language-text\">components</code> block.</p>\n<p>Let’s take a look at the <code class=\"language-text\">serverless.yml</code> file for the <code class=\"language-text\">static-website</code> component.</p>\n<h4>Type and Metadata</h4>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> static<span class=\"token punctuation\">-</span>website\n<span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> 0.2.0\n<span class=\"token key atrule\">core</span><span class=\"token punctuation\">:</span> 0.2.x</code></pre></div>\n<p>The <code class=\"language-text\">type</code> attribute is used to reference the component when used from another application or component.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Static Website component.\"</span>\n<span class=\"token key atrule\">license</span><span class=\"token punctuation\">:</span> Apache<span class=\"token punctuation\">-</span><span class=\"token number\">2.0</span>\n<span class=\"token key atrule\">author</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Serverless, Inc. &lt;hello@serverless.com> (https://serverless.com)\"</span>\n<span class=\"token key atrule\">repository</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"github:serverless/components\"</span></code></pre></div>\n<p>All of the above attributes are pretty self-explanatory, and are metadata about the component.</p>\n<h4>Input Parameters</h4>\n<p>The <code class=\"language-text\">inputTypes</code> block is the specification for inputs that the component exposes. The specs allow for specifying if a parameter is required or not and it’s default values. The system will validate the inputs based on these specs.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">inputTypes</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n    <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">displayName</span><span class=\"token punctuation\">:</span> Site Name\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Logical name of the site\n  <span class=\"token key atrule\">contentPath</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n    <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> ./site\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> Relative path of a folder for the contents of the site like './site'\n  <span class=\"token key atrule\">templateValues</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> object\n    <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">contentIndex</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n    <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> index.html\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> The index page for the site like 'index.html'\n  <span class=\"token key atrule\">contentError</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n    <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> error.html\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> The error page for the site like 'error.html'\n  <span class=\"token key atrule\">hostingRegion</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n    <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> The AWS region where the site will be hosted like 'us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span>1'\n  <span class=\"token key atrule\">hostingDomain</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n    <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> site<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span>self.instanceId<span class=\"token punctuation\">}</span>.example.com\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> The domain name for the site like 'serverless.com'\n  <span class=\"token key atrule\">aliasDomain</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> string\n    <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span>\n    <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span> www.site<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span>self.instanceId<span class=\"token punctuation\">}</span>.example.com\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> The alias domain for the site like 'www.serverless.com'</code></pre></div>\n<h4>Composition</h4>\n<p>The <code class=\"language-text\">components</code> block lists the dependencies that make up the top-level component or an application. In the case of the <code class=\"language-text\">static-website</code> component, we have several smaller components that build up the functionality:</p>\n<ul>\n<li><code class=\"language-text\">mustache</code>: provides Mustache templating capabilities</li>\n<li><code class=\"language-text\">aws-s3-bucket</code>: manages a S3 bucket</li>\n<li><code class=\"language-text\">s3-policy</code>: manages S3 bucket policy</li>\n<li><code class=\"language-text\">s3-sync</code>: sync a local folder to a S3 bucket</li>\n<li><code class=\"language-text\">s3-website-config</code>: configures a S3 bucket for website hosting</li>\n<li><code class=\"language-text\">aws-cloudfront</code>: configures and manages CloudFront distribution</li>\n<li><code class=\"language-text\">aws-route53</code>: configures and manages Route53 mappings</li>\n</ul>\n<p><strong>Note</strong>: You can find more details about these components and look at the code in the <a href=\"https://github.com/serverless/components/tree/master/registry\">Components registry</a>.</p>\n<p>Each one of these components are independent of each other, but they can be weaved together into a higher-order compomnent.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">renderedFiles</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> mustache\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">sourcePath</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.contentPath<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.templateValues<span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">rootDomainBucket</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>s3<span class=\"token punctuation\">-</span>bucket\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.hostingDomain<span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">rootDomainBucketPolicy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>policy\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">bucketName</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>rootDomainBucket.name<span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">siteContentUploader</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>sync\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">contentPath</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>renderedFiles.renderedFilePath<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">bucketName</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>rootDomainBucket.name<span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">wwwDomainBucket</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>s3<span class=\"token punctuation\">-</span>bucket\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.aliasDomain<span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">rootDomainBucketConfig</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> s3<span class=\"token punctuation\">-</span>website<span class=\"token punctuation\">-</span>config\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">rootBucketName</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>rootDomainBucket.name<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">indexDocument</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.contentIndex<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">errorDocument</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.contentError<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">redirectBucketName</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>wwwDomainBucket.name<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">redirectToHostName</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>rootDomainBucket.name<span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">siteCloudFrontConfig</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>cloudfront\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.name<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">defaultRootObject</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.contentIndex<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">originId</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.hostingDomain<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">originDomain</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>rootDomainBucket.name<span class=\"token punctuation\">}</span>.s3.amazonaws.com\n      <span class=\"token key atrule\">aliasDomain</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.aliasDomain<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">distributionEnabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">siteRoute53Config</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>route53\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.name<span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>site<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span>self.instanceId<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">domainName</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.aliasDomain<span class=\"token punctuation\">}</span>\n      <span class=\"token key atrule\">dnsName</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>siteCloudFrontConfig.distribution.domainName<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Note</strong>: Take a look at the entire <code class=\"language-text\">serverless.yml</code> file <a href=\"https://github.com/serverless/components/blob/master/registry/static-website/serverless.yml\">here</a>.</p>\n<h4>Input Variables</h4>\n<p>Child components can use parent’s <code class=\"language-text\">inputs</code> as input for themselves. This allows sharing of input data and also signifies a dependency.</p>\n<p>Here is an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">  <span class=\"token key atrule\">siteCloudFrontConfig</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>cloudfront\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">...</span>\n      <span class=\"token key atrule\">originId</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.hostingDomain<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">...</span>\n      <span class=\"token key atrule\">aliasDomain</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>input.aliasDomain<span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">...</span></code></pre></div>\n<p>Here the <code class=\"language-text\">siteCloudFrontConfig</code> component needs the hosting domain name and the alias domain name to configure the CloudFront distribution. So, it passes the <code class=\"language-text\">input.hostingDomain</code> to its <code class=\"language-text\">originId</code> parameter, and <code class=\"language-text\">input.aliasDomain</code> to its <code class=\"language-text\">aliasDomain</code> domain parameter.</p>\n<p>Recall that the blog site (parent application in our case) had the <code class=\"language-text\">inputs</code> block as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> blog<span class=\"token punctuation\">-</span>app\n<span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> 0.0.1\n\n<span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">blogSite</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> static<span class=\"token punctuation\">-</span>website\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">...</span>\n      <span class=\"token key atrule\">hostingDomain</span><span class=\"token punctuation\">:</span> sls<span class=\"token punctuation\">-</span>blog<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span>self.serviceId<span class=\"token punctuation\">}</span>.example.com\n      <span class=\"token key atrule\">aliasDomain</span><span class=\"token punctuation\">:</span> www.sls<span class=\"token punctuation\">-</span>blog<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span>self.serviceId<span class=\"token punctuation\">}</span>.example.com</code></pre></div>\n<h4>Output Variables</h4>\n<p>Components can take input parameters to customize their behavior, but components can also expose output variables. The output variables expose output values that are generated inside the component as part of their implementation.</p>\n<p>Here is an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">  <span class=\"token key atrule\">siteRoute53Config</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>route53\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">...</span>\n      <span class=\"token key atrule\">dnsName</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>siteCloudFrontConfig.distribution.domainName<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">dnsName</code> input parameter for the <code class=\"language-text\">aws-route53</code> component is provided the output from the <code class=\"language-text\">aws-cloudfront</code> component. You will notice that the component’s instance name, <code class=\"language-text\">siteCloudFrontConfig</code>, is used to reference the output variable.</p>\n<h4>Dependency</h4>\n<p>Components can have dependencies amongst each other; it can be fairly cumbersome for a component or application author to keep track of. To aid with that, the system keeps track of the dependency tree for you, based on the use of input variables and output variables.</p>\n<p>For example, since the <code class=\"language-text\">siteRoute53Config</code> component uses the output variable from the <code class=\"language-text\">siteCloudFrontConfig</code> component, the <code class=\"language-text\">siteRoute53Config</code> component waits for the <code class=\"language-text\">siteCloudFrontConfig</code> component to finish, and then uses its output.</p>\n<p>The set of components that do not have any dependencies can execute in parallel, thus improving performance.</p>\n<h2>Component Behavior</h2>\n<p>We looked at the configuration for the <code class=\"language-text\">static-website</code> component. Now, let’s look at the code that drives the behavior.</p>\n<p>The behavior or implementation of the <code class=\"language-text\">static-website</code> component is placed in the <code class=\"language-text\">index.js</code> file, as shown below:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"># index<span class=\"token punctuation\">.</span>js\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> not<span class=\"token punctuation\">,</span> isEmpty <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ramda'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">deploy</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">inputs<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> outputs <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>state\n\n  <span class=\"token keyword\">const</span> s3url <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">http://</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>inputs<span class=\"token punctuation\">.</span>hostingDomain<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.s3-website-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>inputs<span class=\"token punctuation\">.</span>hostingRegion<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.amazonaws.com</span><span class=\"token template-punctuation string\">`</span></span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>name <span class=\"token operator\">&amp;&amp;</span> inputs<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Creating Site: '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>inputs<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    outputs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      url<span class=\"token operator\">:</span> s3url\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>inputs<span class=\"token punctuation\">.</span>name <span class=\"token operator\">&amp;&amp;</span> context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Removing Site: '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    outputs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      url<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>name <span class=\"token operator\">!==</span> inputs<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Removing old Site: '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Creating new Site: '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>inputs<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    outputs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      url<span class=\"token operator\">:</span> s3url\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  context<span class=\"token punctuation\">.</span><span class=\"token function\">saveState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>inputs<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>outputs <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> outputs\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">remove</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">inputs<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  context<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Removing Site: '</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  context<span class=\"token punctuation\">.</span><span class=\"token function\">saveState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">info</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">inputs<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> message\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">not</span><span class=\"token punctuation\">(</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    message <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">'Static Website resources:'</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">  </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>context<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    message <span class=\"token operator\">=</span> <span class=\"token string\">'No Static Website state information available. Have you deployed it?'</span>\n  <span class=\"token punctuation\">}</span>\n  context<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  deploy<span class=\"token punctuation\">,</span>\n  remove<span class=\"token punctuation\">,</span>\n  info\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let’s walk through the code.</p>\n<p>First, note the three methods that provide all the functionality: <code class=\"language-text\">deploy</code>, <code class=\"language-text\">remove</code>, and <code class=\"language-text\">info</code>. At the end of the code block, you will notice that these methods are exported so that they are publicly accessible from outside.</p>\n<p>At minimum, all components should follow this pattern and implement these three methods. The core system will build the dependency tree of child components and call these methods down the chain.</p>\n<p>However, it is not necessary to provide an implementation via the <code class=\"language-text\">index.js</code> file if you don’t need it. You can see that the <code class=\"language-text\">blog-app</code> application that we created does not provide any <code class=\"language-text\">index.js</code> file. It just describes the composition of it’s child components via the <code class=\"language-text\">serverless.yml</code> configuration file.</p>\n<h3>The <code class=\"language-text\">deploy</code> method</h3>\n<p>The <code class=\"language-text\">deploy</code> method is used to encapsulate the deployment behavior of the component. It inspects &#x26; validates input parameters, calls appropriate code to deploy the necessary resources, and saves state in the <code class=\"language-text\">state.json</code> on disk.</p>\n<p>The <code class=\"language-text\">static-website</code> component completely relies on its child component implementations, and so the <code class=\"language-text\">deploy</code> method only prints out a message that includes the site url. The system calls the <code class=\"language-text\">deploy</code> method of the child components down the dependency chain.</p>\n<h3>The <code class=\"language-text\">remove</code> method</h3>\n<p>The <code class=\"language-text\">remove</code> method is used to encapsulate the cleanup behavior of the component. It reverses the effect and cleans up resources created via the <code class=\"language-text\">deploy</code> method.</p>\n<p>In this case, a message is printed stating that the site has been removed. The component’s state in the <code class=\"language-text\">state.json</code> file is also cleared. The system calls the <code class=\"language-text\">remove</code> method of the child components down the dependency chain.</p>\n<h3>The <code class=\"language-text\">info</code> method</h3>\n<p>The <code class=\"language-text\">info</code> method is used to print any resources that were deployed. In this case, the static website url is printed if the component has been deployed.</p>\n<h2>Summary</h2>\n<p>We saw how easy and simple it is to use Serverless Components to build and deploy applications, such as the blog site we created. Components gives us the flexibility to compose higher-order applications by combining reusable pieces of code.</p>\n<p>What will you build with components? Let us know in the comments below.</p>\n<h3>More on Components</h3>\n<ul>\n<li><a href=\"https://serverless.com/blog/what-are-serverless-components-how-use/\">What are Serverless Components, and how do I use them?</a></li>\n<li><a href=\"https://serverless.com/blog/how-create-rest-api-serverless-components/\">Create a REST API with pre-written Serverless Components</a></li>\n<li><a href=\"https://serverless.com/blog/how-to-create-landing-page-with-serverless-components/\">Create a landing page with pre-written Serverless Components</a></li>\n</ul>","frontmatter":{"title":"Create a blog using pre-built Serverless Components and Hugo","date":"May 14, 2018","description":"Learn how to use pre-built Serverless Components and a static site generator like Hugo to create and deploy a blog site."}}},"pageContext":{"slug":"/posts/2018-05-15-how-to-create-blog-using-components-hugo/","previous":{"fields":{"slug":"/posts/2018-05-07-how-create-rest-api-serverless-components/"},"frontmatter":{"title":"How to create a REST API with pre-written Serverless Components"}},"next":{"fields":{"slug":"/posts/2018-05-17-serverless-platform-updates-framework-components-event-gateway/"},"frontmatter":{"title":"Serverless Platform updates - Install Components from url, Fn Project support, CloudEvents"}}}}}