{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/2020-02-11-cicd-promotion-pipelines/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"167f8fa3-3244-589c-b377-dde0f83f0d23","excerpt":"Serverless application development is great for rapidly spinning up solutions to problems; you complete a little configuration in a serverless.yml file, add…","html":"<p>Serverless application development is great for rapidly spinning up solutions to problems; you complete a little configuration in a serverless.yml file, add some Lambda code to glue it all together and hit <code class=\"language-text\">sls deploy</code>. However, this isn’t really going to fly when you have multiple team members working on the same code. You can’t have multiple developers deploying code at the same time to the same infrastructure, potentially overwriting what each is doing.</p>\n<p>The first step to resolving this issue is to allow each developer access to their own AWS account, possibly using the AWS Organisations service that makes managing multiple child accounts to the organisations main account an easy to manage process. But what happens when this all needs to come together preferably in some kind of staging environment?</p>\n<h4>Use stages for environments</h4>\n<p>The Serverless Framework has a feature you may already be familiar with; stages. You can deploy a Serverless Framework to AWS by passing it a stage that can differentiate one stack from another and this means you have the means to have various environments to deploy to. </p>\n<p><code class=\"language-text\">serverless deploy --stage staging</code></p>\n<p>Now if all services are deployed to the staging environment it means we have some way to do some quality assurance on an application and a collection of services before we deploy this to production. We can run our integration tests, perform some manual confirmation with stakeholders and customers, and then we just do a … </p>\n<p><code class=\"language-text\">serverless deploy --stage prod</code></p>\n<p>… right?</p>\n<p>This in itself has problems. Its great we can break things up as far as environments are concerned, but we probably need more reliable ways to make sure that code gets pushed to the right environments just as a part of the development flow of your developers.</p>\n<h4>Lets tie in some branching strategies</h4>\n<p>In a more traditional development environment, the software development lifecycle will include a strategy of using branches to indicate the relative promotion of code to staging and development environments. And to that you would also have a CI/CD backend being triggered off of merges into specific branches. Merging into a develop branch deploys code into a staging environment. Merging into master ends up deploying into the production environment. And deployments cannot be made in any other way.</p>\n<p>What if we can get these kinds of strategies to work for our Serverless applications? It will help us solve some of these problems</p>\n<h4>Enter Serverless Framework Pro CI/CD</h4>\n<p>This is actually very simple to do with Serverless Framework Pro’s CI/CD feature. There are just a couple of pre-requisites to get up and running:</p>\n<ol>\n<li>Need service (at least an initial version) with a serverless.yml file and an <code class=\"language-text\">app</code> and <code class=\"language-text\">org</code> set within that serverless.yml</li>\n<li>The service needs to already be pushed to a Github repo with all the branches you want to auto-deploy to different environments already created; if you want to deploy from the develop branch to a develop environment/stage, that needs to be created already.</li>\n<li>Lastly we also need to deploy at least once to make sure the service is added to Serverless Framework Pro.</li>\n</ol>\n<p>With that out of the way, lets go to our service in the Serverless Framework Pro Dashboard:</p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/promotion-pipelines/EnableServiceD.png\" alt=\"Enable Service D Image\"></p>\n<p>As we can see, there’s a handy <code class=\"language-text\">enable</code> link we can click on.</p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/promotion-pipelines/ConnectToGithub.png\" alt=\"Enable Github\"></p>\n<p>Now we just need to connect Serverless Framework Pro to our Github account and follow the Github OAuth prompts to give the required permissions to enable Serverless Framework CI/CD to deploy our services for us. </p>\n<p>Once we are connected:</p>\n<ol>\n<li>Choose the repository we want to deploy from.</li>\n<li>Select the base directory the service sits … yes we can do mono repo things … more in a future blog post</li>\n</ol>\n<p>And now comes what we have all been waiting for. Scroll down the the section labelled <code class=\"language-text\">branch deploys</code>:</p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/promotion-pipelines/BranchDeploys.png\" alt=\"Branch Deploys UI\"></p>\n<p>This is where we can now link the branches in our repository to stages in our application, and those stages are linked to profiles <a href=\"https://serverless.com/blog/serverless-deployment-best-practices/\">that help us control how and to which AWS accounts we deploy to</a>.</p>\n<p>And that’s pretty much. I did say it was easy. Once we match our branch to the right stage, every merge into those branches will automatically begin deployment.. </p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/promotion-pipelines/QueuedDeployment.png\" alt=\"Queued Deployment\">   </p>\n<p>To get started head to the <a href=\"https://dashboard.serverless.com\">Serverless Framework Pro Dashboard</a> and sign up for free!!</p>","frontmatter":{"title":"Promotion Pipelines","date":"February 11, 2020","description":"Find out what deployment strategies Serverless Framework Pro's CI/CD feature gives us for managing deployments as a team"}}},"pageContext":{"slug":"/posts/2020-02-11-cicd-promotion-pipelines/","previous":{"fields":{"slug":"/posts/2020-02-10-preview-deployments/"},"frontmatter":{"title":"A Guide to Preview Deployments with Serverless CI/CD"}},"next":{"fields":{"slug":"/posts/2020-02-17-stages-and-environments/"},"frontmatter":{"title":"Managing Stages and Environments"}}}}}