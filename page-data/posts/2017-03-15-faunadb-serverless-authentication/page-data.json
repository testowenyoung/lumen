{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/2017-03-15-faunadb-serverless-authentication/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"bcd5336a-f4bf-56ae-84ca-f2de20e9e629","excerpt":"Three cheers to our friends at Fauna as they announce FaunaDB Serverless Cloud, a globally consistent distributed database. This is a guest post from Chris…","html":"<p><em>Three cheers to our friends at Fauna as they announce <a href=\"https://fauna.com/product\">FaunaDB Serverless Cloud</a>, a globally consistent distributed database. This is a guest post from Chris Anderson, Director of Developer Experience at Fauna.</em></p>\n<p>A common serverless application architecture is to run an authentication service, which knows how to connect with OAuth identity providers like Facebook and Github, and exposes an authorizer Lambda that can control access to your functions. This makes authentication code reusable and cleanly separates it from your other functions.</p>\n<p>FaunaDB offers instance-level security, so you can model your application’s data sharing patterns in the database. In this example we use the popular <a href=\"https://github.com/laardee/serverless-authentication-boilerplate\"><code class=\"language-text\">serverless-authentication-boilerplate</code></a> to connect a FaunaDB app to Facebook login. Thanks to <a href=\"https://www.linkedin.com/in/eetutuomala/\">Eetu Tuomala</a> for the help with API Gateway details!</p>\n<p>In the Serverless model, the authorizer supplies functions contained in the application with a FaunaDB connection secret that corresponds to the currently logged-in user. This way, there’s no possibility of bugs at the application level impacting data integrity and security.</p>\n<p>There’s no limit to the data security patterns you can model in FaunaDB. See our tutorials for <a href=\"https://fauna.com/tutorials/social\">social graph examples</a>, or follow this space for a multi-user TodoMVC example. For now, the content service just looks up the current user in the database.</p>\n<p>These instructions for launching the Serverless Authentication Boilerplate with FaunaDB are based on the <a href=\"https://github.com/laardee/serverless-authentication-boilerplate/blob/master/README.md\"><code class=\"language-text\">serverless-authentication-boilerplate</code> README</a>.</p>\n<p>This is not simplified example code, rather more like the first steps you’d take when creating a new real world application. The final result is not a cool demo, it’s a useful auth service you can rely on. If you’re looking for more basic usage of FaunaDB and Serverless, see our <a href=\"https://fauna.com/blog/serverless-cloud-database\">blog post about the FaunaDB Serverless CRUD example.</a> There is also a <a href=\"https://serverless.com/blog/serverless-fauna-python-example/\">Python version available</a>.</p>\n<h2>Installing Serverless Authentication</h2>\n<p>The boilerplate ships with code for a few different identity backends. These steps walk you through installing the service and running it with FaunaDB. The FaunaDB example also integrates with the <code class=\"language-text\">test-token</code> example content service. So once you have it running you can <a href=\"https://github.com/laardee/serverless-authentication-boilerplate/blob/37e4006870c708fa3ef8b64d451a13e2ed93e6f3/test-token/handler.js#L20\">look at that code</a> to see how your application would use the database.</p>\n<ol start=\"0\">\n<li>If you haven’t yet, <code class=\"language-text\">npm install -g serverless</code> and make sure your <a href=\"https://serverless.com/framework/docs/providers/aws/guide/credentials/\">AWS environment variables</a> are set.</li>\n<li>Run <code class=\"language-text\">serverless install --url https://github.com/laardee/serverless-authentication-boilerplate</code>, or clone or download the repository.</li>\n<li>Rename <code class=\"language-text\">authentication/example.env.yml</code> to <code class=\"language-text\">authentication/env.yml</code> and set environmental variables. Delete the <code class=\"language-text\">CacheTable</code> entry to avoid provisioning DynamoDB tables you won’t be using.</li>\n<li>Sign up instantly and <a href=\"https://fauna.com/serverless-cloud-sign-up\">create a database in the FaunaDB dashboard</a>.</li>\n<li>Configure <code class=\"language-text\">FAUNADB_SECRET</code> in <code class=\"language-text\">authentication/env.yml</code> with a <a href=\"https://fauna.com/documentation#authentication\">server secret</a> for your database.</li>\n<li>Uncomment <code class=\"language-text\">return faunaUser.saveUser(profile);</code> from <code class=\"language-text\">authentication/lib/storage/usersStorage.js</code>.</li>\n<li>Change the last line of <code class=\"language-text\">authentication/lib/storage/cacheStorage.js</code> to <code class=\"language-text\">exports = module.exports = faunaCache;</code></li>\n<li>Change directory to <code class=\"language-text\">authentication</code> and run <code class=\"language-text\">npm install</code>.</li>\n<li>Run <code class=\"language-text\">STAGE=dev npm run setup:fauna</code> to create your FaunaDB schema.</li>\n<li>(optional) Change directory to <code class=\"language-text\">test-token</code> and run <code class=\"language-text\">serverless deploy</code> to deploy test-token service.</li>\n</ol>\n<p>Look here for the code to the <a href=\"https://github.com/laardee/serverless-authentication-boilerplate/blob/37e4006870c708fa3ef8b64d451a13e2ed93e6f3/test-token/handler.js#L20\">test-token service</a> and here for <a href=\"https://github.com/laardee/serverless-authentication-boilerplate/tree/master/authentication/lib/storage/fauna\">the code that uses FaunaDB as an authentication cache and user store.</a></p>\n<p>There’s no need to configure the <code class=\"language-text\">test-token</code> service with database access, as the <code class=\"language-text\">authorize</code> function provides a database access secret that matches the current user. Each function invocation runs only with the privileges of the current user. In a future post we’ll show how to model ownership of data instances, read and update control, and delegation of capabilities to other users.</p>\n<p>With FaunaDB you get multi-region cross-cloud replication of your data, with the option to run on-premise, avoiding vendor lock-in. You also get a functional relational query language and the ability to define complex indexes. There are <a href=\"https://fauna.com/blog/time-traveling-databases\">temporal support for sync, audit and snapshot queries.</a> And you never have to pre-provision, so you only pay for the database you use. <a href=\"https://fauna.com/serverless-cloud-sign-up\">Launch FaunaDB and you’ll be storing data in moments.</a></p>","frontmatter":{"title":"Using Serverless Authentication Boilerplate with FaunaDB","date":"March 15, 2017","description":"Use FaunaDB's secure database features with AWS API Gateway to run Lambdas with the capabilities of the authenticated user."}}},"pageContext":{"slug":"/posts/2017-03-15-faunadb-serverless-authentication/","previous":{"fields":{"slug":"/posts/2017-03-14-serverless-v1.9.0/"},"frontmatter":{"title":"Stream event improvements and custom roles for CloudFormation deployments with Serverless v1.9"}},"next":{"fields":{"slug":"/posts/2017-03-17-abstract-partner-program-announcement/"},"frontmatter":{"title":"One Chatbot, Two Millions Fans - How AbstractAI Reduced Back-End Costs By 95%"}}}}}