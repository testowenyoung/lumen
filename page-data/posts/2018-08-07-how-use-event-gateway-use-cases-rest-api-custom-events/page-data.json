{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/2018-08-07-how-use-event-gateway-use-cases-rest-api-custom-events/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"f3bb8fbb-eab7-50db-bcab-ad17ba69b36b","excerpt":"Last week, we announced the Serverless Platform Beta, a single toolkit that provides everything teams need to operationalize serverless development. The…","html":"<img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/event-gateway/event-gateway-use-cases.png\">\n<p>Last week, we announced the <a href=\"https://serverless.com/blog/serverless-platform-beta-helps-teams-operationalize-development/\">Serverless Platform Beta</a>, a single toolkit that provides everything teams need to operationalize serverless development. The Serverless Platform is made of three components—the Serverless Framework for deploying applications, the Serverless Dashboard for visualizing your application, and the Event Gateway for routing events to compute.</p>\n<p>I’m going to focus on the Event Gateway for this post. We’ll learn about two use cases of the Event Gateway:</p>\n<ul>\n<li>Building REST APIs</li>\n<li>Reacting to custom events</li>\n</ul>\n<p>Let’s get started!</p>\n<h2>Event Gateway: when you should use it</h2>\n<p>We built the <a href=\"https://serverless.com/event-gateway/\">Event Gateway</a> to be the centralized event hub for the serverless ecosystem. Rather than scattered point-to-point integrations across your infrastructure, all events will flow into a single Event Gateway.</p>\n<p>You can then configure the Event Gateway to react to these events as you want, in multiple different ways. For example, if a new user signs up and a <code class=\"language-text\">user.created</code> event is emitted into the Event Gateway, your marketing team may have a subscribed function that sends them a welcome email, while your development team may have a function that inserts the new user into Elasticsearch to power search functionality in your application.</p>\n<h2>Getting set up with the Serverless Platform</h2>\n<p>The <a href=\"https://github.com/serverless/event-gateway\">Event Gateway is an open-source project</a> that you can run yourself on your own infrastructure. We also provide a hosted version of the Event Gateway with the Serverless Platform Beta for quickly getting started with the Event Gateway.</p>\n<p><strong>Note:</strong> This section assumes you have already installed the Serverless Framework and have configured your terminal with AWS credentials. If this is not true for you, check out our longer <a href=\"https://github.com/serverless/platform/blob/master/docs/getting-started.md\">guide to getting started with the Serverless Platform</a>.</p>\n<p>You will need to sign up for a Serverless Platform account. If you already have the <a href=\"https://github.com/serverless/serverless\">Serverless Framework</a> installed, you can create a Serverless Platform account by entering the following command into your terminal:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">serverless login</code></pre></div>\n<p>This will open a browser window to create a Serverless Platform account. Once your account is created, the proper credentials will be returned to your terminal for easy command-line deploys.</p>\n<p>Once you’ve signed up for an account, create a new application in the <a href=\"https://dashboard.serverless.com\">Dashboard</a>. You can do this by clicking the red <code class=\"language-text\">+ App</code> button. When you create a new application, you will get an application URL in the form of <code class=\"language-text\">&lt;tenant&gt;-&lt;app&gt;.slsgateway.com</code>. This is the URL to which you will emit your Event Gateway events.</p>\n<p>Make sure you have your tenant name, app name, and application URL available as you will need them in the following sections.</p>\n<h2>Creating and deploying your first service</h2>\n<p>We will be using the code in the <a href=\"https://github.com/serverless/event-gateway-getting-started\">Event Gateway Getting Started repo</a>. You can clone this service into your terminal with the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">serverless create --template-url https://github.com/serverless/event-gateway-getting-started/tree/master/ --path event-gateway-getting-started</code></pre></div>\n<p>Then change into your service directory and install the dependencies:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> event-gateway-getting-started\n<span class=\"token function\">npm</span> i</code></pre></div>\n<p>Open the <code class=\"language-text\">serverless.yml</code> file and edit the <code class=\"language-text\">tenant</code> and <code class=\"language-text\">app</code> values to be your Tenant and App name from the Serverless Platform:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># serverless.yml</span>\n\n<span class=\"token key atrule\">tenant</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>tenant<span class=\"token punctuation\">-</span>here<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>app<span class=\"token punctuation\">-</span>here<span class=\"token punctuation\">></span></code></pre></div>\n<p>Then, deploy your application:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">serverless deploy</code></pre></div>\n<p>With your application deployed, it’s time to interact with your service.</p>\n<h2>Using Event Gateway for a REST API</h2>\n<p>One of the more popular use cases for the Event Gateway is to create a REST API. REST APIs have grown in popularity recently with the advent of single-page apps and microservices. </p>\n<p>Functions-as-a-service (FaaS) providers like AWS Lambda, Google Cloud Functions, and Azure Function have made it easier than ever to deploy compute to production. With the Event Gateway, you can connect an HTTP path and method to a serverless function for your REST API.</p>\n<p>To see how this is done, look at your <code class=\"language-text\">serverless.yml</code>. There is a <code class=\"language-text\">functions</code> block that describes the functions your service will deploy to AWS Lambda. Look at the top two functions in particular, as shown below:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">functions:\n  getUser:\n    handler: handler.getUser\n    events:\n      - eventgateway:\n          type: sync\n          eventType: http.request\n          path: /users/:id\n          method: GET\n  createUser:\n    handler: handler.createUser\n    events:\n      - eventgateway:\n          type: sync\n          eventType: http.request\n          path: /users\n          method: POST</code></pre></div>\n<p>For both <code class=\"language-text\">getUser</code> and <code class=\"language-text\">createUser</code>, the function’s handler is defined. Then, the <em>events</em> to which we want these functions described are listed. You can think of it like “If this, then that”—“If an HTTP POST request arrives on the <code class=\"language-text\">/users</code> path, then call the createUser function in the Event Gateway.”</p>\n<p>You can test that your REST API works by issuing an HTTP request with <code class=\"language-text\">curl</code> in your terminal. The <code class=\"language-text\">curl</code> request should go to your application URL that you configured in your terminal, in the format of <code class=\"language-text\">https://&lt;tenant&gt;-&lt;app&gt;.slsgateway.com</code>.</p>\n<p>Run the following command to issue a POST request to <code class=\"language-text\">/users</code> to create a new user:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token assign-left variable\">APP</span><span class=\"token operator\">=</span><span class=\"token string\">\"https://&lt;tenant>-&lt;app>.slsgateway.com\"</span>\n$ <span class=\"token function\">curl</span> -X POST -H <span class=\"token string\">\"Content-Type: application/json\"</span> <span class=\"token variable\">${APP}</span>/users <span class=\"token punctuation\">\\</span>\n    --data <span class=\"token string\">'{\n    \t\"id\": \"10\",\n    \t\"firstName\": \"Donald\",\n    \t\"lastName\": \"Duck\",\n    \t\"email\": \"donald.duck@disney.com\"\n    }'</span>\n\n<span class=\"token comment\"># {\"id\":10,\"firstName\":\"Donald\",\"lastName\":\"Duck\",\"email\":\"donald.duck@disney.com\"}</span></code></pre></div>\n<p>You should get a response returning the user that was created.</p>\n<p>Your AWS Lambda function will receive an event object in <a href=\"https://github.com/cloudevents/spec\">CloudEvents format</a>. CloudEvents is a CNCF hosted project for describing event data in a common way. In our request above, the <code class=\"language-text\">event</code> received by our Lambda function will look similar to the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span> <span class=\"token property\">\"eventType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http.request\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"cloudEventsVersion\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://serverless.com/event-gateway/#transformationVersion=0.1\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"eventID\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"f2f6b58d-b20a-4d23-bc41-4c3388057752\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"eventTime\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2018-08-04T17:50:05.573211588Z\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"extensions\"</span><span class=\"token operator\">:</span>\n   <span class=\"token punctuation\">{</span> <span class=\"token property\">\"eventgateway\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token property\">\"transformation-version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token property\">\"transformed\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"true\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"contentType\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span>\n   <span class=\"token punctuation\">{</span> <span class=\"token property\">\"headers\"</span><span class=\"token operator\">:</span>\n      <span class=\"token punctuation\">{</span> <span class=\"token property\">\"Accept\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*/*\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Content-Length\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"128\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"Content-Type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"User-Agent\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"curl/7.54.0\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"X-Amzn-Trace-Id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Root=1-5b65e74d-5248534899080846fc9ac954\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"X-Forwarded-For\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"97.119.150.102\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"X-Forwarded-Port\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"443\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"X-Forwarded-Proto\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"body\"</span><span class=\"token operator\">:</span>\n      <span class=\"token punctuation\">{</span> <span class=\"token property\">\"email\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"donald.duck@disney.com\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"firstName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Donald\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"10\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"lastName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Duck\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"host\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mytenant-myapp.slsgateway.com\"</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/users\"</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"method\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span>\n     <span class=\"token property\">\"params\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> \n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In the <code class=\"language-text\">data</code> object, you can see all the parameters of our HTTP request, including the <code class=\"language-text\">headers</code>, <code class=\"language-text\">body</code>, and <code class=\"language-text\">path</code>. You can use this information in the business logic of your Lambda function.</p>\n<p>You can then retrieve that user by issuing a GET request to the <code class=\"language-text\">/users/10</code> path:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token assign-left variable\">APP</span><span class=\"token operator\">=</span><span class=\"token string\">\"&lt;appURL>\"</span>\n$ <span class=\"token function\">curl</span> -X GET <span class=\"token variable\">${APP}</span>/users/10\n\n<span class=\"token comment\"># {\"id\":\"10\",\"email\":\"donald.duck@disney.com\",\"firstName\":\"Donald\",\"lastName\":\"Duck\"}</span></code></pre></div>\n<p>As you can see, the Event Gateway can easily be used to handle REST API workloads with pay-per-use, infinitely scalable serverless functions.</p>\n<h2>Using the Event Gateway with custom events</h2>\n<p>The REST API use case is a pattern with which most developers are familiar, and it’s a great way to get started with the Event Gateway. However, my favorite part of the Event Gateway is using custom events to asynchronously react to events that are happening across my application architecture.</p>\n<p>First, let’s see an example in action. Then we’ll talk about why it’s so important.</p>\n<p>In the previous section, we created a new user by making a POST request to our <code class=\"language-text\">/users</code> endpoint. If you look at the <code class=\"language-text\">createUser</code> function in the <code class=\"language-text\">handler.js</code>, you’ll see the following snippet of code after the user is saved to the database:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">eventGateway\n  <span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    eventID<span class=\"token operator\">:</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span>\n    eventType<span class=\"token operator\">:</span> <span class=\"token string\">'user.created'</span><span class=\"token punctuation\">,</span>\n    cloudEventsVersion<span class=\"token operator\">:</span> <span class=\"token string\">'0.1'</span><span class=\"token punctuation\">,</span>\n    source<span class=\"token operator\">:</span> <span class=\"token string\">'/services/users'</span><span class=\"token punctuation\">,</span>\n    contentType<span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\n    data<span class=\"token operator\">:</span> params<span class=\"token punctuation\">.</span>Item\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Emitted user.created event'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In this snippet, the function is using the <code class=\"language-text\">emit()</code> function in the <a href=\"https://github.com/serverless/event-gateway-sdk\">Event Gateway SDK</a> to emit a <code class=\"language-text\">user.created</code> event into our Event Gateway. This event contains the details of the user that was created.</p>\n<p>Now take a look at the <code class=\"language-text\">functions</code> block of your <code class=\"language-text\">serverless.yml</code> again. The third function listed looks as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">functions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">...</span>\n  <span class=\"token key atrule\">emailUser</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> handler.emailUser\n    <span class=\"token key atrule\">events</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">eventgateway</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> async\n          <span class=\"token key atrule\">eventType</span><span class=\"token punctuation\">:</span> user.created</code></pre></div>\n<p>The <code class=\"language-text\">emailUser</code> function is subscribed to the <code class=\"language-text\">user.created</code> event type and reacts in an <code class=\"language-text\">async</code> manner. In this simple example, this could be your on-boarding team sending a “Welcome!” email to your application’s new user.</p>\n<p>This is a powerful pattern. One portion of your application emits events indicating that something happened—a new user was created, an IoT light went on, or a video was viewed—and other parts of your application can receive those events and react as needed, by sending an email, storing to an analytics database, or alerting an on-call engineer.</p>\n<h3>Event Gateway use cases</h3>\n<p>We’re seeing more and more of this reactive, event-driven pattern using asynchronous communication. Microservices have allowed for teams to independently develop and scale their application components, while tools like Kafka help with asynchronous communication between microservices. For those of you that are front-end engineers, you might see Event Gateway custom events as similar to Redux actions and reducers but used in your application backend.</p>\n<p>While the <code class=\"language-text\">user.created</code> event only has one subscription in this example, you can add any number of additional subscriptions. Do you want to insert this newly-created user into Elasticsearch to power discoverability in your application? Does your sales team want to get notified if the new user works for an enterprise company? You can add additional subscriptions without affecting existing subscriptions and without updating code for the original producer.</p>\n<p>The Event Gateway is designed to democratize the accessibility of these events by connecting them to serverless functions. Just like FaaS democratized compute, the Event Gateway democratizes events.</p>\n<h3>How you can contribute</h3>\n<p>The Event Gateway is in active development, and we’re looking to make it easier to import events from your existing infrastructure, such as Kafka, Kinesis, RabbitMQ, and more. If you’re interested, check out the <a href=\"https://github.com/serverless/event-gateway\">Event Gateway repository</a> and get involved!</p>","frontmatter":{"title":"How to use the Serverless Event Gateway: build a REST API and react to custom events","date":"August 07, 2018","description":"How to use the Serverless Event Gateway (part of the Serverless Platform) to build REST APIs and react to custom events."}}},"pageContext":{"slug":"/posts/2018-08-07-how-use-event-gateway-use-cases-rest-api-custom-events/","previous":{"fields":{"slug":"/posts/2018-08-06-deploy-serverless-frontend-with-serverless-finch-plugin/"},"frontmatter":{"title":"Deploy a Serverless Frontend with the Serverless Finch Plugin"}},"next":{"fields":{"slug":"/posts/2018-08-09-django-serverless-framework-a-match-made-in-heaven/"},"frontmatter":{"title":"Deploy a REST API using Serverless, Django and Python"}}}}}