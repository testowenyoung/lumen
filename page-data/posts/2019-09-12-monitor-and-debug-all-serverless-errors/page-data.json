{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/2019-09-12-monitor-and-debug-all-serverless-errors/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"a92f2e45-09fb-5e5d-ac42-e44aeaf07936","excerpt":"One of the most popular features of the Serverless Framework is its ability to provide monitoring with automatic instrumentation. By signing up for a free…","html":"<p>One of the most popular features of the Serverless Framework is its ability to provide monitoring with automatic instrumentation. By signing up for a free Serverless Framework account and deploying your service, it is automatically instrumented to capture all of the data needed to provide metrics, alerts, notifications, stacktraces and more.</p>\n<p>This is especially powerful when it comes to monitoring and debugging errors. When your code throws an error, then the Serverless Framework provides a few ways to monitor and debug those errors:</p>\n<ol>\n<li>You will get a <a href=\"https://serverless.com/framework/docs/dashboard/monitoring/alerts#error-new-error-type-identified\">New Error Type</a> alert for your service instance, notifying you in Slack or Email that a new error was identified.</li>\n<li>The stack trace is captured and in the Serverless Dashboard you can see the stack trace highlighting the exact line which threw the error.</li>\n<li>The invocations &#x26; errors chart will show you the number of times errors have occurred over a span of time.</li>\n<li>Using the invocation explorer you can search and identify the individual invocations which got the error and dig into all the details.</li>\n</ol>\n<p>No wonder this is such a popular feature.</p>\n<p>However, until today, capturing the errors only worked for cases where the error was not caught by the code and resulted in a fatal crash of the Lambda invocation. But of course we do not want our services to return 500 in such cases, so more often than not, the errors are caught and the Lambda function returns a nicer 4XX error.</p>\n<p>Today we are launching a new addition to the Serverless Framework to help capture errors even when they are caught by your code. So let’s look at this code first.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">hello</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> context</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// do some real stuff but it throws an error, oh no!</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'new error'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    context<span class=\"token punctuation\">.</span><span class=\"token function\">captureError</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    statusCode<span class=\"token operator\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>\n    body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> error<span class=\"token operator\">:</span> <span class=\"token string\">'my nice error message'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In the example above, our lambda function handler throws an error; however, it is also caught. It calls the <code class=\"language-text\">captureError</code> function provided by the Serverless Framework SDK in the <code class=\"language-text\">context</code> object. The function was able to proceed and return a nice friendly error to the API while still capturing the error. The <a href=\"http://slss.io/docs-capture-error\">documentation</a> provides more details on using the <code class=\"language-text\">captureError</code> method.</p>\n<p>Now that the error is captured by the Serverless Framework, you can use the powerful dashboard features to help monitor and  debug these errors. Here are a few ways you can interact with these newly captured errors in the dashboard.</p>\n<p>When a new error is captured which hasn’t been captured before, you will get a <a href=\"https://serverless.com/framework/docs/dashboard/monitoring/alerts#error-new-error-type-identified\">New Error Type</a> alert. You can also setup <a href=\"https://serverless.com/framework/docs/dashboard/monitoring/notifications/\">notifications</a> to get notified in Slack or email, or custom SNS Topics or API endpoints. </p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/monitor-and-debug-all-serverless-errors/image-01.png\" alt=\"New error type alert\"></p>\n<p>All errors, including fatal errors and captured errors, are available in the Invocation Explorer so you can filter for invocations containing errors.</p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/monitor-and-debug-all-serverless-errors/image-02.png\" alt=\"Invocation explorer with filter\"></p>\n<p>Also in the invocation explorer you can dive into the details of the individual invocation to get the details about the error, including the stack trace which was captured by the <code class=\"language-text\">captureError</code> method in the code.</p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/monitor-and-debug-all-serverless-errors/image-03.png\" alt=\"Invocation explorer details with stack trace\"></p>\n<p>Lastly, in the service instance overview page you can view invocation metrics and filter the results to identify the captured errors.</p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/monitor-and-debug-all-serverless-errors/image-04.png\" alt=\"Invocations and errors chart\"></p>\n<p>If you want to improve monitoring and debugging for your Serverless Framework application, getting started with the automatic instrumentation is incredibly easy. <a href=\"https://dashboard.serverless.com/\">Sign up in the dashboard</a> and follow the instructions to start a new Serverless Framework project or incorporate the dashboard features into existing services.</p>","frontmatter":{"title":"Monitor and debug all serverless errors","date":"September 12, 2019","description":"Use captureError to monitor and debug caught errors in your Serverless Framework services even when they are caught by your code."}}},"pageContext":{"slug":"/posts/2019-09-12-monitor-and-debug-all-serverless-errors/","previous":{"fields":{"slug":"/posts/2019-09-11-serverless-and-twilio/"},"frontmatter":{"title":"How to use Serverless and Twilio to automate your communication channels"}},"next":{"fields":{"slug":"/posts/2019-09-16-lambda-at-edge-support-added/"},"frontmatter":{"title":"Lambda@Edge support now available"}}}}}