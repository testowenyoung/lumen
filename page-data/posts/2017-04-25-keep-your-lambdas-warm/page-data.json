{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/2017-04-25-keep-your-lambdas-warm/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"21fa155f-c1a3-5ffc-b4da-7d4adcdca8c6","excerpt":"Cold starts in AWS Lambda got you down? You’ve come to the right place. In this post, I’ll briefly cover what cold starts are, and then show you some ways to…","html":"<p>Cold starts in <a href=\"https://serverless.com/aws-lambda/\">AWS Lambda</a> got you down? You’ve come to the right place.</p>\n<p>In this post, I’ll briefly cover what cold starts are, and then show you some ways to reduce your cold start times. Read on!</p>\n<h4>First: what is a cold start? ❄️</h4>\n<p>When running a serverless function, it will stay active (a.k.a., hot) as long as you’re running it. Your container stays alive, ready and waiting for execution.</p>\n<p>After a period of inactivity, your cloud provider will drop the container, and your function will become inactive, (a.k.a., cold).</p>\n<p>A cold start happens when you execute an inactive function. The delay comes from your cloud provider provisioning your selected runtime container and then running your function.</p>\n<p>In a nutshell, this process will considerably increase your execution time.</p>\n<h5>Understanding AWS cold starts</h5>\n<p>When using AWS Lambda, provisioning of your function’s container can take >5 seconds. That makes it impossible to guarantee &#x3C;1 second responses to events such as API Gateway, DynamoDB, CloudWatch, S3, etc.</p>\n<p><a href=\"https://robertvojta.com/aws-journey-api-gateway-lambda-vpc-performance-452c6932093b\">This analysis of AWS Lambda + private VPC container initialization times</a> concluded:</p>\n<ul>\n<li>Run-times and memory size don’t affect container initialization time</li>\n<li>Lambda within a private VPC increases container initialization time</li>\n<li>Containers are not reused after ~15 minutes of inactivity</li>\n</ul>\n<h4>How to make them warm ♨</h4>\n<p>Ready to combat those cold starts? Here’s how you do it.</p>\n<h5>Find out: where are the bottlenecks, and when?</h5>\n<p>To fix cold start problems, knowing your service performance bottleneck is essential. From small to big services, it’s common to find one function that slows down your service logic because it doesn’t run often enough to keep its container alive.</p>\n<p>For example, one of my own cold functions was a reset email service during off-peak hours. From UTC+1 23:00 to UTC+1 06:00 (London), it took more than <em>double</em> the amount of time to get a reset password email.</p>\n<h5>Then: use the cold starts plug-in for the Serverless Framework</h5>\n<p>I got sick of cold starts on my Lambdas at <a href=\"https://fidel.uk\">@Fidel</a>, so I wrote a plugin called <a href=\"https://github.com/FidelLimited/serverless-plugin-warmup\">serverless-plugin-warmup</a> that allows you to keep all your Lambdas hot. (YES.)</p>\n<p>WarmUP does this by creating a scheduled event Lambda that invokes all the Lambdas you select in a configured time interval (default: 5 minutes) or a specific time, forcing your containers to stay alive.</p>\n<h5>Installing the WarmUP plugin</h5>\n<p>Install via npm in the root of your Serverless service:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install serverless-plugin-warmup --save-dev</code></pre></div>\n<p>Add the plugin to the <code class=\"language-text\">plugins</code> array in your Serverless <code class=\"language-text\">serverless.yml</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">plugins</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> serverless<span class=\"token punctuation\">-</span>plugin<span class=\"token punctuation\">-</span>warmup</code></pre></div>\n<p>Add <code class=\"language-text\">warmup: true</code> property to all functions you want to be warm:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">functions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">hello</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">warmup</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>In order for WarmUP to be able to <code class=\"language-text\">invoke</code> lambdas, you’ll also need to set the following Policy Statement in <code class=\"language-text\">iamRoleStatements</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">iamRoleStatements</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Effect</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Allow'</span>\n    <span class=\"token key atrule\">Action</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'lambda:InvokeFunction'</span>\n    <span class=\"token key atrule\">Resource</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"*\"</span></code></pre></div>\n<p>Add an early callback call when the event source is <code class=\"language-text\">serverless-plugin-warmup</code>. You should do this early exit before running your code logic, it will save your execution duration and cost.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">lambdaToWarm</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/** Immediate response for WarmUP plugin */</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>source <span class=\"token operator\">===</span> <span class=\"token string\">'serverless-plugin-warmup'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'WarmUP - Lambda is warm!'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Lambda is warm!'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token operator\">...</span> add lambda logic after\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Perfect! Now all of your Lambdas are hot, and you have less to worry about.</p>\n<p>You can find more info <a href=\"https://github.com/FidelLimited/serverless-plugin-warmup#options\">here</a> about options, event source and estimated cost.</p>\n<h4>Additional provider support?</h4>\n<p>I only work with AWS, so adding support for other providers is a welcome contribution!</p>\n<p>For more on how to contribute to the Serverless Framework open source project, check this post:</p>\n<ul>\n<li><a href=\"https://serverless.com/blog/how-contribute-to-serverless-open-source/\">How to contribute to Serverless open source projects</a></li>\n</ul>","frontmatter":{"title":"Keeping Functions Warm - How To Fix AWS Lambda Cold Start Issues","date":"April 25, 2017","description":"Learn how to prevent cold start in your Lambda functions with the Serverless WarmUp plugin."}}},"pageContext":{"slug":"/posts/2017-04-25-keep-your-lambdas-warm/","previous":{"fields":{"slug":"/posts/2017-04-21-introducing-serverless-plugin-iopipe/"},"frontmatter":{"title":"Enhanced Analytics & Monitoring for your Serverless Apps with the IOpipe Serverless Plugin - Now in Beta"}},"next":{"fields":{"slug":"/posts/2017-04-26-serverless-v1.12.0/"},"frontmatter":{"title":"New in Serverless v1.12 - Package/Deploy Command Separation for Better CI/CD Support"}}}}}