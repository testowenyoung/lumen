{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/2018-05-07-how-create-rest-api-serverless-components/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"8a5ce302-8acc-50af-a485-b0a4a95aedef","excerpt":"Update: This post is based on the beta version of Serverless Components, which is not compatible with the latest, and much faster, GA version. Please check out…","html":"<blockquote>\n<p><strong>Update:</strong> This post is based on the beta version of Serverless Components, which is not compatible with the latest, and much faster, GA version. Please check out the <a href=\"https://github.com/serverless/components\">latest docs</a> for more up to date information.</p>\n</blockquote>\n<h4>Introduction</h4>\n<p>You might have already heard about our new project, <a href=\"https://github.com/serverless/components\">Serverless Components</a>. Our goal was to encapsulate common functionality into so-called “components”, which could then be easily re-used, extended and shared with other developers and other serverless applications.</p>\n<p>In this post, I’m going to show you how to compose a fully-fledged, REST API-powered application, all by using several pre-built components from the <a href=\"https://github.com/serverless/components/tree/master/registry\">component registry</a>.</p>\n<p>Excited? Let’s go!</p>\n<h4>Wait, what are components again?</h4>\n<p>I’m going to start with <a href=\"https://serverless.com/blog/what-are-serverless-components-how-use/\">a quick refresher on Serverless Components</a>. If you already know all about them, then jump straight to <a href=\"#installing-serverless-components\">install</a> or <a href=\"#building-our-application\">building the app</a>.</p>\n<p>In essence, components are logical units which encapsulate code to perform certain actions. Components expose an interface so that they can be re-used easily by others without them having to know the inner workings. They can be orchestrated and nested to build higher-order functionalities, like so:</p>\n<img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/components/serverless-components-s3-config.png\">\n<img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/components/serverless-components-nesting.png\">\n<img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/components/serverless-components-photo-app-nesting.png\">\n<p>To take a look at a simple example, let’s imagine that we want to deploy multiple AWS Lambda functions to AWS.</p>\n<h3>Doing this the old way</h3>\n<p>Taking a deeper look into AWS Lambdas internals, we see that every Lambda function needs an IAM role. Further, we need to configure parameters such as “Memory size” or “Timeout”. We need to provide the zipped source code and ship it alongside our AWS Lambda function.</p>\n<p>We could accomplish our task by manually creating an IAM role, configuring the (“Memory size” and “Timeout”), and zipping and uploading the code. But doing this manually is cumbersome and error-prone. And, there’s no way to re-use common logic to create other AWS Lambda functions in the future.</p>\n<h5>Doing this with components</h5>\n<p>Enter: Serverless Components! The components concept provides an easy way to abstract away common functionality, making it easier to re-use that functionality in multiple places.</p>\n<p>In our case, we would componentize the AWS IAM role into one component, which takes a <code class=\"language-text\">name</code> and the <code class=\"language-text\">service</code> as inputs, creates an IAM Role, and returns the <code class=\"language-text\">arn</code> as an output:</p>\n<img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/components-rest-api/iam-role-component-serverless.png\">\n<p>We could similarly componetize the AWS Lambda function into another component, which takes the <code class=\"language-text\">name</code>, <code class=\"language-text\">memorySize</code>, <code class=\"language-text\">timeout</code>, <code class=\"language-text\">code</code> and <code class=\"language-text\">iamRole</code> as inputs, creates the AWS Lambda function, and returns the <code class=\"language-text\">arn</code> as an output:</p>\n<img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/components-rest-api/lambda-component-serverless.png\">\n<p>Then, we’d be able re-use our two components to create dozens of AWS Lambda functions and their corresponding roles, without the need to manually create Lambda functions or IAM roles <em>ever again</em>.</p>\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 75%; position: relative; height: 0; overflow: hidden; margin-bottom: 1.0725rem\" > <iframe src=\"https://giphy.com/embed/3o8dFn5CXJlCV9ZEsg\" frameborder=\"0\" class=\"giphy-embed\" allowfullscreen style=\" position: absolute; top: 0; left: 0; width: 100%; height: 100%; \"></iframe><p><a href=\"https://giphy.com/gifs/converse-3o8dFn5CXJlCV9ZEsg\">via GIPHY</a></p> </div>\n<p>Write once, use everywhere.</p>\n<h4>Installing Serverless Components</h4>\n<p>First up, you’ll need to get <a href=\"https://github.com/serverless/components\">Serverless Components</a> installed on your machine.</p>\n<p>Serverless Components is a CLI tool written in JavaScript that helps in deploying, testing, and removing our component-based applications.</p>\n<p>To install, simply run: <code class=\"language-text\">npm install --global serverless-components</code>.</p>\n<p><strong>Note:</strong> Right now Serverless Components needs Node.js 8 or greater. Compatibility with older Node.js versions is <a href=\"https://github.com/serverless/components/pull/188\">already in the making</a>.</p>\n<h4>Components we’re using to build this API</h4>\n<p>Let’s take a quick look at the different components we’ll use throughout this tutorial to build our REST API-powered application.</p>\n<h5><code class=\"language-text\">aws-lambda</code></h5>\n<p>The <a href=\"https://github.com/serverless/components/tree/master/registry/aws-lambda\"><code class=\"language-text\">aws-lambda</code></a> component gives us a convenient way to deploy Lambda functions to AWS.</p>\n<p>When using it, we’ll need to supply <code class=\"language-text\">memory</code>, <code class=\"language-text\">timeout</code>, and <code class=\"language-text\">handler</code> properties. All other configurations (such as the function <code class=\"language-text\">name</code>) are optional.</p>\n<p>The Lambda component will even auto-generate and automatically manage an IAM role for us, if we don’t specify one.</p>\n<p>You can find the documentation and some examples in the <a href=\"https://github.com/serverless/components/tree/master/registry/aws-lambda\">AWS Lambda component registry entry</a>.</p>\n<h5><code class=\"language-text\">aws-dynamodb</code></h5>\n<p>The <a href=\"https://github.com/serverless/components/tree/master/registry/aws-dynamodb\"><code class=\"language-text\">aws-dynamodb</code></a> component makes it possible to create and manage DynamoDB tables.</p>\n<p>The only configurations necessary for this component are (1) the <code class=\"language-text\">region</code>, in which the table should be created; (2) an array called <code class=\"language-text\">tables</code>, which includes the different DynamoDB-specific table definitions.</p>\n<p>The <a href=\"https://github.com/serverless/components/tree/master/registry/aws-dynamodb\">components documentation</a> shows some example uses.</p>\n<h5><code class=\"language-text\">rest-api</code></h5>\n<p>The <a href=\"https://github.com/serverless/components/tree/master/registry/rest-api\"><code class=\"language-text\">rest-api</code></a> component creates a REST API according to a config consisting of a <code class=\"language-text\">gateway</code> and <code class=\"language-text\">routes</code> property.</p>\n<h5><code class=\"language-text\">gateway</code> config</h5>\n<p>The <code class=\"language-text\">gateway</code> config property determines where the REST API should be created. The component currently supports <code class=\"language-text\">aws-apigateway</code> to setup a REST API on AWS using the API Gateway, and <code class=\"language-text\">eventgateway</code> to setup a REST API using the hosted version of <a href=\"https://serverless.com/event-gateway/\">Event Gateway</a>.</p>\n<p>In this post, we’ll be using the <code class=\"language-text\">aws-apigateway</code> configuration to tell the Framework that we want to set up our REST API on AWS using the API Gateway service.</p>\n<h5><code class=\"language-text\">routes</code> config</h5>\n<p>The <code class=\"language-text\">routes</code> config property is used to specify the routes with its paths and methods and maps them to the Lambda functions which should be invoked when accessing those routes.</p>\n<p>If for example, you want to implement a “Products” API you’d create routes like this:</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Path</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">GET</code></td>\n<td><code class=\"language-text\">/products</code></td>\n<td>List all products</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">GET</code></td>\n<td><code class=\"language-text\">/products/{id}</code></td>\n<td>Get the product with id <code class=\"language-text\">{id}</code></td>\n</tr>\n<tr>\n<td><code class=\"language-text\">POST</code></td>\n<td><code class=\"language-text\">/products</code></td>\n<td>Take product data and create a new product</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">DELETE</code></td>\n<td><code class=\"language-text\">/products/{id}</code></td>\n<td>Delete the product with the id <code class=\"language-text\">{id}</code></td>\n</tr>\n</tbody>\n</table>\n<p>That’s it. When deploying the component to AWS, the Framework will automatically create a REST API using the API Gateway service and return the URLs we can use to perform the above operations.</p>\n<p>You can find the documentation and some examples in the <a href=\"https://github.com/serverless/components/tree/master/registry/rest-api\">REST API component registry entry</a>.</p>\n<h4>Building our application</h4>\n<p>Enough theory. Let’s dive right into the code and build an application!</p>\n<h5>Creating a component project</h5>\n<p>Let’s start by creating a new components project. A components project is simply a directory containing a <code class=\"language-text\">serverless.yml</code> file.</p>\n<p>To start, create a new directory called <code class=\"language-text\">products-rest-api</code> by running <code class=\"language-text\">mkdir products-rest-api</code>. After <code class=\"language-text\">cd</code>ing into it, we’ll need to create an empty <code class=\"language-text\">serverless.yml</code> file by running <code class=\"language-text\">touch serverless.yml</code>. Then, open this directory with your favorite code editor.</p>\n<p>In order to tell Serverless that we have a components project, we need to add the following lines of code to our <code class=\"language-text\">serverless.yml</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> rest<span class=\"token punctuation\">-</span>api<span class=\"token punctuation\">-</span>app</code></pre></div>\n<p>The <code class=\"language-text\">type</code> property tells the Framework that our application is called <code class=\"language-text\">rest-api-app</code>.</p>\n<p>If you compare this information with <code class=\"language-text\">serverless.yml</code> files from components <a href=\"https://github.com/serverless/components/tree/master/registry\">in the registry</a>, you might see that they too have a <code class=\"language-text\">type</code> property at the root level. This is because our <code class=\"language-text\">rest-api-app</code> application is itself a component, which could be re-used by other components or projects.</p>\n<p><strong>There is no distinction between an application or a component. Both are components at the end of the day.</strong></p>\n<h5>Adding a <code class=\"language-text\">products</code> DB table</h5>\n<p>Since our REST API will be used to store and retrieve product data, we’ll need to have a database backend to persist such products.</p>\n<p>The <code class=\"language-text\">aws-dynamodb</code> component makes it easy for us to use and manage AWS DynamoDB tables. Let’s add this component to our application.</p>\n<p>Add the following code into your projects <code class=\"language-text\">serverless.yml</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># ... snip</span>\n\n<span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">productsDb</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>dynamodb\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">region</span><span class=\"token punctuation\">:</span> us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n      <span class=\"token key atrule\">tables</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> products\n          <span class=\"token key atrule\">hashKey</span><span class=\"token punctuation\">:</span> id\n          <span class=\"token key atrule\">indexes</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ProductIdIndex\n              <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> global\n              <span class=\"token key atrule\">hashKey</span><span class=\"token punctuation\">:</span> id\n          <span class=\"token key atrule\">schema</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">id</span><span class=\"token punctuation\">:</span> number\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> string\n            <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> string\n            <span class=\"token key atrule\">price</span><span class=\"token punctuation\">:</span> number\n          <span class=\"token key atrule\">options</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">timestamps</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>With this code snippet, we’ve officially added the first component to our project!</p>\n<p>Components can be added and configured in the <code class=\"language-text\">components</code> section, and configured via <code class=\"language-text\">inputs</code>. In our example, we’ve added a component we called <code class=\"language-text\">productsDb</code> with the <code class=\"language-text\">type</code> <code class=\"language-text\">aws-dynamodb</code>. We then created a new DynamoDB table called <code class=\"language-text\">products</code> in the <code class=\"language-text\">us-east-1</code> region.</p>\n<p>Our database schema is defined with the <code class=\"language-text\">schema</code> property, and defines the products properties <code class=\"language-text\">id</code>, <code class=\"language-text\">name</code>, <code class=\"language-text\">description</code> and <code class=\"language-text\">price</code>.</p>\n<h5>Adding our Lambda functions</h5>\n<p>The next thing we need to do is add AWS Lambda functions to create and list our products.</p>\n<p>We’ll store our Lambda code in a file called <code class=\"language-text\">products.js</code> which is located in a directory called <code class=\"language-text\">code</code> in the projects root directory (<code class=\"language-text\">code/products.js</code>).</p>\n<p>Let’s start with the <code class=\"language-text\">createProduct</code> function, which will insert a new product into the database.</p>\n<h5><code class=\"language-text\">createProduct</code></h5>\n<p>Paste the following code into the <code class=\"language-text\">products.js</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">AWS</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aws-sdk'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> dynamo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS<span class=\"token punctuation\">.</span>DynamoDB<span class=\"token punctuation\">.</span>DocumentClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> region<span class=\"token operator\">:</span> <span class=\"token string\">'us-east-1'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> tableName <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span>productTableName\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">evt<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">,</span> cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>evt<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span>\n  dynamo<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    Item<span class=\"token operator\">:</span> item<span class=\"token punctuation\">,</span>\n    TableName<span class=\"token operator\">:</span> tableName\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> resp</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        statusCode<span class=\"token operator\">:</span> <span class=\"token number\">201</span><span class=\"token punctuation\">,</span>\n        headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token operator\">:</span> <span class=\"token string\">'*'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  create\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here, we imported the AWS SDK, which is required to make AWS SDK calls. Then, we created a new DynamoDB instance called <code class=\"language-text\">dynamo</code>.</p>\n<p>We fetched the <code class=\"language-text\">table</code> name from the function’s environment variables and defined our <code class=\"language-text\">create</code> function, which includes the logic to insert a new product record into the database.</p>\n<p>Note that we’re already using an event shape which corresponds to the AWS API Gateway event definitions.</p>\n<p>Next up, we need to add an AWS Lambda component to our <code class=\"language-text\">serverless.yml</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># ... snip</span>\n\n<span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># ... snip</span>\n  <span class=\"token key atrule\">createProduct</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>lambda\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token number\">512</span>\n      <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n      <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> products.create\n      <span class=\"token key atrule\">root</span><span class=\"token punctuation\">:</span> ./code\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">productTableName</span><span class=\"token punctuation\">:</span> products</code></pre></div>\n<p>Here, we’re adding our <code class=\"language-text\">createProcuct</code> component which is of <code class=\"language-text\">type</code> <code class=\"language-text\">aws-lambda</code>.</p>\n<p>We’ve defined the function’s configuration with the help of the component’s <code class=\"language-text\">inputs</code> section. Note that we’re specifying the path to our function’s code with the help of the <code class=\"language-text\">root</code> property and the environment variables via <code class=\"language-text\">env</code>.</p>\n<h5><code class=\"language-text\">getProduct</code> and <code class=\"language-text\">listProducts</code></h5>\n<p>Let’s add the functionality to fetch a single product (<code class=\"language-text\">getProduct</code>), as well as all products (<code class=\"language-text\">listProducts</code>), from the database.</p>\n<p>Add the following JavaScript code to the <code class=\"language-text\">products.js</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// ... snip</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">evt<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">,</span> cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> vId <span class=\"token operator\">=</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>evt<span class=\"token punctuation\">.</span>pathParameters<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n  dynamo<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    Key<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      id<span class=\"token operator\">:</span> vId\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    TableName<span class=\"token operator\">:</span> tableName\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> product <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>Item\n      <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        statusCode<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n        headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token operator\">:</span> <span class=\"token string\">'*'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">evt<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">,</span> cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  dynamo<span class=\"token punctuation\">.</span><span class=\"token function\">scan</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    TableName<span class=\"token operator\">:</span> tableName\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> products <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>Items\n      <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        statusCode<span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n        headers<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token operator\">:</span> <span class=\"token string\">'*'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        body<span class=\"token operator\">:</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>products<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ... snip</span>\n  <span class=\"token keyword\">get</span><span class=\"token punctuation\">,</span>\n  list\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With this code, we simply defined and exported two functions, called <code class=\"language-text\">get</code> and <code class=\"language-text\">list</code>, which will query our DynamoDB database and return the result formatted in a way the API Gateway understands.</p>\n<p>Let’s add two new AWS Lambda components to our <code class=\"language-text\">serverless.yml</code>—one component for the <code class=\"language-text\">get</code> function and one for the <code class=\"language-text\">list</code> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># ... snip</span>\n\n<span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># ... snip</span>\n  <span class=\"token key atrule\">getProduct</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>lambda\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token number\">512</span>\n      <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n      <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> products.get\n      <span class=\"token key atrule\">root</span><span class=\"token punctuation\">:</span> ./code\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">productTableName</span><span class=\"token punctuation\">:</span> products\n  <span class=\"token key atrule\">listProducts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>lambda\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token number\">512</span>\n      <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n      <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> products.list\n      <span class=\"token key atrule\">root</span><span class=\"token punctuation\">:</span> ./code\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">productTableName</span><span class=\"token punctuation\">:</span> products</code></pre></div>\n<p>Here, we declared two function components called <code class=\"language-text\">getProduct</code> and <code class=\"language-text\">listProducts</code>, which are of <code class=\"language-text\">type</code> <code class=\"language-text\">aws-lambda</code>. Both functions were configured via <code class=\"language-text\">inputs</code>, and refer to the same code location as our <code class=\"language-text\">createProcuct</code> function.</p>\n<p>We also passed in the corresponding environment variables via <code class=\"language-text\">env</code> to ensure that our Lamdba functions had access to our DynamoDB table name.</p>\n<p>That’s it from an AWS Lamdba functions perspective!</p>\n<h5>Adding the <code class=\"language-text\">rest-api</code> components</h5>\n<p>The last missing piece is the <code class=\"language-text\">rest-api</code> component, which ties everything together and makes it possible to interact with our Products application end-to-end.</p>\n<p>Adding and configuring our REST API is as easy as adding the corresponding component configuration to our <code class=\"language-text\">serverless.yml</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># ... snip</span>\n\n<span class=\"token key atrule\">components</span><span class=\"token punctuation\">:</span>\n  <span class=\"token comment\"># ...snip</span>\n  <span class=\"token key atrule\">productsApi</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> rest<span class=\"token punctuation\">-</span>api\n    <span class=\"token key atrule\">inputs</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">gateway</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>apigateway\n      <span class=\"token key atrule\">routes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">/products</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">post</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">function</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>createProduct<span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">cors</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">get</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">function</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>listProducts<span class=\"token punctuation\">}</span>\n            <span class=\"token key atrule\">cors</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          /<span class=\"token punctuation\">{</span>id<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">get</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">function</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>getProduct<span class=\"token punctuation\">}</span>\n              <span class=\"token key atrule\">cors</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>Here, we created our <code class=\"language-text\">productsApi</code> REST API using the component with the <code class=\"language-text\">type</code> <code class=\"language-text\">rest-api</code>. Via <code class=\"language-text\">inputs</code>, we configured it to use the <code class=\"language-text\">aws-apigateway</code> component under the hood as our <code class=\"language-text\">gateway</code> of choice.</p>\n<p>Then, we defined our <code class=\"language-text\">routes</code>. Generally speaking, we defined 3 routes, one for each function. We made <code class=\"language-text\">/products</code> accessible via <code class=\"language-text\">GET</code> and <code class=\"language-text\">POST</code>, and specific products accessible at <code class=\"language-text\">/products/{id}</code> via <code class=\"language-text\">GET</code>.</p>\n<p>A speciality in this component definition is the use of Serverless Variables via <code class=\"language-text\">${}</code>. <a href=\"https://serverless.com/framework/docs/providers/aws/guide/variables/\">Serverless Variables</a> makes it easy for us to reference different values from different sources: environment variables, component outputs, or the <code class=\"language-text\">serverless.yml</code> file itself.</p>\n<p>In our case, we’re referencing the AWS Lambda components by name and passing those functions into our <code class=\"language-text\">rest-api</code> component. This way, the component knows how to configure the REST API so that the corresponding function is called when a request is sent to the endpoint.</p>\n<p>Enabling <code class=\"language-text\">cors</code> for our endpoints is as easy as adding the <code class=\"language-text\">cors: true</code> configuration to our route.</p>\n<h5>Deploy and testing</h5>\n<p>That’s it! We wrote all the necessary code to set up and configure our fully-fledged REST API!</p>\n<p>We now have a REST API which is accessible via 3 different API endpoints. This REST API will trigger our AWS Lambda functions, which in turn reach out to DynamoDB to query our products.</p>\n<p>Let’s Deploy and test our application!</p>\n<p>Deploying is as easy as running <code class=\"language-text\">components deploy</code>.</p>\n<p>We can see our API Gateway endpoints at the end of the deployment logs. It should look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">REST API resources:\n  POST - https://3412ssa.execute-api.us-east-1.amazonaws.com/dev/products\n  GET - https://3412ssa.execute-api.us-east-1.amazonaws.com/dev/producst\n  GET - https://3412ssa.execute-api.us-east-1.amazonaws.com/dev/products/{id}</code></pre></div>\n<p>Let’s insert a new product.</p>\n<p>We can <code class=\"language-text\">curl</code> our <code class=\"language-text\">/products</code> endpoint via <code class=\"language-text\">POST</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl --request POST \\\n  --url https://3412ssa.execute-api.us-east-1.amazonaws.com/dev/products \\\n  --header &#39;content-type: application/json&#39; \\\n  --data &#39;{\n      &quot;id&quot;: 1,\n      &quot;name&quot;: &quot;Learning Serverless Components&quot;,\n      &quot;description&quot;: &quot;A tutorial to learn the new Serverless Components concept.&quot;,\n      &quot;price&quot;: 15\n    }&#39;</code></pre></div>\n<p>Great! Now we should be able to get our inserted product via the following <code class=\"language-text\">GET</code> request:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl https://3412ssa.execute-api.us-east-1.amazonaws.com/dev/products/1</code></pre></div>\n<p>A list of all products can be requested like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl https://3412ssa.execute-api.us-east-1.amazonaws.com/dev/products</code></pre></div>\n<p>Nice! Feel free to continue playing around with your REST API.</p>\n<p>Once done, you can remove the application via <code class=\"language-text\">components remove</code>.</p>\n<h4>Conclusion</h4>\n<p>We’ve just created our very first product REST API via Serverless Components. And we did it by using three different pre-built components from the <a href=\"https://github.com/serverless/components/tree/master/registry\">Serverless Components registry</a> (<code class=\"language-text\">aws-lambda</code>, <code class=\"language-text\">aws-dynamodb</code> and <code class=\"language-text\">rest-api</code>).</p>\n<p>Setting everything up was as easy as adding the function logic and the corresponding component configurations in our <code class=\"language-text\">serverless.yml</code> file.</p>\n<p>I hope that you’ve enjoyed this tutorial, and got a feeling for how powerful Serverless Components are.</p>\n<p>You could enhance this project further by adding a static website interface with the help of the <a href=\"https://github.com/serverless/components/tree/master/registry/static-website\"><code class=\"language-text\">static-website</code> component</a>.</p>\n<p>The <a href=\"https://github.com/serverless/components/tree/master/examples\"><code class=\"language-text\">examples</code></a> section in our Serverless Components repository is another great resource to get some inspiration what else you can build with the Serverless Components framework.</p>\n<h5>More Components posts</h5>\n<ul>\n<li><a href=\"https://serverless.com/blog/what-are-serverless-components-how-use/\">What are Serverless Components, and how do I use them?</a></li>\n<li><a href=\"https://serverless.com/blog/how-to-create-landing-page-with-serverless-components/\">How to create a static landing page with Serverless Components</a></li>\n<li><a href=\"https://serverless.com/blog/how-to-create-blog-using-components-hugo/\">How to create a blog using pre-built Serverless Components and Hugo</a></li>\n</ul>","frontmatter":{"title":"How to create a REST API with pre-written Serverless Components","date":"May 07, 2018","description":"How to create a fully-fledged REST API application using pre-written components from the Serverless Components project."}}},"pageContext":{"slug":"/posts/2018-05-07-how-create-rest-api-serverless-components/","previous":{"fields":{"slug":"/posts/2018-05-03-react-to-any-cloud-event-hosted-event-gateway/"},"frontmatter":{"title":"React to any cloud event with hosted Event Gateway"}},"next":{"fields":{"slug":"/posts/2018-05-15-how-to-create-blog-using-components-hugo/"},"frontmatter":{"title":"Create a blog using pre-built Serverless Components and Hugo"}}}}}