{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/2019-06-27-outputs-and-secrets/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"13042efd-0ae9-592e-86de-b0183686b6b8","excerpt":"With the Serverless Framework Enterprise v0.11.0 release, we are adding support for output variables and secrets management to make it easier for developers to…","html":"<p>With the Serverless Framework Enterprise v0.11.0 release, we are adding support for output variables and secrets management to make it easier for developers to separate secrets and shared components from their services.</p>\n<h4>Output Variables</h4>\n<p>As developers developing a Serverless Framework service we typically include two distinct types of resources in a single <code class=\"language-text\">serverless.yml</code> file - a few <em>shared resources</em> (e.g. auth function, SNS Topic) and numerous <em>individual resources</em> (like lambda functions) which depend on the shared resources. All of the shared and individual resources are bundled together into a single <code class=\"language-text\">serverless.yml</code> to accommodate the interdependency. Output Variables make it easier to share resources across services.</p>\n<p>Serverless Framework Enterprise Output Variables enable you to detangle the dependencies by separating the shared resources and the individual service resources into independent <code class=\"language-text\">serverless.yml</code> files all while sharing variables with each other. The shared resources publish output variables while each of the individual resources consume them. By refactoring into smaller services, as a bonus, we get smaller and easier to manage <code class=\"language-text\">serverless.yml</code> files, the ability to independently deploy each service, and shorter deploy times.</p>\n<p>There are two parts to sharing state across services - publishing the output variables and consuming them in other services.</p>\n<p>For example, if you have a service called “products” and you want to share the SNS Topic name with other services you can just add the <code class=\"language-text\">name</code> value to the new <code class=\"language-text\">outputs</code> section of the <code class=\"language-text\">serverless.yml</code> file.</p>\n<p><strong>products/serverless.yml</strong>\n<img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/outputs-and-secrets/SFE_products-serverless_yml.png\" alt=\"products\"></p>\n<p>Now any other service (e.g. “inventory”) can use that output variable simply be referencing it using the new <code class=\"language-text\">${state}</code> variable.</p>\n<p><strong>inventory/serverless.yml</strong>\n<img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/outputs-and-secrets/SFE_inventory-serverless_yml.png\" alt=\"inventory\"></p>\n<p>You can find more details on <a href=\"https://github.com/serverless/enterprise/blob/master/docs/output-variables.md#define-output-variables-for-shared-services\">defining output variables</a>, <a href=\"https://github.com/serverless/enterprise/blob/master/docs/output-variables.md#use-output-variables-in-dependent-services\">using them in dependent services</a> and <a href=\"https://github.com/serverless/enterprise/blob/master/docs/output-variables.md#use-output-variables-in-dependent-services\">viewing them in the dashboard</a> in the docs.</p>\n<h4>Secrets</h4>\n<p>When using third party services in your Serverless applications, you often need configuration data for things like API keys, resource identifiers, or other items. This configuration data often includes sensitive secrets which must not be stored in source control.</p>\n<p>Properly securing the sensitive secrets requires the use of a secrets management solution like SSM, KMS, Vault, or Secrets Manager, to store and encrypt the variables. Each of these introduce significant new infrastructure with additional operational overhead and cost. This touches every part of the service’s lifecycle:</p>\n<ul>\n<li>Developers must implement a way to retrieve secrets and load them into their service.</li>\n<li>If developers deploy from their local environment then you need to securely distribute the secrets to the developer’s machine.</li>\n<li>When running tests in a CI service, the secrets must also be configured in the CI service, or retrieved on each run.</li>\n<li>Once tests are complete, the CI/CD pipeline will need the secrets again to perform the deployment to the appropriate stage.</li>\n</ul>\n<p>Serverless Framework Enterprise Secrets alleviates all of these challenges by providing a way to centrally secure and store sensitive secrets and use them in your <code class=\"language-text\">serverless.yml</code> file.</p>\n<p>With Serverless Framework Enterprise Secrets you can <a href=\"https://github.com/serverless/enterprise/blob/master/docs/secrets.md#creating-a-new-secret\">create a secret</a> in the dashboard as a part of a <a href=\"https://github.com/serverless/enterprise/blob/master/docs/profiles.md#deployment-profiles\">deployment profile</a>. </p>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/assets.blog.serverless.com/outputs-and-secrets/sfe_screenshot.png\" alt=\"SFE Screenshot\"></p>\n<p>To use the secret you just add the <code class=\"language-text\">${secrets}</code> variable to your <code class=\"language-text\">serverless.yml</code> file. When you deploy it’ll decrypt and resolve the value. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">provider:\n  environment:\n    STRIPE_API_KEY: ${secrets:stripeApiKey}</code></pre></div>\n<p>Since the secrets are defined in a <a href=\"https://github.com/serverless/enterprise/blob/master/docs/profiles.md#deployment-profiles\">profile</a>, you can set different values for each stage. For example, if you have two Stripe accounts, one for prod and one for qa, then you can create a secret <code class=\"language-text\">stripeApiKey</code> to store the API Key for each stage. When you deploy, it’ll automatically use the right stripeApiKey value.</p>\n<p>You can find more information on <a href=\"https://github.com/serverless/enterprise/blob/master/docs/secrets.md#creating-a-new-secret\">creating new secrets</a> and <a href=\"https://github.com/serverless/enterprise/blob/master/docs/secrets.md#using-a-secret-to-deploy\">using them</a> in the docs.</p>","frontmatter":{"title":"Managing Secrets and Output Variables With Serverless Framework Enterprise","date":"June 28, 2019","description":"With the Serverless Framework Enterprise v0.11.0 release, we are adding support for output variables and secrets management"}}},"pageContext":{"slug":"/posts/2019-06-27-outputs-and-secrets/","previous":{"fields":{"slug":"/posts/2019-06-27-dynamic-image-resizing-python/"},"frontmatter":{"title":"Dynamic image resizing with Python and Serverless framework"}},"next":{"fields":{"slug":"/posts/2019-07-01-framework-release-v146/"},"frontmatter":{"title":"Serverless Framework v1.46.0 - Extended ALB configurability, Support for external Websocket APIs, Local plugins via relative paths & More"}}}}}