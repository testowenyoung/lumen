{"componentChunkName":"component---src-templates-blog-post-js","path":"/posts/2017-03-10-serverless-fauna-python-example/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"10c418b7-8909-5848-9361-6b5e11e3cbb3","excerpt":"Join members of the Serverless team, and the author of this post, at the next Serverless Meetup at Fauna in San Francisco, March 23rd. Introduction to FaunaDB…","html":"<p><em>Join members of the Serverless team, and the author of this post, at <a href=\"https://www.meetup.com/Serverless/events/238118916/\">the next Serverless Meetup at Fauna in San Francisco, March 23rd</a>.</em></p>\n<h2>Introduction to FaunaDB</h2>\n<p><a href=\"https://fauna.com/\">FaunaDB</a> is the first truly serverless database. In this post, I’ll demonstrate how to use the Serverless Framework to connect an AWS Lambda Python application with FaunaDB Serverless Cloud. (If you’re interested in seeing the same for <a href=\"https://fauna.com/blog/serverless-cloud-database\">JavaScript, check out the companion post on FaunaDB’s blog</a>.)</p>\n<p>When I say <em>serverless</em>, I mean the Function-as-a-Service pattern. A serverless system scales dynamically by request and doesn’t require any provisioning or capacity planning. For example, you can <a href=\"https://fauna.com/serverless-cloud-signup\">subscribe to FaunaDB in moments</a>, and smoothly scale from prototype to runaway success.</p>\n<blockquote>\n<p>A serverless system must be scaled dynamically by request.</p>\n</blockquote>\n<p><a href=\"https://fauna.com/serverless-cloud-signup\">FaunaDB Serverless Cloud</a> is a globally distributed database that doesn’t require any provisioning. Capacity is metered and available on demand, so you only pay for what you use. Plus, you can always port your app to FaunaDB On-Premises in your own datacenter or private cloud, so there’s no cloud infrastructure lock-in.</p>\n<h2>Using the Serverless Framework</h2>\n<p><a href=\"https://serverless.com/\">Serverless</a> offers a clean system for configuring, writing, and deploying serverless application code to different cloud infrastructure providers. Porting one of their storage examples from DynamoDB to FaunaDB was incredibly easy to accomplish. Looking through this code will show us how simple it is to set up a Serverless application with storage that’s available in every region.</p>\n<p>The <a href=\"https://github.com/fauna/examples/tree/aws-python-rest-api-with-faunadb/aws-python-rest-api-with-faunadb\">Python CRUD service</a> is a simple REST API that allows the creation, updating and deletion of todo items as well as the list of all items. After we look through the code, I’ll describe how you’d go about adding a shared-list multi-user data model, where users can invite other members to read and update todo lists.</p>\n<p>The README file contains <a href=\"https://github.com/fauna/examples/tree/aws-python-rest-api-with-faunadb/aws-python-rest-api-with-faunadb#setup\">installation and setup instructions</a>, and you can <a href=\"https://fauna.com/serverless-cloud-sign-up\">go here</a> to gain instant access to FaunaDB.</p>\n<p><em>Once this configuration is running, you can play with deeper features of FaunaDB, such as querying a social graph. Take a look at this <a href=\"https://fauna.com/tutorials/social\">social graph tutorial</a>.</em></p>\n<h2>Defining Functions</h2>\n<p>The first file to start reading any application that uses the Serverless Framework is <a href=\"https://github.com/fauna/examples/blob/aws-python-rest-api-with-faunadb/aws-python-rest-api-with-faunadb/serverless.yml\">serverless.yml</a>. It defines the service functions and links to event handlers.</p>\n<h3>readAll example</h3>\n<p>Here we can see one of the function definitions:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">list</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">handler</span><span class=\"token punctuation\">:</span> todos/list.list\n  <span class=\"token key atrule\">events</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> todos\n        <span class=\"token key atrule\">method</span><span class=\"token punctuation\">:</span> get\n        <span class=\"token key atrule\">cors</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>This configuration means the <a href=\"https://github.com/fauna/examples/blob/aws-python-rest-api-with-faunadb/aws-python-rest-api-with-faunadb/todos/list.py\"><code class=\"language-text\">list</code> function in <code class=\"language-text\">todos/list.py</code></a> will be called when an HTTP GET is received at the <code class=\"language-text\">todos</code> path. If you look through the configuration you’ll see all the functions are linked to files in the todos directory, so we’ll look at the implementation of <code class=\"language-text\">list.py</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\n\n<span class=\"token keyword\">from</span> todos<span class=\"token punctuation\">.</span>makeresult <span class=\"token keyword\">import</span> make_result\n<span class=\"token keyword\">from</span> todos <span class=\"token keyword\">import</span> client<span class=\"token punctuation\">,</span> ALL_TODOS\n\n<span class=\"token keyword\">from</span> faunadb <span class=\"token keyword\">import</span> query\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">list</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># fetch all todos from the database</span>\n    results <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>\n        query<span class=\"token punctuation\">.</span>map_expr<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> ref<span class=\"token punctuation\">:</span> query<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                       query<span class=\"token punctuation\">.</span>paginate<span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">(</span>ALL_TODOS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># create a response</span>\n    response <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"statusCode\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"body\"</span><span class=\"token punctuation\">:</span> json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span><span class=\"token builtin\">map</span><span class=\"token punctuation\">(</span>make_result<span class=\"token punctuation\">,</span> results<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> response</code></pre></div>\n<p>Most of <code class=\"language-text\">list.py</code> is concerned with managing HTTP, or module imports. Let’s zoom in on the query.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">results <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>\n    query<span class=\"token punctuation\">.</span>map_expr<span class=\"token punctuation\">(</span><span class=\"token keyword\">lambda</span> ref<span class=\"token punctuation\">:</span> query<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>ref<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                   query<span class=\"token punctuation\">.</span>paginate<span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">(</span><span class=\"token string\">'all_todos'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In this case we run a query for all todos, using a FaunaDB secret passed via configuration in <code class=\"language-text\">serverless.yml</code>. FaunaDB uses HTTP for queries so you don’t need to worry about sharing connections between modules or invocations.</p>\n<h2>Your Turn</h2>\n<p>Follow the README instructions to launch and run the service, then create a few todo items.</p>\n<p>Now you’re ready to explore your data and experiment with queries in the FaunaDB dashboard. Open the dashboard <a href=\"https://fauna.com/serverless-cloud-sign-up\">via this sign up form</a>. It will look something like this:</p>\n<p><img src=\"https://fauna.com/blog/fauna-dashboard-serverless.png\" alt=\"FaunaDB Dashboard Screenshot\"></p>\n<p>If you look closely at the screenshot you get a hint at FaunaDB’s temporal capabilities which can power everything from social activity feeds, to auditing, to mobile sync.</p>\n<h2>Taking It A Step Further</h2>\n<p>In a production-worthy version of this application, the request would contain a list ID, and our query would validate that the list is visible to the user, before returning just the matching items. This security model is similar to collaboration apps you may be familiar with, and it’s supported natively by FaunaDB.</p>\n<p>Watch the <a href=\"https://fauna.com/blog\">Fauna blog</a> for an updated Serverless application with a more mature multi-user data model using FaunaDB’s security features.</p>","frontmatter":{"title":"Build A Serverless Python Application with AWS + FaunaDB - The First Serverless Database","date":"March 10, 2017","description":"Learn how to build a Serverless Python app with serverless database FaunaDB."}}},"pageContext":{"slug":"/posts/2017-03-10-serverless-fauna-python-example/","previous":{"fields":{"slug":"/posts/2017-03-02-advanced-plugin-development-extending-the-core-lifecycle/"},"frontmatter":{"title":"Advanced Plugin Development - Extending The Serverless Core Lifecycle"}},"next":{"fields":{"slug":"/posts/2017-03-14-serverless-v1.9.0/"},"frontmatter":{"title":"Stream event improvements and custom roles for CloudFormation deployments with Serverless v1.9"}}}}}